
/*
 * Copyright (c) 2013 Adobe Systems Incorporated. All rights reserved.
 * 
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 * 
 *     http://www.apache.org/licenses/LICENSE-2.0
 * 
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

define('mobileui/utils/bus',[],function() {

    var Bus = Backbone.Model.extend({});
    return new Bus();

});
/*
 * Copyright (c) 2013 Adobe Systems Incorporated. All rights reserved.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

define('mobileui/utils/boilerplate',[],function() {

    if (!Function.prototype.bind) {
        Function.prototype.bind = function(thisObj) {
            var fn = this,
                argsToBind = Array.prototype.slice.call(arguments, 1);
            return function() {
                var fnArgs = Array.prototype.concat.call(argsToBind,
                    Array.prototype.slice.call(arguments, 0));
                fn.apply(thisObj, fnArgs);
            };
        };
    }

    if (!Array.prototype.indexOf) {
        Array.prototype.indexOf = function(obj) {
            for (var i = 0; i < this.length; ++i)
                if (this[i] == obj)
                    return i;
            return -1;
        };
    }

    if (!window.console) {
        window.console = {
            error: function() { },
            log: function() { }
        };
    }

    var browserPrefix = null;
    var mappedBrowserProperties = ((function checkBrowserSupportedProperties(properties) {
        var style = window.getComputedStyle(document.body),
            pattern = /^-(webkit|moz|ms|o)-(.*)$/,
            result = {}, i, name;
        for (i = 0; i < style.length; ++i) {
            name = style[i];
            if (pattern.test(name)) {
                var match = name.match(pattern);
                result[match[2]] = name;
                if (!browserPrefix)
                    browserPrefix = match[1];
            }
        }
        if (browserPrefix) {
            for (i = 0; i < properties.length; ++i) {
                name = properties[i];
                result[name] = "-" + browserPrefix + "-" + name;
            }
        }
        return result;
    })(["transition"]));

    var UpperCasePrefixMap = {
        "webkit": "WebKit",
        "moz": "Moz",
        "ms": "Ms"
    };

    return {
        lookupPrefix: function(obj, name) {
            return obj[name] || obj[browserPrefix + _.string.capitalize(name)];
        },

        lookupUpperCasePrefix: function(obj, name) {
            return obj[name] || obj[UpperCasePrefixMap[browserPrefix] + name];
        },

        prefixValue: function(value) {
            return browserPrefix ? "-" + browserPrefix + "-" + value : value;
        },

        prefixOne: function(property) {
            var name = mappedBrowserProperties[property];
            return name ? name : property;
        },

        prefix: function(obj) {
            var newObj = {};
            $.each(obj, function(name, value) {
                newObj[Global.Utils.prefixOne(name)] = value;
            });
            return newObj;
        }
    };
});
/*
 * Copyright (c) 2013 Adobe Systems Incorporated. All rights reserved.
 * 
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 * 
 *     http://www.apache.org/licenses/LICENSE-2.0
 * 
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

define('mobileui/utils/default-settings',[],function() {
    return {
        "touch.preview": "false"
    };
});
/*
 * Copyright (c) 2013 Adobe Systems Incorporated. All rights reserved.
 * 
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 * 
 *     http://www.apache.org/licenses/LICENSE-2.0
 * 
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

define('mobileui/utils/settings',['mobileui/utils/boilerplate', 'mobileui/utils/default-settings'],
    function(boilerplate, defaultSettings) {

    var localStorage = boilerplate.lookupPrefix(window, "localStorage"),
        storageKeyName = "settings";

    return _.extend({}, Backbone.Events, {
        init: function() {
            this._readStoredValues();
            this.trigger("ready");
        },

        getBoolean: function(name) {
            return this.readValue(name) == "true";
        },

        setBoolean: function(name, value) {
            this.writeValue(name, value ? "true" : "false");
        },

        readValue: function(name) {
            return this._settings[name];
        },

        writeValue: function(name, value) {
            this._internalWrite(name, value);
            this._setNeedsStoreUpdate();
        },

        _internalWrite: function(name, value) {
            this._settings[name] = value;
            this.trigger("change:" + name);
        },

        _needsStoreUpdate: false,

        _setNeedsStoreUpdate: function() {
            if (this._needsStoreUpdate)
                return;
            this._needsStoreUpdate = true;
            var self = this;
            setTimeout(function() {
                self._storeSettings();
            }, 0);
        },

        _settings: _.extend({}, defaultSettings),

        _readStoredValues: function() {
            if (!localStorage)
                return;
            var storedSettings = localStorage.getItem(storageKeyName);
            if (!storedSettings)
                return;
            try {
                storedSettings = JSON.parse(storedSettings);
            } catch (e) {}
            if (!storedSettings || !_.isObject(storedSettings)) {
                localStorage.removeItem(storageKeyName);
                return;
            }
            var self = this;
            _.each(storedSettings, function(value, key) {
                if (value == self._settings[key])
                    return;
                self._internalWrite(key, value);
            });
        },

        _storeSettings: function() {
            this._needsStoreUpdate = false;
            if (!localStorage)
                return;
            var settingsToStore = {};
            _.each(this._settings, function(value, key) {
                if (defaultSettings == value)
                    return;
                settingsToStore[key] = value;
            });
            localStorage.setItem(storageKeyName, JSON.stringify(settingsToStore));
        }
    });
});
define('third-party/underscore',{});
/*
 * Copyright (c) 2013 Adobe Systems Incorporated. All rights reserved.
 * 
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 * 
 *     http://www.apache.org/licenses/LICENSE-2.0
 * 
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

/* Workaround module for cases when underscore is preloaded in the environment. */
(function() {
    var global = this,
        requireList = [];
    if (!global._)
        requireList.push("third-party/underscore");
    define("mobileui/utils/underscore", requireList, function() { return global._; });
}).call(this);
/*
 * Copyright (c) 2013 Adobe Systems Incorporated. All rights reserved.
 * 
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 * 
 *     http://www.apache.org/licenses/LICENSE-2.0
 * 
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
 /**
 * @license RequireJS text 2.0.5 Copyright (c) 2010-2012, The Dojo Foundation All Rights Reserved.
 * Available via the MIT or new BSD license.
 * see: http://github.com/requirejs/text for details
 */
 define('mobileui/utils/load-module',['module'], function (module) {

    var masterConfig = (module.config && module.config()) || {};

    if (masterConfig.env === 'node' || (!masterConfig.env &&
            typeof process !== "undefined" &&
            process.versions &&
            !!process.versions.node)) {
        //Using special require.nodeRequire, something added by r.js.
        var fs = require.nodeRequire('fs');

        return function (url, callback) {
            var file = fs.readFileSync(url, 'utf8');
            //Remove BOM (Byte Mark Order) from utf8 files if it is there.
            if (file.indexOf('\uFEFF') === 0) {
                file = file.substring(1);
            }
            callback(file);
        };
    } else {
        return function (url, callback, errback, headers) {
            $.get(url, function(content) {
                callback(content);
            });
        };
    }

});
/*
 * Copyright (c) 2013 Adobe Systems Incorporated. All rights reserved.
 * 
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 * 
 *     http://www.apache.org/licenses/LICENSE-2.0
 * 
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/* Module based on requirejs.text to provide ahead of time text encoding. */
define('mobileui/utils/text-module',["mobileui/utils/underscore", "mobileui/utils/load-module"], 
    function (_, fileLoader) {
    
    var text = {

        // Overwrite this function in your sub-classes to 
        // provide different content.
        encodeContent: function(content, moduleName, parsedName) {
            return content;
        },

        // Overwrite this function in your sub-classes to 
        // provide different content.
        createModule: function(content, moduleName, parsedName) {
            return "define(function () { return " +
                               JSON.stringify(this.encodeContent(content, moduleName)) +
                               ";});\n";
        },

        createModuleAsync: function(content, moduleName, parsedName, callback) {
            callback(this.createModule(content, moduleName, parsedName));
        },

        encodeContentAsync: function(content, moduleName, parsedName, callback) {
            callback(this.encodeContent(content, moduleName, parsedName));
        },

        parseName: function (name) {
            var parts = name.split("?");
            return {
                file: parts[0],
                options: this.parseUrlComponents(parts[1])
            };
        },

        parseUrlComponents: function(components) {
            if (!components)
                return null;
            var parts = components.split("&"),
                options = {};
            _.each(parts, function(value) {
                var componentParts = value.split("=");
                options[decodeURIComponent(componentParts[0])] = decodeURIComponent(componentParts[1]);
            });
            return options;
        },

        _saveModuleContentAsync: function(content, moduleName, parsedName, callback) {
            if (!this._buildMap)
                this._buildMap = {};
            var self = this;
            this.createModuleAsync(content, moduleName, parsedName, function(moduleContent) {
                self._buildMap[moduleName] = moduleContent;
                callback();
            });
        },

        onLoadStarted: function(moduleName, parsedName) {
            return null;
        },

        load: function (moduleName, req, onLoad, config) {
            var self = this,
                parsedName = this.parseName(moduleName),
                url = req.toUrl(parsedName.file);

            this.onLoadStarted(moduleName, parsedName);

            fileLoader(url, function (content) {
                if (config.isBuild) {
                    self._saveModuleContentAsync(content, moduleName, parsedName, onLoad);
                    return;
                }
                self.encodeContentAsync(content, moduleName, parsedName, onLoad);
            }, function (err) {
                if (onLoad.error) {
                    onLoad.error(err);
                }
            });
        },

        write: function (pluginName, moduleName, write, config) {
            if (this._buildMap && this._buildMap.hasOwnProperty(moduleName))
                write.asModule(pluginName + "!" + moduleName, this._buildMap[moduleName]);
        }
    };

    return text;
});

/*
 * Copyright (c) 2013 Adobe Systems Incorporated. All rights reserved.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

define('mobileui/utils/template-module',["mobileui/utils/underscore",
        "mobileui/utils/text-module",
        "require"],
    function(_, text, require) {

    var TemplateModule = _.extend({}, text, {
        defaultOptions: {
            base: "mobileui/views/layer-view",
            label: ""
        },

        modulePath: "mobileui/views/template-view",

        create: function(content, BaseView, options) {
            var TemplateView = BaseView.extend({
                _template: content,
                render: function() {
                    this.$el.addClass("js-template-view");
                    return TemplateView.__super__.render.call(this);
                }
            }, {
                label: options.label
            });
            return TemplateView;
        },

        encodeContentAsync: function(content, moduleName, parsedName, callback) {
            var options = _.extend({}, this.defaultOptions, parsedName.options),
                self = this;
            require([options.base], function(BaseView) {
                callback(self.create(content, BaseView, options));
            });
        },

        createModule: function(content, moduleName, parsedName) {
            var options = _.extend({}, this.defaultOptions, parsedName.options);
            var code = "define(" + JSON.stringify([options.base, this.modulePath]) + ", " +
                    "function(BaseView, TemplateModule) { return TemplateModule.create(" +
                               JSON.stringify(content) + ", BaseView, " + JSON.stringify(options) +
                               "); });\n";
            return code;
        }
    });

    return TemplateModule;
});
/*
 * Copyright (c) 2013 Adobe Systems Incorporated. All rights reserved.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

define('utils/slide-module',["mobileui/utils/template-module"],
    function(TemplateModule) {

    var SlideModule = _.extend({}, TemplateModule, {
        defaultOptions: {
            base: "views/slide-container-view",
            label: ""
        },
        modulePath: "utils/slide-module"
    });

    return SlideModule;
});
define('utils/slide-module!slides/index.html?label=index',["views/slide-container-view","utils/slide-module"], function(BaseView, TemplateModule) { return TemplateModule.create("\r\n<div data-view=\"mobileui/views/layer-view\"\r\n     data-params=\"matchParentSize\">\r\n     <div class=\"text-band\">\r\n        <h1>Mobile Web Interfaces</h1>\r\n        <h2>Alexandru Chiculita</h2>\r\n        <h3>Computer Scientist<h3>\r\n        <h4>Web Engine Team</h4>\r\n        <a data-view=\"mobileui/ui/link-view\"\r\n               href=\"https://twitter.com/achicu\"\r\n               class=\"js-static-view\">@achicu</a>\r\n     </div>\r\n\r\n     <div class=\"adobe-max\"></div>\r\n     <div class=\"adobe-bird\"></div>\r\n</div>\r\n\r\n\r\n", BaseView, {"base":"views/slide-container-view","label":"index"}); });

define('utils/slide-module!slides/about-me.html?label=about-me',["views/slide-container-view","utils/slide-module"], function(BaseView, TemplateModule) { return TemplateModule.create("<h2 class=\"title-margin\">About me</h2>\r\n<ul>\r\n    <li class=\"css-regions-picture\">\r\n            <a data-view=\"mobileui/ui/link-view\" href=\"http://www.w3.org/TR/css3-regions/\" alt=\"CSS Regions\" target=\"blank_\">\r\n                <div class=\"feature-label\">CSS Regions</div>\r\n            </a>\r\n        </div>\r\n    </li>\r\n    <li class=\"css-exclusions-picture\">\r\n        <a data-view=\"mobileui/ui/link-view\"  href=\"http://www.w3.org/TR/css3-exclusions/\" alt=\"CSS Exclusions\" target=\"blank_\">\r\n            <div class=\"feature-label\">CSS Exclusions</div>\r\n        </a>\r\n    </li>\r\n    <li class=\"css-filters-picture\">\r\n        <a data-view=\"mobileui/ui/link-view\" href=\"http://www.w3.org/TR/filter-effects/\" alt=\"CSS Filters\" target=\"blank_\">\r\n            <div class=\"feature-label\">CSS Filters</div>\r\n        </a>\r\n    </li>\r\n    <li class=\"css-webkit-picture\">\r\n        <a data-view=\"mobileui/ui/link-view\" href=\"http://webkit.org\" alt=\"Hacking on WebKit\" target=\"blank_\">\r\n            <div class=\"feature-label\">WebKit</div>\r\n        </a>\r\n    </li>\r\n</ul>", BaseView, {"base":"views/slide-container-view","label":"about-me"}); });

define('utils/slide-module!slides/intro.html?label=intro',["views/slide-container-view","utils/slide-module"], function(BaseView, TemplateModule) { return TemplateModule.create("\r\n<div data-view=\"mobileui/views/scroll-view\" class=\"intro-scroll-view\" \r\n    data-bounds=\"0,0,0,400\" data-scroll-direction=\"vertical\"\r\n    data-params=\"matchParentWidth,verticalCenter\"\r\n    data-snap>\r\n    \r\n    <div data-parent-name=\"contentView\" data-view=\"mobileui/views/layout-view\" data-layout=\"vertical\"\r\n        data-params=\"matchParentWidth,matchChildrenHeight\">\r\n        <div class=\"text-line\" data-bounds=\"0,0,0,400\" data-params=\"matchParentWidth,matchLineHeight\" data-view=\"mobileui/views/layer-view\">\r\n            Responsive Web\r\n        </div>\r\n\r\n        <div class=\"text-line\" data-bounds=\"0,0,0,400\" data-params=\"matchParentWidth,matchLineHeight\" data-view=\"mobileui/views/layer-view\">\r\n            Desktop != Mobile\r\n        </div>\r\n        <div class=\"text-line\" data-bounds=\"0,0,0,400\" data-params=\"matchParentWidth,matchLineHeight\" data-view=\"mobileui/views/layer-view\">\r\n            <div style=\"display:inline-block; line-height: 1em\">\r\n                Better UI<br /><i style=\"font-size: 0.7em\">Designed for Mobile first</i>\r\n            </div>\r\n        </div>\r\n        <div class=\"text-line\" data-bounds=\"0,0,0,400\" data-params=\"matchParentWidth,matchLineHeight\" data-view=\"mobileui/views/layer-view\">\r\n            Natural look &amp; feel\r\n        </div>\r\n    </div>\r\n\r\n</div>", BaseView, {"base":"views/slide-container-view","label":"intro"}); });

define('utils/slide-module!slides/demos.html?label=demos',["views/slide-container-view","utils/slide-module"], function(BaseView, TemplateModule) { return TemplateModule.create("\r\n<h2 class=\"title-margin\">Demos</h2>\r\n\r\n<div data-view=\"views/demo-view\" data-bounds=\"0,0,400,500\" data-params=\"horizontalCenter,verticalCenter\">\r\n</div>", BaseView, {"base":"views/slide-container-view","label":"demos"}); });

define('utils/slide-module!slides/web-features.html?label=web-features',["views/slide-container-view","utils/slide-module"], function(BaseView, TemplateModule) { return TemplateModule.create("<h2 class=\"title-margin\">Web Features</h2>\r\n\r\n<div class=\"row features-row\">\r\n    <div class=\"cell3\">\r\n        <img height=\"200px\" src=\"images/offline.svg\" />\r\n        <ul class=\"bordered-list\">\r\n            <li>Offline</li>\r\n            <li class=\"small\">Application cache</li>\r\n            <li class=\"small\">Web Storage</li>\r\n        </ul>\r\n    </div>\r\n    <div class=\"cell3\">\r\n        <img height=\"200px\" src=\"images/phone_ui.svg\" />\r\n        <ul class=\"bordered-list\">\r\n            <li>Mobile UI</li>\r\n            <li class=\"small\">Touch Events</li>\r\n            <li class=\"small\">Gesture Recognition</li>\r\n        </ul>\r\n    </div>\r\n    <div class=\"cell3\">\r\n        <img height=\"200px\" src=\"images/performance.svg\" />\r\n        <ul class=\"bordered-list\">\r\n            <li>Performance</li>\r\n            <li class=\"small\">requestAnimationFrame</li>\r\n            <li class=\"small\">Worker threads</li>\r\n        </ul>\r\n    </div>\r\n</div>", BaseView, {"base":"views/slide-container-view","label":"web-features"}); });

define('utils/slide-module!slides/app-cache.html?label=app-cache',["views/slide-container-view","utils/slide-module"], function(BaseView, TemplateModule) { return TemplateModule.create("<h2 class=\"title-margin\">Application Cache</h2>\r\n<ul class=\"bordered-list smaller-space\">\r\n    <li class=\"title\">Offline Repository</li>\r\n    <li class=\"small\">Automatically creates local copy</li>\r\n    <li class=\"small\">Snappy reloads</li>\r\n    <li class=\"title\">Good to know</li>\r\n    <li class=\"small\">User interface for updates</li>\r\n    <li class=\"small\">Avoid it in development builds</li>\r\n    <li class=\"small\">Inject the date/time as a comment</li>\r\n</ul>\r\n\r\n<div class=\"slide-link\">\r\n    <a href=\"http://alistapart.com/article/application-cache-is-a-douchebag\">http://alistapart.com/article/application-cache-is-a-douchebag</a>\r\n    <a  href=\"http://www.w3.org/TR/html51/browsers.html#offline\">http://www.w3.org/TR/html51/browsers.html#offline</a>\r\n</div>", BaseView, {"base":"views/slide-container-view","label":"app-cache"}); });

define('utils/slide-module!slides/web-storage.html?label=web-storage',["views/slide-container-view","utils/slide-module"], function(BaseView, TemplateModule) { return TemplateModule.create("<h2 class=\"title-margin\">Web Storage</h2>\r\n<ul class=\"bordered-list smaller-space\">\r\n    <li>Store user settings</li>\r\n    <li>Limited in size\r\n        <div class=\"small\">~ 2.5MB</div></li>\r\n    <li>Key/Value system</li>\r\n    <li>localStorage\r\n        <div class=\"small\">persistent across reloads</div>\r\n    </li>\r\n    <li>sessionStorage\r\n        <div class=\"small\">persistent per session</div>\r\n    </li>\r\n</ul>\r\n\r\n<div class=\"slide-link\">\r\n    <a data-view=\"mobileui/ui/link-view\" href=\"http://www.w3.org/TR/webstorage/\">http://www.w3.org/TR/webstorage/</a>\r\n</div>", BaseView, {"base":"views/slide-container-view","label":"web-storage"}); });

define('utils/slide-module!slides/touch-gestures.html?label=touch-gestures',["views/slide-container-view","utils/slide-module"], function(BaseView, TemplateModule) { return TemplateModule.create("<h2 class=\"title-margin\">Touch Gestures</h2>\r\n<div class=\"row\">\r\n    <div data-view=\"views/touch-hold-view\" class=\"cell3 touch-area\">\r\n        <div class=\"center\">\r\n            <h3>Tap &amp; Long Hold</h3>\r\n            <div class=\"touch-area-label\" data-view=\"mobileui/views/layer-view\" data-parent-name=\"contentView\"></div>\r\n        </div>\r\n    </div>\r\n    <div data-view=\"mobileui/views/pan-view\" class=\"cell3 touch-area\">\r\n        <div class=\"center\">\r\n            <h3>Drag</h3>\r\n        </div>\r\n    </div>\r\n    <div data-view=\"mobileui/views/transform-view\" class=\"cell3 touch-area\">\r\n        <div class=\"center\">\r\n            <h3>Pinch and zoom</h3>\r\n        </div>\r\n    </div>\r\n</div>", BaseView, {"base":"views/slide-container-view","label":"touch-gestures"}); });

define('utils/slide-module!slides/touch-combined.html?label=touch-combined',["views/slide-container-view","utils/slide-module"], function(BaseView, TemplateModule) { return TemplateModule.create("<h2 class=\"title-margin\">Touch Gestures</h2>\r\n\r\n<div class=\"row\">\r\n    <div data-view=\"mobileui/views/transform-view\" data-static-view class=\"cell3 touch-area-container\">\r\n        <div data-view=\"mobileui/views/pan-view\" data-static-view class=\"touch-area-inner\">\r\n            <div data-view=\"views/touch-hold-view\" data-static-view class=\"touch-area\">\r\n                <div class=\"center\">\r\n                    <h3>Combined</h3>\r\n                    <div class=\"touch-area-label\" data-view=\"mobileui/views/layer-view\" data-parent-name=\"contentView\"></div>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    </div>\r\n    <div data-view=\"mobileui/views/transform-view\" data-static-view class=\"cell3 touch-area-container\">\r\n        <div data-view=\"mobileui/views/pan-view\" data-static-view class=\"touch-area-inner\">\r\n            <div data-view=\"views/touch-hold-view\" data-static-view class=\"touch-area\">\r\n                <div class=\"center\">\r\n                    <h3>Combined</h3>\r\n                    <div class=\"touch-area-label\" data-view=\"mobileui/views/layer-view\" data-parent-name=\"contentView\"></div>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    </div>\r\n    <div data-view=\"mobileui/views/transform-view\" data-static-view class=\"cell3 touch-area-container\">\r\n        <div data-view=\"mobileui/views/pan-view\" data-static-view class=\"touch-area-inner\">\r\n            <div data-view=\"views/touch-hold-view\" data-static-view class=\"touch-area\">\r\n                <div class=\"center\">\r\n                    <h3>Combined</h3>\r\n                    <div class=\"touch-area-label\" data-view=\"mobileui/views/layer-view\" data-parent-name=\"contentView\"></div>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    </div>\r\n</div>", BaseView, {"base":"views/slide-container-view","label":"touch-combined"}); });

define('utils/slide-module!slides/touch-platforms.html?label=touch-platforms',["views/slide-container-view","utils/slide-module"], function(BaseView, TemplateModule) { return TemplateModule.create("<h2 class=\"title-margin\">Desktop &amp; Mobile</h2>\r\n\r\n<ul class=\"smaller-space bordered-list\">\r\n    <li class=\"title\">Abstraction layer</li>\r\n    <li class=\"small\">Mouse</li>\r\n    <li class=\"small\">Touch</li>\r\n    <li class=\"small\">\r\n        Pointers\r\n        <div class=\"small\">Only in IE10</div>\r\n    </li>\r\n</ul>\r\n\r\n<div class=\"slide-link\">\r\n    <a data-view=\"mobileui/ui/link-view\" href=\"http://www.w3.org/TR/touch-events/\">http://www.w3.org/TR/touch-events/</a>\r\n    <a data-view=\"mobileui/ui/link-view\" href=\"http://www.w3.org/TR/pointerevents/\">http://www.w3.org/TR/pointerevents/</a>\r\n</div>", BaseView, {"base":"views/slide-container-view","label":"touch-platforms"}); });

define('utils/slide-module!slides/accelerated-properties.html?label=accelerated-properties',["views/slide-container-view","utils/slide-module"], function(BaseView, TemplateModule) { return TemplateModule.create("<h2 class=\"title-margin\">Performance</h2>\r\n\r\n<ul class=\"smaller-space bordered-list\">\r\n    <li class=\"title\">Smooth Animations</li>\r\n    <li class=\"small\">transforms</li>\r\n    <li class=\"small\">opacity</li>\r\n    <li class=\"small\">filters</li>\r\n</ul>", BaseView, {"base":"views/slide-container-view","label":"accelerated-properties"}); });

define('utils/slide-module!slides/performance1.html?label=performance1',["views/slide-container-view","utils/slide-module"], function(BaseView, TemplateModule) { return TemplateModule.create("<h2 class=\"title-margin\">Performance</h2>\r\n\r\n<ul class=\"smaller-space bordered-list\">\r\n    <li class=\"title\">Layout</li>\r\n    <li class=\"small\">Absolute positioning</li>\r\n    <li class=\"small\">Children count per element</li>\r\n    <li class=\"small\">Avoid box-shadows on dynamic content</li>\r\n    <li class=\"small\">Avoid layout readbacks\r\n        <div class=\"small\">(e.g. clientWidth/clientHeight)</div>\r\n    </li>\r\n</ul>\r\n\r\n<ul class=\"smaller-space bordered-list\">\r\n    <li class=\"title\">Lazy CSS changes</li>\r\n    <li class=\"small\">Apply CSS in single step</li>\r\n    <li class=\"small\">Use requestAnimationFrame</li>\r\n</ul>", BaseView, {"base":"views/slide-container-view","label":"performance1"}); });

define('utils/slide-module!slides/performance2.html?label=performance2',["views/slide-container-view","utils/slide-module"], function(BaseView, TemplateModule) { return TemplateModule.create("<h2 class=\"title-margin\">Performance</h2>\r\n\r\n<ul class=\"smaller-space bordered-list\">\r\n    <li class=\"title\">CSS Selector</li>\r\n    <li class=\"small\">Use specific class names</li>\r\n    <li class=\"small\">Avoid deep indirect ancestors\r\n        <div class=\"small\">(e.g. body.state .my-object { })</div>\r\n    </li>\r\n    <li class=\"small\">Avoid generic selectors\r\n        <div class=\"small\">(e.g. .calendar-view div { })</div>\r\n    </li>\r\n    <li class=\"small\">Sibling selectors are expensive</li>\r\n</ul>", BaseView, {"base":"views/slide-container-view","label":"performance2"}); });

define('utils/slide-module!slides/performance3.html?label=performance3',["views/slide-container-view","utils/slide-module"], function(BaseView, TemplateModule) { return TemplateModule.create("<h2 class=\"title-margin\">Performance</h2>\r\n\r\n<ul class=\"smaller-space bordered-list\">\r\n    <li class=\"title\">3D transforms</li>\r\n    <li class=\"small\">Paint cache</li>\r\n    <li class=\"small\">Use with \"opacity\" and \"filter\"</li>\r\n    <li class=\"small\">Avoid switching non-3D to 3D</li>\r\n    <li class=\"small\">Avoid changing z-index\r\n        <div class=\"small\">transform-style: preserve-3d</div>\r\n    </li>\r\n</ul>", BaseView, {"base":"views/slide-container-view","label":"performance3"}); });

define('utils/slide-module!slides/dom-remove.html?label=dom-remove',["views/slide-container-view","utils/slide-module"], function(BaseView, TemplateModule) { return TemplateModule.create("<h2 class=\"title-margin\">Performance</h2>\r\n\r\n<ul class=\"smaller-space bordered-list\">\r\n    <li class=\"title\">Removing content</li>\r\n    <li class=\"small gauge-view-container\">Removing from DOM\r\n        <div class=\"gauge-view val4-gauge-view\"><div class=\"gauge-view-indicator\"></div></div>\r\n        <div class=\"small\">No memory</div>\r\n    </li>\r\n    <li class=\"small gauge-view-container\">display: none\r\n        <div class=\"gauge-view val3-gauge-view\"><div class=\"gauge-view-indicator\"></div></div>\r\n        <div class=\"small\">DOM memory</div>\r\n    </li>\r\n    <li class=\"small gauge-view-container\">visibility: hidden\r\n        <div class=\"gauge-view val2-gauge-view\"><div class=\"gauge-view-indicator\"></div></div>\r\n        <div class=\"small\">Layout memory</div>\r\n    </li>\r\n    <li class=\"small gauge-view-container\">opacity: 0\r\n        <div class=\"gauge-view val1-gauge-view\"><div class=\"gauge-view-indicator\"></div></div>\r\n        <div class=\"small\">GPU memory</div>\r\n    </li>\r\n</ul>", BaseView, {"base":"views/slide-container-view","label":"dom-remove"}); });

define('utils/slide-module!slides/web-workers.html?label=web-workers',["views/slide-container-view","utils/slide-module"], function(BaseView, TemplateModule) { return TemplateModule.create("<h2 class=\"title-margin\">Worker Threads</h2>\r\n\r\n<ul class=\"smaller-space bordered-list\">\r\n    <li class=\"small\">Message passing</li>\r\n    <li class=\"small\">Cross-compile\r\n        <div class=\"small\"><a data-view=\"mobileui/ui/link-view\" href=\"http://emscripten.org/\">Emscripten</a></div>\r\n    </li>\r\n    <li class=\"small\">Asynchronous</li>\r\n</ul>\r\n\r\n<div class=\"slide-link\">\r\n    <a data-view=\"mobileui/ui/link-view\" href=\"http://www.w3.org/TR/workers/\">http://www.w3.org/TR/workers/</a>\r\n</div>", BaseView, {"base":"views/slide-container-view","label":"web-workers"}); });

define('utils/slide-module!slides/end.html?label=end',["views/slide-container-view","utils/slide-module"], function(BaseView, TemplateModule) { return TemplateModule.create("<div class=\"center\">\r\n    <h1>Thanks!</h1>\r\n    <ul>\r\n        <li><a data-view=\"mobileui/ui/link-view\" href=\"http://blogs.adobe.com/webplatform\">blogs.adobe.com/webplatform</a></li>\r\n        <li><a data-view=\"mobileui/ui/link-view\" href=\"https://twitter.com/achicu\">@achicu</a></li>\r\n    </ul>\r\n    <br />\r\n    <img src=\"images/adobe.png\" />\r\n</div>", BaseView, {"base":"views/slide-container-view","label":"end"}); });

/*
 * Copyright (c) 2013 Adobe Systems Incorporated. All rights reserved.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
define('slides/list',["utils/slide-module!slides/index.html?label=index",
        "utils/slide-module!slides/about-me.html?label=about-me",
        "utils/slide-module!slides/intro.html?label=intro",
        "utils/slide-module!slides/demos.html?label=demos",
        "utils/slide-module!slides/web-features.html?label=web-features",
        "utils/slide-module!slides/app-cache.html?label=app-cache",
        "utils/slide-module!slides/web-storage.html?label=web-storage",
        "utils/slide-module!slides/touch-gestures.html?label=touch-gestures",
        "utils/slide-module!slides/touch-combined.html?label=touch-combined",
        "utils/slide-module!slides/touch-platforms.html?label=touch-platforms",
        "utils/slide-module!slides/accelerated-properties.html?label=accelerated-properties",
        "utils/slide-module!slides/performance1.html?label=performance1",
        "utils/slide-module!slides/performance2.html?label=performance2",
        "utils/slide-module!slides/performance3.html?label=performance3",
        "utils/slide-module!slides/dom-remove.html?label=dom-remove",
        "utils/slide-module!slides/web-workers.html?label=web-workers",
        "utils/slide-module!slides/end.html?label=end"
       ], function() {
    var list = _.toArray(arguments);
    _.each(list, function(View, i) {
        View.index = i;
    });
    return list;
});
/*
 * Copyright (c) 2013 Adobe Systems Incorporated. All rights reserved.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

define('utils/slide-manager',["mobileui/utils/bus", "slides/list"], function(bus, SlideList) {

    function SlideManager() {
    }

    _.extend(SlideManager.prototype, {
        createSlide: function(ViewItem) {
            return new ViewItem().render();
        },

        lookupSlide: function(label) {
            var ViewItem = _.find(SlideList, function(item) {
                return item.label == label;
            });
            return ViewItem;
        },

        lookupNextSlide: function(view) {
            var index = _.indexOf(SlideList, view.constructor);
            return index == -1 ? SlideList[0] : SlideList[index + 1];
        },

        hasNextSlide: function(view) {
            return !!this.lookupNextSlide(view);
        },

        lookupPreviousSlide: function(view) {
            var index = _.indexOf(SlideList, view.constructor);
            return index == -1 ? null : SlideList[index - 1];
        },

        hasPreviousSlide: function(view) {
            return !!this.lookupPreviousSlide(view);
        }
    });

    var slideManager = new SlideManager();
    bus.set("slideManager", slideManager);
    return slideManager;

});
/*
 * Copyright (c) 2013 Adobe Systems Incorporated. All rights reserved.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

define('mobileui/utils/rect',[],function() {

    var Rect = function() {
        this._x = 0;
        this._y = 0;
        this._width = 0;
        this._height = 0;
    };

    Rect.prototype = _.extend({}, Backbone.Events, {
        isEmpty: function() {
            return !this._width && !this._height;
        },

        x: function() { return this._x; },
        y: function() { return this._y; },
        width: function() { return this._width; },
        height: function() { return this._height; },

        right: function() { return this._x + this._width; },
        bottom: function() { return this._y + this._height; },

        setX: function(x) { this._x = x; this._changedPosition(); return this; },
        setY: function(y) { this._y = y; this._changedPosition(); return this; },

        setWidth: function(width) { this._width = width; this._changedSize(); return this; },
        setHeight: function(height) { this._height = height; this._changedSize(); return this; },

        centerX: function() {
            return this._x + this._width / 2;
        },

        centerY: function() {
            return this._y + this._height / 2;
        },

        setPosition: function(x, y) {
            this._x = x;
            this._y = y;
            this._changedPosition();
            return this;
        },

        setSize: function(width, height) {
            this._width = width;
            this._height = height;
            this._changedSize();
            return this;
        },

        set: function(bounds) {
            var positionChanged = 
                this._x != bounds.x() ||
                this._y != bounds.y();
            var sizeChanged = 
                this._width != bounds.width() ||
                this._height != bounds.height();
            if (!positionChanged && !sizeChanged)
                return;
            this._x = bounds.x();
            this._y = bounds.y();
            this._width = bounds.width();
            this._height = bounds.height();
            
            if (positionChanged)
                this.trigger("change:position");
            if (sizeChanged)
                this.trigger("change:size");
            this.trigger("change");
            return this;
        },

        alignRight: function(right) {
            return this.setX(right - this.width());
        },

        alignBottom: function(bottom) {
            return this.setY(bottom - this.height());
        },

        _changedPosition: function() {
            this.trigger("change:position");
            this.trigger("change");
        },

        _changedSize: function() {
            this.trigger("change:size");
            this.trigger("change");
        }

    });

    return Rect;
});
/*
 * Copyright (c) 2013 Adobe Systems Incorporated. All rights reserved.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

define('mobileui/utils/transform',[],function() {

    function matrixKeyGenerator(parameters) {
        return _.map(parameters, function(name, i) {
            return i;
        });
    }

    function generateFunction(name, parameters, units, defaultValues, is3DTransform, keysGenerator) {
        if (!_.isArray(parameters))
            parameters = parameters.split(" ");
        var keys = keysGenerator ? keysGenerator(parameters) : _.map(parameters, function(name) {
            return "_" + name;
        });
        var fn = function() {
            var self = this, args = arguments;
            _.each(parameters, function(parameter, i) {
                self[keys[i]] = (i < args.length) ? args[i] : defaultValues[i];
            });
        };
        _.extend(fn, {
            create: function() {
                var self = new fn(), args = arguments;
                _.each(parameters, function(parameter, i) {
                    self[keys[i]] = (i < args.length) ? args[i] : defaultValues[i];
                });
                return self;
            },
            defaultValue: new fn()
        });
        _.extend(fn.prototype, Backbone.Events, {
            type: fn,
            is3DTransform: is3DTransform,
            toString: function() {
                var self = this, args = [];
                _.each(parameters, function(parameter, i) {
                    args.push(self[keys[i]].toFixed(6) + units);
                });
                return name + "(" + args.join(", ") + ")";
            },
            blend: function(percent, other) {
                var result = new fn();
                var self = this;
                _.each(parameters, function(parameter, i) {
                    result[keys[i]] = self[keys[i]] * (1 - percent) + other[keys[i]] * percent;
                });
                return result;
            },
            multiply: function(percent) {
                var result = new fn();
                var self = this;
                _.each(parameters, function(parameter, i) {
                    result[keys[i]] = self[keys[i]] * percent;
                });
                return result;
            },
            clone: function() {
                var result = new fn(), self = this;
                _.each(parameters, function(parameter, i) {
                    result[keys[i]] = self[keys[i]];
                });
                return result;
            },
            _onValueChanged: function() {
                this.trigger("change");
            }
        });
        _.each(parameters, function(parameter, i) {
            fn.prototype["set" + _.string.capitalize(parameter)] = function(value) {
                if (value == this[keys[i]])
                    return this;
                this[keys[i]] = value;
                this._onValueChanged();
                return this;
            };
            fn.prototype["add" + _.string.capitalize(parameter)] = function(value) {
                this[keys[i]] += value;
                this._onValueChanged();
                return this;
            };
            fn.prototype["mul" + _.string.capitalize(parameter)] = function(value) {
                this[keys[i]] *= value;
                this._onValueChanged();
                return this;
            };
            fn.prototype[parameter] = function() {
                return this[keys[i]];
            };
        });
        return fn;
    }

    var Transforms = {
        rotate: generateFunction("rotate", "angle", "deg", [0], false),
        rotateX: generateFunction("rotateX", "angle", "deg", [0], true),
        rotateY: generateFunction("rotateY", "angle", "deg", [0], true),
        rotateZ: generateFunction("rotateZ", "angle", "deg", [0], false),
        translate: generateFunction("translate", "x y", "px", [0, 0], false),
        translateX: generateFunction("translateX", "x", "px", [0], false),
        translateY: generateFunction("translateY", "y", "px", [0], false),
        translateZ: generateFunction("translateZ", "z", "px", [0], true),
        translate3d: generateFunction("translate3d", "x y z", "px", [0, 0, 0], true),
        scale: generateFunction("scale", "x y", "", [1, 1], false),
        perspective: generateFunction("perspective", "depth", "", [1000], true),
        matrix: generateFunction("matrix", "a b c d e f", "", [1, 0, 0, 1, 0, 0], false, matrixKeyGenerator),
        matrix3d: generateFunction("matrix3d",
            "a11 a21 a31 a41 a12 a22 a32 a42 a13 a23 a33 a43 a14 a24 a34 a44", "",
            [1, 0, 0, 0,  0, 1, 0, 0,  0, 0, 1, 0,  0, 0, 0, 1],
            true, matrixKeyGenerator)
    };

    var Transform = function() {
        if (!(this instanceof Transform))
            return new Transform();
        this._data = [];
    };

    _.extend(Transform.prototype, Backbone.Events, {
        search: function(type) {
            if (_.isString(type))
                type = Transforms[type];
            var data = this._data;
            for (var i = 0; i < data.length; ++i)
                if (data[i].type === type)
                    return data[i];
            return null;
        },

        get: function(type) {
            if (_.isString(type))
                type = Transforms[type];
            var fn = this.search(type);
            if (!fn) {
                fn = type.create();
                this.append(fn);
            }
            return fn;
        },

        isEmpty: function() {
            return !this._data.length;
        },

        append: function(fn) {
            fn.on("change", this._onFunctionValueChange, this);
            this._data.push(fn);
            this._onFunctionValueChange();
            return this;
        },

        insert: function(fn, i) {
            fn.on("change", this._onFunctionValueChange, this);
            this._data.splice(i, 0, fn);
            this._onFunctionValueChange();
            return this;
        },

        remove: function(fn) {
            var index = this._data.indexOf(fn);
            if (index == -1)
                return this;
            fn.off("change", this._onFunctionValueChange, this);
            this._data.splice(i, 1);
            this._onFunctionValueChange();
            return this;
        },

        clear: function() {
            if (!this._data.length)
                return this;
            _.each(this._data, function(fn) {
                fn.off("change", self._onFunctionValueChange, self);
            });
            this._data = [];
            this._onFunctionValueChange();
            return this;
        },

        set: function(other) {
            var self = this;
            _.each(this._data, function(fn) {
                fn.off("change", self._onFunctionValueChange, self);
            });
            this._data = [];
            _.each(other._data, function(fn) {
                self.append(fn.clone());
            });
            this._onFunctionValueChange();
        },

        take: function(other) {
            var self = this;
            _.each(this._data, function(fn) {
                fn.off("change", self._onFunctionValueChange, self);
            });
            this._data = other._data;
            other._data = [];
            _.each(this._data, function(fn) {
                fn.off("change", other._onFunctionValueChange, other);
                fn.on("change", self._onFunctionValueChange, self);
            });
            other._onFunctionValueChange();
            this._onFunctionValueChange();
        },

        has3DTransforms: function() {
            return _.some(this._data, function(fn, i) {
                return fn.is3DTransform;
            });
        },

        toString: function() {
            return this._data.join(" ");
        },

        toMatrix: function() {
            var matrix = Matrix.I(4);
            _.each(this._data, function(fn) {
                matrix = matrix.multiply(fn.toMatrix());
            });
            return matrix;
        },

        toMatrix3d: function() {
            return Transform.matrix3d.fromMatrix(this.toMatrix());
        },

        _onFunctionValueChange: function() {
            this.trigger("change");
        },

        clone: function() {
            var transform = new Transform();
            _.each(this._data, function(fn) {
                transform.append(fn.clone());
            });
            return transform;
        },

        canBlendFunctionsWith: function(other) {
            if (other._data.length != this._data.length)
                return false;
            return _.every(this._data, function(fn, i) {
                return fn.type === other._data[i].type;
            });
        },

        _zeroBlend: function(percent) {
            var transform = new Transform();
            _.each(this._data, function(fn, i) {
                transform.append(fn.blend(percent, fn.type.defaultValue));
            });
            return transform;
        },

        blend: function(percent, other) {
            if (!this._data.length)
                return other._zeroBlend(1 - percent);
            if (!other._data.length)
                return this._zeroBlend(percent);
            var transform = new Transform();
            if (this.canBlendFunctionsWith(other)) {
                _.each(this._data, function(fn, i) {
                    transform.append(fn.blend(percent, other._data[i]));
                });
            } else {
                var matrix = new Transforms.matrix3d();
                matrix.fromMatrix(this.toMatrix().multiply(percent)
                    .add(other.toMatrix().multiply(1 - percent)));
                transform.append(matrix);
            }
            return transform;
        },

        appendFrom: function(other) {
            var self = this;
            _.each(other._data, function(fn) {
                self.append(fn);
            });
            return this;
        },

        concat: function(other) {
            var transform = new Transform();
            _.each(this._data, function(fn) {
                transform.append(fn);
            });
            _.each(other._data, function(fn) {
                transform.append(fn);
            });
            return transform;
        }
    });

    _.extend(Transform, Transforms, {
        rads: function(degs) {
            return degs * Math.PI / 180;
        },

        degs: function(rads) {
            return rads * 180 / Math.PI;
        }
    });

    _.each(Transforms, function(type, name) {
        Transform.prototype[name] = function() {
            var fn = type.create.apply(null, Array.prototype.slice.call(arguments));
            this.append(fn);
            return this;
        };
    });

    function rotationMatrix3d(rad, x, y, z) {
        var halfRad = rad / 2,
            radSin = Math.sin(halfRad),
            sc = radSin * Math.cos(halfRad),
            sq = radSin * radSin;
        return Matrix.create([
            [1 - 2 * (y * y + z * z) * sq, 
                2 * (x * y * sq - z * sc),
                    2 * (x * z * sq + y * sc), 0],
            [2 * (x * y * sq + z * sc),
                1 - 2 * (x * x + z * z) * sq,
                    2 * (y * z * sq - x * sq), 0],
            [2 * (x * z *sq - y * sc),
                2 * (y * z * sq + x * sc),
                    1 - 2 * (x * x + y * y) * sq, 0],
            [0, 0, 0, 1]
        ]);
    }

    function rotationMatrixAxis(rad, axis) {
        return rotationMatrix3d(rad, axis[0], axis[1], axis[2]);
    }

    _.extend(Transform.rotate.prototype, {
        vector: [0, 0, 1],
        toMatrix: function() {
            return rotationMatrixAxis(Transform.rads(this.angle()), this.vector);
        }
    });

    _.extend(Transform.rotateX.prototype, {
        vector: [1, 0, 0],
        toMatrix: function() {
            return rotationMatrixAxis(Transform.rads(this.angle()), this.vector);
        }
    });

    _.extend(Transform.rotateY.prototype, {
        vector: [0, 1, 0],
        toMatrix: function() {
            return rotationMatrixAxis(Transform.rads(this.angle()), this.vector);
        }
    });

    _.extend(Transform.rotateZ.prototype, {
        vector: [0, 0, 1],
        toMatrix: function() {
            return rotationMatrixAxis(Transform.rads(this.angle()), this.vector);
        }
    });

    _.extend(Transform.translate.prototype, {
        toMatrix: function() {
            return Matrix.create([
                [1, 0, 0, this.x()],
                [0, 1, 0, this.y()],
                [0, 0, 1, 0],
                [0, 0, 0, 1]
            ]);
        }
    });

    _.extend(Transform.translateX.prototype, {
        toMatrix: function() {
            return Matrix.create([
                [1, 0, 0, this.x()],
                [0, 1, 0, 0],
                [0, 0, 1, 0],
                [0, 0, 0, 1]
            ]);
        }
    });

    _.extend(Transform.translateY.prototype, {
        toMatrix: function() {
            return Matrix.create([
                [1, 0, 0, 0],
                [0, 1, 0, this.y()],
                [0, 0, 1, 0],
                [0, 0, 0, 1]
            ]);
        }
    });

    _.extend(Transform.translateZ.prototype, {
        toMatrix: function() {
            return Matrix.create([
                [1, 0, 0, 0],
                [0, 1, 0, 0],
                [0, 0, 1, this.z()],
                [0, 0, 0, 1]
            ]);
        }
    });

    _.extend(Transform.translate3d.prototype, {
        toMatrix: function() {
            return Matrix.create([
                [1, 0, 0, this.x()],
                [0, 1, 0, this.y()],
                [0, 0, 1, this.z()],
                [0, 0, 0, 1]
            ]);
        }
    });

    _.extend(Transform.perspective.prototype, {
        toMatrix: function() {
            return Matrix.create([
                [1, 0, 0, 0],
                [0, 1, 0, 0],
                [0, 0, 1, 0],
                [0, 0, -1 / this.depth(), 1]
            ]);
        }
    });

    _.extend(Transform.scale.prototype, {
        toMatrix: function() {
            return Matrix.create([
                [this.x(), 0, 0, 0],
                [0, this.y(), 0, 0],
                [0, 0, 1, 0],
                [0, 0, 0, 1]
            ]);
        }
    });

    _.extend(Transform.matrix3d.prototype, {
        toMatrix: function() {
            return Matrix.create([
                [this.a(), this.c(), 0, this.e()],
                [this.b(), this.d(), 0, this.f()],
                [0, 0, 1, 0],
                [0, 0, 0, 1]
            ]);
        },
        fromMatrix: function(m) {
            this.setA(m.e(1, 1))
                .setB(m.e(2, 1))
                .setC(m.e(1, 2))
                .setD(m.e(2, 2))
                .setE(m.e(1, 4))
                .setF(m.e(2, 4));
            return this;
        }
    });

    Transform.matrix.fromMatrix = function(matrix) {
        var fn = new Transform.matrix();
        fn.fromMatrix(matrix);
        return fn;
    };

    _.extend(Transform.matrix3d.prototype, {
        toMatrix: function() {
            return Matrix.create([
                [this.a11(), this.a12(), this.a13(), this.a14()],
                [this.a21(), this.a22(), this.a23(), this.a24()],
                [this.a31(), this.a32(), this.a33(), this.a34()],
                [this.a41(), this.a42(), this.a43(), this.a44()]
            ]);
        },
        fromMatrix: function(m) {
            var index = 0, changed = false;
            for (var j = 1; j <= 4; ++j) {
                for (var i = 1; i <= 4; ++i, index++) {
                    var value = m.e(i, j);
                    if (this[index] === value)
                        continue;
                    this[index] = value;
                    changed = true;
                }
            }
            if (this.changed)
                this._onValueChanged();
            return this;
        }
    });

    Transform.matrix3d.fromMatrix = function(matrix) {
        var fn = new Transform.matrix3d();
        fn.fromMatrix(matrix);
        return fn;
    };


    return Transform;

});
/*
 * Copyright (c) 2013 Adobe Systems Incorporated. All rights reserved.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

define('mobileui/utils/filter',[],function() {

    function customFilterGenerator(template) {
        return function(fn, keys) {
            var index = 0;
            return _.map(template, function(value) {
                if (value.charAt(0) == "?")
                    return fn[keys[index++]].toFixed(6);
                return value;
            }).join("");
        };
    }

    function generateFunction(name, parameters, units) {
        if (!_.isArray(parameters))
            parameters = parameters.split(" ");
        var cssGeneartor;
        if (_.isFunction(units))
            cssGeneartor = units;
        var keys = _.map(parameters, function(name) {
            return "_" + name;
        });
        var fn = function() {
            var self = this, args = arguments;
            _.each(parameters, function(parameter, i) {
                self[keys[i]] = (i < args.length) ? args[i] : 0;
            });
        };
        _.extend(fn, {
            create: function() {
                var self = new fn(), args = arguments;
                _.each(parameters, function(parameter, i) {
                    self[keys[i]] = (i < args.length) ? args[i] : 0;
                });
                return self;
            }
        });
        _.extend(fn.prototype, Backbone.Events, {
            type: fn,
            toString: function() {
                if (cssGeneartor)
                    return cssGeneartor(this, keys);
                var self = this, args = [];
                _.each(parameters, function(parameter, i) {
                    args.push(self[keys[i]].toFixed(6) + units);
                });
                return name + "(" + args.join(", ") + ")";
            },
            blend: function(percent, other) {
                var result = new fn();
                var self = this;
                _.each(parameters, function(parameter, i) {
                    var currentValue = self[keys[i]];
                    if (_.isString(currentValue)) {
                        result[keys[i]] = currentValue;
                        return;
                    }
                    result[keys[i]] = currentValue * (1 - percent) + other[keys[i]] * percent;
                });
                return result;
            },
            multiply: function(percent) {
                var result = new fn();
                var self = this;
                _.each(parameters, function(parameter, i) {
                    result[keys[i]] = self[keys[i]] * percent;
                });
                return result;
            },
            clone: function() {
                var result = new fn(), self = this;
                _.each(parameters, function(parameter, i) {
                    result[keys[i]] = self[keys[i]];
                });
                return result;
            },
            _onValueChanged: function() {
                this.trigger("change");
            }
        });
        _.each(parameters, function(parameter, i) {
            fn.prototype["set" + _.string.capitalize(parameter)] = function(value) {
                if (value == this[keys[i]])
                    return this;
                this[keys[i]] = value;
                this._onValueChanged();
                return this;
            };
            fn.prototype["add" + _.string.capitalize(parameter)] = function(value) {
                this[keys[i]] += value;
                this._onValueChanged();
                return this;
            };
            fn.prototype["mul" + _.string.capitalize(parameter)] = function(value) {
                this[keys[i]] *= value;
                this._onValueChanged();
                return this;
            };
            fn.prototype[parameter] = function() {
                return this[keys[i]];
            };
        });
        return fn;
    }

    var Filters = {
        blur: generateFunction("blur", "radius", "px"),
        brightness: generateFunction("brightness", "intensity", "%"),
        grayscale: generateFunction("grayscale", "intensity", "%"),
        opacity: generateFunction("opacity", "intensity", "%"),
        dropShadow: generateFunction("drop-shadow", "x y radius color", function(fn) {
            return "drop-shadow(" + fn._x.toFixed(6) + "px " + fn._y.toFixed(6) + "px " + fn._radius.toFixed(6) + "px rgba(0, 0, 0, " + 
                fn._color + "))";
        })
    };

    var Filter = function() {
        if (!(this instanceof Filter))
            return new Filter();
        this._data = [];
    };

    _.extend(Filter.prototype, Backbone.Events, {
        search: function(type) {
            if (_.isString(type))
                type = Filters[type];
            var data = this._data;
            for (var i = 0; i < data.length; ++i)
                if (data[i].type === type)
                    return data[i];
            return null;
        },

        get: function(type) {
            if (_.isString(type))
                type = Filters[type];
            var fn = this.search(type);
            if (!fn) {
                fn = type.create();
                this.append(fn);
            }
            return fn;
        },

        isEmpty: function() {
            return !this._data.length;
        },

        append: function(fn) {
            fn.on("change", this._onFunctionValueChange, this);
            this._data.push(fn);
            this._onFunctionValueChange();
            return this;
        },

        insert: function(fn, i) {
            fn.on("change", this._onFunctionValueChange, this);
            this._data.splice(i, 0, fn);
            this._onFunctionValueChange();
            return this;
        },

        remove: function(fn) {
            var index = this._data.indexOf(fn);
            if (index == -1)
                return this;
            fn.off("change", this._onFunctionValueChange, this);
            this._data.splice(i, 1);
            this._onFunctionValueChange();
            return this;
        },

        clear: function() {
            _.each(this._data, function(fn) {
                fn.off("change", self._onFunctionValueChange, self);
            });
            this._data = [];
            this._onFunctionValueChange();
            return this;
        },

        set: function(other) {
            var self = this;
            _.each(this._data, function(fn) {
                fn.off("change", self._onFunctionValueChange, self);
            });
            this._data = [];
            _.each(other._data, function(fn) {
                self.append(fn.clone());
            });
            this._onFunctionValueChange();
        },

        take: function(other) {
            var self = this;
            _.each(this._data, function(fn) {
                fn.off("change", self._onFunctionValueChange, self);
            });
            this._data = other._data;
            other._data = [];
            _.each(this._data, function(fn) {
                fn.off("change", other._onFunctionValueChange, other);
                fn.on("change", self._onFunctionValueChange, self);
            });
            other._onFunctionValueChange();
            this._onFunctionValueChange();
        },

        toString: function() {
            return this._data.join(" ");
        },

        toMatrix: function() {
            var matrix = Matrix.I(4);
            _.each(this._data, function(fn) {
                matrix = matrix.multiply(fn.toMatrix());
            });
            return matrix;
        },

        toMatrix3d: function() {
            return Filter.matrix3d.fromMatrix(this.toMatrix());
        },

        _onFunctionValueChange: function() {
            this.trigger("change");
        },

        clone: function() {
            var filter = new Filter();
            _.each(this._data, function(fn) {
                filter.append(fn.clone());
            });
            return filter;
        },

        canBlendFunctionsWith: function(other) {
            if (other._data.length != this._data.length)
                return false;
            return _.every(this._data, function(fn, i) {
                return fn.type === other._data[i].type;
            });
        },

        _fromZeroBlend: function(percent, other) {
            var filter = new Filter();
            _.each(other._data, function(fn, i) {
                filter.append(fn.multiply(percent));
            });
            return filter;
        },

        _toZeroBlend: function(percent) {
            var filter = new Filter();
            _.each(this._data, function(fn, i) {
                filter.append(fn.multiply(percent));
            });
            return filter;
        },

        blend: function(percent, other) {
            if (!this._data.length)
                return this._fromZeroBlend(percent, other);
            if (!other._data.length)
                return this._toZeroBlend(1 - percent);
            var filter = new Filter();
            if (this.canBlendFunctionsWith(other)) {
                _.each(this._data, function(fn, i) {
                    filter.append(fn.blend(percent, other._data[i]));
                });
            } else {
                // no alternative?
            }
            return filter;
        },

        concat: function(other) {
            var filter = new Filter();
            _.each(this._data, function(fn) {
                filter.append(fn);
            });
            _.each(other._data, function(fn) {
                filter.append(fn);
            });
            return filter;
        }
    });

    function injectCSSFilterShorthand(name, type) {
        Filter.prototype[name] = function() {
            var fn = type.create.apply(null, Array.prototype.slice.call(arguments));
            this.append(fn);
            return this;
        };
    }

    _.extend(Filter, Filters, {
        registerCustomFilter: function(name, parameters, cssGenerator) {
            var type = Filters[name] = generateFunction(name, parameters, cssGenerator);
            injectCSSFilterShorthand(name, type);
            return type;
        },
        createCustomFilterGenerator: customFilterGenerator,

        // FIXME: Using the PrefixFree.prefixProperty as a workaround for the the 
        // "filter" property issue in PrefixFree & WebKit.
        // https://github.com/LeaVerou/prefixfree/issues/76
        propertyName: PrefixFree.prefixProperty("filter"),
        camelCasePropertyName: PrefixFree.prefixProperty("filter", true)
    });

    function detectFilterSupport(filter, checker) {
        var style = document.createElement("div").style;
        if (!(Filter.camelCasePropertyName in style))
            return false;
        style[Filter.camelCasePropertyName] = filter;
        var value = style[Filter.camelCasePropertyName];
        return value ? checker.test(value) : false;
    }
    Filter.supportsCustomFilters = detectFilterSupport("custom(url(empty))", /^custom\(/);

    _.each(Filters, function(type, name) {
        injectCSSFilterShorthand(name, type);
    });

    return Filter;

});
/*
 * Copyright (c) 2013 Adobe Systems Incorporated. All rights reserved.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

define('mobileui/utils/outsets',[],function() {

    var Outsets = function() {
        this._left = 0;
        this._top = 0;
        this._right = 0;
        this._bottom = 0;
    };

    Outsets.prototype = _.extend({}, Backbone.Events, {
        
        left: function() { return this._left; },
        top: function() { return this._top; },
        right: function() { return this._right; },
        bottom: function() { return this._bottom; },

        horizontal: function() { return this._left + this._right; },
        vertical: function() { return this._top + this._bottom; },

        setLeft: function(left) { this._left = left; this._changedHorizontal(); return this; },
        setRight: function(right) { this._right = right; this._changedHorizontal(); return this; },

        setTop: function(top) { this._top = top; this._changedVertical(); return this; },
        setBottom: function(bottom) { this._bottom = bottom; this._changedVertical(); return this; },

        setAll: function(value) {
            var verticalChanged =
                this._left != value ||
                this._right != value;
            var horizontalChanged =
                this._top != value ||
                this._bottom != value;
            if (!verticalChanged && !horizontalChanged)
                return;
            this._left = value;
            this._right = value;
            this._top = value;
            this._bottom = value;

            if (verticalChanged)
                this.trigger("change:vertical");
            if (horizontalChanged)
                this.trigger("change:horizontal");
            this.trigger("change");
            return this;
        },

        set: function(other) {
            var verticalChanged =
                this._left != other.left() ||
                this._right != other.right();
            var horizontalChanged =
                this._top != other.top() ||
                this._bottom != other.bottom();
            if (!verticalChanged && !horizontalChanged)
                return;
            this._left = bounds.left();
            this._right = bounds.right();
            this._top = bounds.top();
            this._bottom = bounds.bottom();

            if (verticalChanged)
                this.trigger("change:vertical");
            if (horizontalChanged)
                this.trigger("change:horizontal");
            this.trigger("change");
            return this;
        },

        toCSSString: function(units) {
            return [
                this._top + units,
                this._right + units,
                this._bottom + units,
                this._left + units
            ].join(" ");
        },

        _changedHorizontal: function() {
            this.trigger("change:horizontal");
            this.trigger("change");
        },

        _changedVertical: function() {
            this.trigger("change:vertical");
            this.trigger("change");
        }

    });

    return Outsets;
});
/*
 * Copyright (c) 2013 Adobe Systems Incorporated. All rights reserved.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

define('mobileui/utils/time',["mobileui/utils/boilerplate"], function(boilerplate) {

    var now = function() { return Date.now(); };

    var performance = boilerplate.lookupPrefix(window, "performance");
    if (performance) {
        var performanceNow = boilerplate.lookupPrefix(performance, "now");
        if (performanceNow) {
            now = function() {
                return performanceNow.call(performance);
            };
        }
    }

    return {
        now: now
    };

});
/*
 * Copyright (c) 2013 Adobe Systems Incorporated. All rights reserved.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

define('mobileui/utils/request-animation-frame',["mobileui/utils/boilerplate"], function(boilerplate) {

    var requestAnimationFrame = boilerplate.lookupPrefix(window, "requestAnimationFrame");
    if (!requestAnimationFrame) {
        requestAnimationFrame = function(fn) {
            return setTimeout(fn, 0);
        };
    }

    var requestedCallbacks = null;
    var hadDOMUpdates = false;
    var waitingNewLoop = false;

    function requestUpdate() {
        if (waitingNewLoop)
            return;
        waitingNewLoop = true;
        requestAnimationFrame(update);
    }

    var fn = _.extend(function(callback) {
        if (!requestedCallbacks) {
            requestedCallbacks = [];
            requestUpdate();
        }
        if (callback)
            requestedCallbacks.push(callback);
    }, Backbone.Events, {
        run: function() {
            requestUpdate();
        },
        setHadDOMUpdates: function() {
            hadDOMUpdates = true;
        },
        runInlinesIfNeeded: function() {
            if (hadDOMUpdates)
                update();
        }
    });

    function update() {
        waitingNewLoop = false;
        fn.trigger("layout");
        fn.trigger("animation");
        while (requestedCallbacks && requestedCallbacks.length) {
            var callbacks = requestedCallbacks;
            requestedCallbacks = null;
            _.each(callbacks, function(fn) {
                fn();
            });
        }
        hadDOMUpdates = false;
        fn.trigger("after");
    }

    return fn;
});
/*
 * Copyright (c) 2013 Adobe Systems Incorporated. All rights reserved.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

define('mobileui/utils/animations/animation-controller',["mobileui/utils/time",
        "mobileui/utils/request-animation-frame"], function(Time, requestAnimationFrame) {

    var frameRateInterval = 1000 / 60,
        maxRequestAnimationFrameDuration = frameRateInterval * 1.5;

    var AnimationState = function() {
        this.time = -1;
        this.previousTime = -1;
        this._nextInterval = -1;
        this._setStarted = false;
        this._stateValues = {};
        this._pendingCommit = false;
    };

    _.extend(AnimationState.prototype, {
        updateTime: function() {
            this.previousTime = this.time;
            this.time = Time.now();
            this.delta = (this.previousTime >= 0) ? this.time - this.previousTime : 0;
            this._nextInterval = -1;
        },

        prepareSet: function() {
            this._setStarted = false;
        },

        isSetActive: function() {
            return this._setStarted;
        },

        nextInterval: function() {
            if (this._nextInterval == -1)
                return -1;
            return Math.max(0, this._nextInterval - (Time.now() - this.time));
        },

        requestFrame: function() {
            this.requestTimer(frameRateInterval);
        },

        requestImmediateFrame: function() {
            this.requestTimer(0);
        },

        requestTimer: function(interval) {
            if (interval < 0)
                throw new Error("Invalid interval value " + interval);
            this._setStarted = true;
            if (this._nextInterval == -1) {
                this._nextInterval = interval;
                return;
            }
            this._nextInterval = Math.min(this._nextInterval, interval);
        },

        requestFixedTimer: function(time) {
            this._setStarted = true;
            this.requestTimer(time, this.time);
        },

        set: function(id, value) {
            this._stateValues[id] = value;
        },

        get: function(id, value) {
            return this._stateValues[id];
        },

        remove: function(id) {
            delete this._stateValues[id];
        }
    });

    var AnimationController = function() {
        this._animations = [];
        this._state = new AnimationState();
        this._lastAnimationId = 0;
        this._nextTimerId = null;
        this._nextTimerInterval = -1;
        this._timerCallbak = this._onTimerFired.bind(this);
        this._inCompute = false;
        this._hasRemovedSet = false;
    };

    _.extend(AnimationController.prototype, Backbone.Events, {
        allocateAnimationId: function() {
            return ++this._lastAnimationId;
        },

        register: function(animationSet) {
            if (this._animations.indexOf(animationSet) != -1)
                return false;
            this._animations.push(animationSet);
            animationSet.on("change:animation", this._onAnimationPropertyChanged, this);
            this._onAnimationPropertyChanged();
            return true;
        },

        unregister: function(animationSet) {
            var index = this._animations.indexOf(animationSet);
            if (index == -1)
                return false;
            animationSet.off("change:animation", this._onAnimationPropertyChanged, this);
            if (this._inCompute) {
                this._animations[index] = null;
                this._hasRemovedSet = true;
            } else
                this._animations.splice(index, 1);
            this._onAnimationPropertyChanged();
            return true;
        },

        _setTimer: function(interval) {
            if (this._nextTimerInterval != -1 &&
                this._nextTimerInterval <= interval)
                return;
            // Remove any old timer and update it to throw in that amount.
            if (this._nextTimerId) {
                clearTimeout(this._nextTimerId);
                this._nextTimerId = null;
                this._nextTimerInterval = -1;
            }
            this._nextTimerInterval = interval;
            if (interval == -1 || this._pendingCommit)
                return;
            if (interval <= maxRequestAnimationFrameDuration) {
                this._injectRequestAnimationFrameCallback();
            } else {
                this._nextTimerId = setTimeout(this._timerCallbak, interval);
            }
        },

        _onTimerFired: function() {
            this._nextTimerInterval = -1;
            this._nextTimerId = null;
            this.compute();
        },

        _onAnimationPropertyChanged: function() {
            if (this._pendingCommit || this._inCompute)
                return;
            // Do not execute the compute now as we might hape incomplete
            // data structures at this point.
            // Just make sure that compute is going to be triggered soon.
            this._setTimer(0);
        },

        _cleanupSets: function() {
            this._animations = _.filter(this._animations, function(animation) {
                return !!animation;
            });
            this._hasRemovedSet = false;
        },

        compute: function() {
            this._pendingCommit = false;
            this._inCompute = true;
            var state = this._state;
            do {
                state.updateTime();
                var animations = this._animations;
                for (var i = 0; i < animations.length; ++i) {
                    var animationSet = animations[i];
                    if (animationSet)
                        animationSet.compute(state);
                }
            } while(!state.nextInterval());
            if (this._hasRemovedSet)
                this._cleanupSets();
            this._setTimer(state.nextInterval());
            this._inCompute = false;
        },

        _computeOnAnimationFrame: function() {
            this._nextTimerInterval = -1;
            if (this._nextTimerId) {
                clearTimeout(this._nextTimerId);
                this._nextTimerId = null;
            }
            this.compute();
        },

        _injectRequestAnimationFrameCallback: function() {
            if (this._pendingCommit)
                return;
            this._pendingCommit = true;
            requestAnimationFrame.once("animation", this._computeOnAnimationFrame, this).run();
        },

        runOnRequestAnimationFrame: function() {
            if (this._pendingCommit)
                return;
            this._injectRequestAnimationFrameCallback();
            this._setTimer(-1);
        }
    });

    AnimationController.instance = new AnimationController();

    return AnimationController;

});
/*
 * Copyright (c) 2013 Adobe Systems Incorporated. All rights reserved.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

define('mobileui/utils/animations/animation',["mobileui/utils/animations/animation-controller"], function(AnimationController) {

    var Animation = function(name) {
        this._id = AnimationController.instance.allocateAnimationId();
        this.name = name;
        this._animations = [];
        this._stoppedAnimations = null;
    };

    _.extend(Animation.prototype, Backbone.Events, {
        compute: function(state, view) {
            _.each(this._animations, function(animation) {
                animation.compute(state, view);
            });
            if (this._stoppedAnimations) {
                var stoppedAnimations = this._stoppedAnimations;
                this._stoppedAnimations = null;
                var self = this;
                _.each(stoppedAnimations, function(animation) {
                    self._removeStoppedAnimation(animation, state);
                });
            }
        },

        search: function(name) {
            return _.find(this._animations, function(animation) { return animation.name == name; });
        },

        get: function(name) {
            var result = this.search(name);
            if (!result) {
                result = new Animation(name);
                this.append(result);
            }
            return result;
        },

        unset: function(name) {
            var result = this.search(name);
            if (result)
                this.remove(result);
        },

        _injectAnimation: function(animation) {
            animation.on("change:animation", this._onAnimationPropertyChange, this);
            animation.once("stop", this._onAnimationStopped.bind(this, animation));
            this._onAnimationPropertyChange();
        },

        append: function(animation) {
            this._animations.push(animation);
            this._injectAnimation(animation);
            return this;
        },

        insert: function(animation, i) {
            this._animations.splice(i, 0, animation);
            this._injectAnimation(animation);
            return this;
        },

        remove: function(animation) {
            var index = this._animations.indexOf(animation);
            if (index == -1)
                return;
            this._internalRemove(index);
            return this;
        },

        removeAll: function() {
            _.each(this._animations, function(animation) {
                animation.off("change:animation", this._onAnimationPropertyChange, this);
            });
            this._animations = [];
            return this;
        },

        _internalRemove: function(index) {
            var animation = this._animations[index];
            this._animations.splice(index, 1);
            animation.off("change:animation", this._onAnimationPropertyChange, this);
            this._onAnimationPropertyChange();
        },

        _onAnimationStopped: function(animation) {
            if (!this._stoppedAnimations)
                this._stoppedAnimations = [];
            this._stoppedAnimations.push(animation);
        },

        _removeStoppedAnimation: function(animation, state) {
            var index = this._animations.indexOf(animation);
            if (index == -1)
                return;
            this._internalRemove(index);
            var next = animation.next();
            if (!next)
                return;
            this.insert(next, index);
            state.requestImmediateFrame();
        },

        _onAnimationPropertyChange: function() {
            this.trigger("change:animation");
        },

        last: function() {
            return (this._animations.length) ? this._animations[this._animations.length - 1] : null;
        },

        chain: function(duration) {
            var BasicAnimation = require("mobileui/utils/animations/basic-animation");
            var animation = new BasicAnimation("start").setDuration(duration !== undefined ? duration : 0);
            if (this._animations.length)
                this.last().setNext(animation);
            else
                this.append(animation);
            return animation;
        },

        promise: function() {
            var self = this,
                deferred = $.Deferred();
            this.once("stop", function() {
                deferred.resolveWith(self);
            });
            return deferred.promise();
        }
    });

    return Animation;

});
/*
 * Copyright (c) 2013 Adobe Systems Incorporated. All rights reserved.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

define('mobileui/utils/animations/timing-functions',[],function() {

    // Translated from C++ to JS.
    // http://svn.webkit.org/repository/webkit/trunk/Source/WebCore/platform/graphics/UnitBezier.h
    
    function cubicBezier(p1x, p1y, p2x, p2y) {
        // Calculate the polynomial coefficients, implicit first and last control points are (0,0) and (1,1).
        var cx = 3.0 * p1x,
            bx = 3.0 * (p2x - p1x) - cx,
            ax = 1.0 - cx -bx;
             
        var cy = 3.0 * p1y,
            by = 3.0 * (p2y - p1y) - cy,
            ay = 1.0 - cy - by;
        
        function sampleCurveX(t)
        {
            // `ax t^3 + bx t^2 + cx t' expanded using Horner's rule.
            return ((ax * t + bx) * t + cx) * t;
        }
        
        function sampleCurveY(t)
        {
            return ((ay * t + by) * t + cy) * t;
        }
        
        function sampleCurveDerivativeX(t)
        {
            return (3.0 * ax * t + 2.0 * bx) * t + cx;
        }
        
        // Given an x value, find a parametric value it came from.
        function solveCurveX(x, epsilon)
        {
            var t0, t1, t2, x2, d2, i;

            // First try a few iterations of Newton's method -- normally very fast.
            for (t2 = x, i = 0; i < 8; i++) {
                x2 = sampleCurveX(t2) - x;
                if (Math.abs(x2) < epsilon)
                    return t2;
                d2 = sampleCurveDerivativeX(t2);
                if (Math.abs(d2) < 1e-6)
                    break;
                t2 = t2 - x2 / d2;
            }

            // Fall back to the bisection method for reliability.
            t0 = 0.0;
            t1 = 1.0;
            t2 = x;

            if (t2 < t0)
                return t0;
            if (t2 > t1)
                return t1;

            while (t0 < t1) {
                x2 = sampleCurveX(t2);
                if (Math.abs(x2 - x) < epsilon)
                    return t2;
                if (x > x2)
                    t0 = t2;
                else
                    t1 = t2;
                t2 = (t1 - t0) * 0.5 + t0;
            }

            // Failure.
            return t2;
        }

        function solveEpsilon(duration)
        {
            return 1.0 / (200.0 * duration);
        }

        return function(x, duration)
        {
            return sampleCurveY(solveCurveX(x, solveEpsilon(duration)));
        };
    }

    return {
        cubicBezier: cubicBezier,
        ease: cubicBezier(0.25, 0.1, 0.25, 1),
        linear: cubicBezier(0, 0, 1, 1),
        easeIn: cubicBezier(0.42, 0, 1, 1),
        easeOut: cubicBezier(0, 0, 0.58, 1),
        easeInOut: cubicBezier(0.42, 0, 0.58, 1)
    };

});
/*
 * Copyright (c) 2013 Adobe Systems Incorporated. All rights reserved.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

define('mobileui/utils/animations/basic-animation',["mobileui/utils/animations/animation", "require",
        "mobileui/utils/animations/timing-functions"], function(Animation, require, TimingFunctions) {

    var BasicAnimationState = function(time) {
        this.startTime = time;
        this.playDuration = 0;
        this.percent = 0;
        this.started = true;
    };

    var BasicAnimation = function(name) {
        Animation.call(this, name);
        this._duration = -1;
        this._next = null;
        this._timingFunction = TimingFunctions.linear;
    };

    _.extend(BasicAnimation.prototype, Backbone.Events, {
        compute: function(state, view) {
            var animationState = state.get(this._id);
            if (!animationState) {
                animationState = new BasicAnimationState(state.time);
                state.set(this._id, animationState);
                this._internalStart(state, view, animationState);
                this.trigger("start");
            }
            animationState.playDuration = state.time - animationState.startTime;
            if (this._duration >= 0) {
                animationState.percent = this._duration ? animationState.playDuration / this._duration : 1;
                if (animationState.percent >= 1) {
                    animationState.timingFunctionPercent = 1;
                    animationState.percent = 1;
                    state.remove(this._id);
                    animationState.started = false;
                } else {
                    animationState.timingFunctionPercent = this._timingFunction(animationState.percent, this._duration);
                }
            }
            this._internalCompute(state, view, animationState);
            if (!animationState.started)
                this.trigger("stop");
        },

        setTimingFunction: function(value) {
            if (_.isString(value))
                value = TimingFunctions[value];
            this._timingFunction = value;
            return this;
        },

        _internalStart: function(state, view, animationState) {
        },

        _internalCompute: function(state, view, animationState) {
            if (animationState.started)
                state.requestTimer(this._duration - animationState.playDuration);
        },

        setDuration: function(duration) {
            this._duration = duration;
            return this;
        },

        duration: function() {
            return this._duration;
        },

        setNext: function(nextAnimation) {
            this._next = nextAnimation;
            return this;
        },

        next: function() {
            return this._next;
        },

        wait: function(duration) {
            return this.setNext(new BasicAnimation("wait " + duration).setDuration(duration)).next();
        },

        log: function(message) {
            return this.setNext(new BasicAnimation("log " + message).setDuration(0).on("stop", function() {
                console.log("animation: ", message);
            })).next();
        },

        callback: function(callback, context) {
            return this.setNext(new BasicAnimation("callback").setDuration(0).on("stop", callback, context)).next();
        },

        promise: function() {
            var deferred = $.Deferred();
            this.setNext(new BasicAnimation("promise").setDuration(0).on("stop", function() {
                deferred.resolveWith(this);
            }, this));
            return deferred.promise();
        },

        transform: function(duration, startTransform, endTransform) {
            if (!endTransform) {
                endTransform = startTransform;
                startTransform = null;
            }
            var TransformAnimation = require("mobileui/utils/animations/transform-animation");
            var transformAnimation = new TransformAnimation("transform");
            transformAnimation.getTransform().take(endTransform);
            if (startTransform)
                transformAnimation.startTransform().take(startTransform);
            return this.setNext(transformAnimation.setDuration(duration)).next();
        },

        filter: function(duration, startFilter, endFilter) {
            if (!endFilter) {
                endFilter = startFilter;
                startFilter = null;
            }
            var FilterAnimation = require("mobileui/utils/animations/filter-animation");
            var filterAnimation = new FilterAnimation("filter");
            filterAnimation.getFilter().take(endFilter);
            if (startFilter)
                filterAnimation.startFilter().take(startFilter);
            return this.setNext(filterAnimation.setDuration(duration)).next();
        },

        opacity: function(duration, startOpacity, endOpacity) {
            if (endOpacity === undefined) {
                endOpacity = startOpacity;
                startOpacity = null;
            }
            var OpacityAnimation = require("mobileui/utils/animations/opacity-animation");
            var opacityAnimation = new OpacityAnimation("opacity");
            opacityAnimation.setOpacity(endOpacity);
            if (startOpacity !== null)
                opacityAnimation.setStartOpacity(startOpacity);
            return this.setNext(opacityAnimation.setDuration(duration)).next();
        }
    });

    return BasicAnimation;
});
/*
 * Copyright (c) 2013 Adobe Systems Incorporated. All rights reserved.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

define('mobileui/utils/animations/transform-animation',["mobileui/utils/animations/basic-animation",
        "mobileui/utils/transform"], function(BasicAnimation, Transform) {
    
    var TransformAnimation = function(name) {
        BasicAnimation.call(this, name);
        this._transform = new Transform();
        this._startTransform = null;
    };

    _.extend(TransformAnimation.prototype, BasicAnimation.prototype, {
        getTransform: function() {
            return this._transform;
        },

        startTransform: function() {
            if (!this._startTransform)
                this._startTransform = new Transform();
            return this._startTransform;
        },

        _internalStart: function(state, view, animationState) {
            animationState.startTransform = view.transform().clone();
        },

        _internalCompute: function(state, view, animationState) {
            if (animationState.started)
                state.requestFrame();
            var transform;
            if (this._startTransform)
                transform = this._startTransform.blend(animationState.timingFunctionPercent, this._transform);
            else
                transform = animationState.startTransform.blend(animationState.timingFunctionPercent, this._transform);
            view.transform().take(transform);
        }
    });

    return TransformAnimation;

});
/*
 * Copyright (c) 2013 Adobe Systems Incorporated. All rights reserved.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

define('mobileui/utils/animations/opacity-animation',["mobileui/utils/animations/basic-animation"], function(BasicAnimation) {

    var OpacityAnimation = function(name) {
        BasicAnimation.call(this, name);
        this._arguments = 0;
        this._startOpacity = null;
    };

    _.extend(OpacityAnimation.prototype, BasicAnimation.prototype, {
        opacity: function() {
            return this._opacity;
        },

        setOpacity: function(opacity) {
            this._opacity = opacity;
            return this;
        },

        startOpacity: function() {
            return this._startOpacity;
        },

        setStartOpacity: function(opacity) {
            this._startOpacity = opacity;
            return this;
        },

        _internalStart: function(state, view, animationState) {
            animationState.startOpacity = view.opacity();
        },

        _internalCompute: function(state, view, animationState) {
            if (animationState.started)
                state.requestFrame();
            var opacity;
            if (this._startOpacity !== null)
                opacity = this._startOpacity * (1 - animationState.timingFunctionPercent) +
                    animationState.timingFunctionPercent * this._opacity;
            else
                opacity = animationState.startOpacity * (1 - animationState.timingFunctionPercent) +
                    animationState.timingFunctionPercent * this._opacity;
            view.setOpacity(opacity);
        }
    });

    return OpacityAnimation;

});
/*
 * Copyright (c) 2013 Adobe Systems Incorporated. All rights reserved.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

define('mobileui/utils/animations/filter-animation',["mobileui/utils/animations/basic-animation",
        "mobileui/utils/transform",
        "mobileui/utils/filter"], function(BasicAnimation, Transform, Filter) {

    var FilterAnimation = function(name) {
        BasicAnimation.call(this, name);
        this._filter = new Filter();
        this._startFilter = null;
    };

    _.extend(FilterAnimation.prototype, BasicAnimation.prototype, {
        getFilter: function() {
            return this._filter;
        },

        startFilter: function() {
            if (!this._startFilter)
                this._startFilter = new Transform();
            return this._startFilter;
        },

        _internalStart: function(state, view, animationState) {
            animationState.startFilter = view.filter().clone();
        },

        _internalCompute: function(state, view, animationState) {
            if (animationState.started)
                state.requestFrame();
            var filter;
            if (this._startFilter)
                filter = this._startFilter.blend(animationState.timingFunctionPercent, this._filter);
            else
                filter = animationState.startFilter.blend(animationState.timingFunctionPercent, this._filter);
            view.filter().take(filter);
        }
    });

    return FilterAnimation;

});
/*
 * Copyright (c) 2013 Adobe Systems Incorporated. All rights reserved.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

define('mobileui/utils/animations/animation-set',["mobileui/utils/animations/animation-controller",
        "mobileui/utils/animations/animation",
        // Initialize all types of animations here.
        "mobileui/utils/animations/transform-animation",
        "mobileui/utils/animations/opacity-animation",
        "mobileui/utils/animations/filter-animation"
        ], function(AnimationController, Animation) {

    var AnimationSet = function(view) {
        Animation.call(this, "animationSet");
        this._view = view;
    };

    _.extend(AnimationSet.prototype, Animation.prototype, {
        start: function() {
            if (AnimationController.instance.register(this))
                this.trigger("start");
            return this;
        },

        inlineStart: function() {
            this.start();
            AnimationController.instance.runOnRequestAnimationFrame();
            return this;
        },

        stop: function() {
            if (AnimationController.instance.unregister(this))
                this.trigger("stop");
            return this;
        },

        compute: function(state) {
            state.prepareSet();
            Animation.prototype.compute.call(this, state, this._view);
            if (!state.isSetActive())
                this.stop();
        }
    });

    return AnimationSet;

});
/*
 * Copyright (c) 2013 Adobe Systems Incorporated. All rights reserved.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

define('mobileui/views/layout-params',[],function() {

    var LayoutParams = function() {
        this._x = null;
        this._y = null;
        this._width = null;
        this._height = null;
        this._weight = 1;
        this._isPostioned = false;
        this._matchLineHeight = false;
    };

    _.extend(LayoutParams.prototype, {

        setIsPositioned: function(positioned) {
            this._isPostioned = positioned;
            return this;
        },

        isPositioned: function() {
            return this._isPostioned;
        },

        width: function() {
            return this._width;
        },

        setWidth: function(width) {
            this._width = width;
            return this;
        },

        fillParentWidth: function() {
            return this.setWidth(LayoutParams.FILL_PARENT);
        },

        matchParentWidth: function() {
            return this.setWidth(LayoutParams.MATCH_PARENT);
        },

        matchChildrenWidth: function() {
            return this.setWidth(LayoutParams.MATCH_CHILDREN);
        },

        matchWidthOf: function(parentView) {
            return this.setWidth(parentView);
        },

        height: function() {
            return this._height;
        },

        setHeight: function(height) {
            this._height = height;
            return this;
        },

        fillParentHeight: function() {
            return this.setHeight(LayoutParams.FILL_PARENT);
        },

        matchParentHeight: function() {
            return this.setHeight(LayoutParams.MATCH_PARENT);
        },

        matchChildrenHeight: function() {
            return this.setHeight(LayoutParams.MATCH_CHILDREN);
        },

        matchHeightOf: function(parentView) {
            return this.setHeight(parentView);
        },

        matchParentSize: function() {
            return this
                .setWidth(LayoutParams.MATCH_PARENT)
                .setHeight(LayoutParams.MATCH_PARENT);
        },

        fillParent: function() {
            return this
                .setWidth(LayoutParams.FILL_PARENT)
                .setHeight(LayoutParams.FILL_PARENT);
        },

        matchChildren: function() {
            return this
                .setWidth(LayoutParams.MATCH_CHILDREN)
                .setHeight(LayoutParams.MATCH_CHILDREN);
        },

        weight: function() {
            return this._weight;
        },

        setWeight: function(weight) {
            this._weight = weight;
            return this;
        },

        hasParentDerivedWidth: function() {
            return this._width == LayoutParams.MATCH_PARENT ||
                this._width == LayoutParams.FILL_PARENT ||
                _.isNumber(this._width);
        },

        hasParentDerivedHeight: function() {
            return this._height == LayoutParams.MATCH_PARENT ||
                this._height == LayoutParams.FILL_PARENT ||
                _.isNumber(this._height);
        },

        shouldMatchLineHeight: function() {
            return this._matchLineHeight;
        },

        matchLineHeight: function(matchLineHeight) {
            this._matchLineHeight = matchLineHeight;
            return this;
        },

        x: function() {
            return this._x;
        },

        y: function() {
            return this._y;
        },

        setX: function(x) {
            this._x = x;
            return this;
        },

        setY: function(y) {
            this._y = y;
            return this;
        },

        horizontalCenter: function() {
            return this.setX(LayoutParams.CENTER);
        },

        verticalCenter: function() {
            return this.setY(LayoutParams.CENTER);
        }
    });

    _.extend(LayoutParams, {
        FILL_PARENT: "fill-parent",
        MATCH_PARENT: "match-parent",
        MATCH_CHILDREN: "match-children",
        CENTER: "center"
    });

    return LayoutParams;

});
/*
 * Copyright (c) 2013 Adobe Systems Incorporated. All rights reserved.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

define('mobileui/views/touch',["mobileui/utils/request-animation-frame",
        "mobileui/utils/boilerplate"], 
    function(requestAnimationFrame, boilerplate) {

    function Touch(identifier) {
        this.identifier = identifier;
        this.startPosition = null;
        this.currentPosition = null;
        this.state = null;
        this.view = null;
        this.type = Touch.TOUCH;
        this.dragSurface = null;
        this.previewBox = null;
        this.animationFrameRequested = false;
    }

    Touch.preview = false;

    Touch.previewBoxesPool = [];
    Touch.popPreviewBox = function() {
        var item = Touch.previewBoxesPool.pop();
        if (!item)
            item = $("<div />").addClass("js-touch-preview").appendTo(document.body);
        return item;
    };

    Touch.pushPreviewBox = function(view) {
        Touch.previewBoxesPool.push(view);
    };

    _.extend(Touch.prototype, {
        attachToSurface: function(view) {
            this.dragSurface = view;
            Touch.injectLocalPoints(view, this.startPosition);
            Touch.injectLocalPoints(view, this.currentPosition);
        },

        update: function(currentPosition) {
            this.currentPosition = currentPosition;
            var surface = this.dragSurface || this.view;
            if (surface)
                Touch.injectLocalPoints(surface, this.currentPosition);
            this.updatePreviewBox();
        },

        createPreviewBox: function() {
            if (this.previewBox)
                return;
            this.previewBox = Touch.popPreviewBox();
            this.previewBox.css("opacity", 1);
        },

        updatePreviewBox: function() {
            if (!Touch.preview)
                return;
            if (this.animationFrameRequested)
                return;
            var self = this;
            requestAnimationFrame(function() {
                self.animationFrameRequested = false;
                if (self.state == Touch.END || self.state == Touch.CANCELED)
                    return self.removePreviewBox();
                self.createPreviewBox();
                self.previewBox.css(boilerplate.prefixOne("transform"),
                    "translate3d(" + self.currentPosition.pageX + "px, " + self.currentPosition.pageY + "px, 0px)");
            });
        },

        removePreviewBox: function() {
            if (!this.previewBox)
                return;
            this.previewBox.css("opacity", 0);
            Touch.pushPreviewBox(this.previewBox);
            this.previewBox = null;
        }
    });

    Touch.Point = boilerplate.lookupUpperCasePrefix(window, "Point");
    Touch.convertPointFromPageToNode = boilerplate.lookupPrefix(window, "convertPointFromPageToNode");

    Touch.getPosition = function(touch) {
        var touchPos = {
            clientX: touch.clientX,
            clientY: touch.clientY,
            pageX: touch.pageX,
            pageY: touch.pageY,
            screenX: touch.screenX,
            screenY: touch.screenY,
            localX: touch.pageX,
            localY: touch.pageY,
            parentX: touch.pageX,
            parentY: touch.pageY,
            time: Date.now()
        };
        return touchPos;
    };

    Touch.getPointerPosition = function(touch) {
        var touchPos = {
            clientX: touch.clientX,
            clientY: touch.clientY,
            pageX: touch.pageX,
            pageY: touch.pageY,
            screenX: touch.screenX,
            screenY: touch.screenY,
            localX: touch.offsetX,
            localY: touch.offsetY,
            parentX: touch.pageX,
            parentY: touch.pageY,
            time: Date.now()
        };
        return touchPos;
    };

    Touch.injectLocalPoints = function(view, touch) {
        if (Touch.Point) {
            var point = new Touch.Point();
            point.x = touch.pageX;
            point.y = touch.pageY;
            var localPoint = Touch.convertPointFromPageToNode.call(window, view.$el.get(0), point);
            var parentPoint = Touch.convertPointFromPageToNode.call(window, view.$el.get(0).parentNode, point);
            touch.localX = localPoint ? localPoint.x : touch.pageX;
            touch.localY = localPoint ? localPoint.y : touch.pageY;
            touch.parentX = parentPoint ? parentPoint.x : touch.localX;
            touch.parentY = parentPoint ? parentPoint.y : touch.localY;
        }
        return touch;
    };

    Touch.START = "start";
    Touch.MOVE = "move";
    Touch.END = "end";
    Touch.CANCELED = "canceled";

    Touch.TOUCH = "touch";
    Touch.MOUSE = "mouse";

    return Touch;

});

/*
 * Copyright (c) 2013 Adobe Systems Incorporated. All rights reserved.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

define('mobileui/views/touch-manager',["mobileui/views/touch",
        "mobileui/utils/request-animation-frame"], function(Touch, requestAnimationFrame) {

    function TouchManager() {
        this.touchEvents = {
            onPointerDown: this.onPointerDown.bind(this),
            onPointerMove: this.onPointerMove.bind(this),
            onPointerUp: this.onPointerUp.bind(this),
            onPointerCancel: this.onPointerCancel.bind(this),
            onTouchStart: this.onTouchStart.bind(this),
            onTouchMove: this.onTouchMove.bind(this),
            onTouchEnd: this.onTouchEnd.bind(this),
            onTouchCancel: this.onTouchCancel.bind(this),
            onMouseMove: this.onMouseMove.bind(this),
            onMouseUp: this.onMouseUp.bind(this)
        };
        this.mouseEvent = null;
        this.touchPointsSet = {};
        this.touchPoints = [];
        this.pointerEventsInstalled = false;
        this.touchEventsInstalled = false;
        this.mouseEventsInstalled = false;
        this.captureTouchSurface = null;
    }

    _.extend(TouchManager.prototype, Backbone.Events, {

        inlineUpdate: function() {
            requestAnimationFrame.runInlinesIfNeeded();
        },

        findTouch: function(identifier) {
            return this.touchPointsSet[identifier];
        },

        setTouch: function(touch) {
            this.touchPointsSet[touch.identifier] = touch;
            this.touchPoints.push(touch);
            this.installTouchTrackingEvents();
            this.installPointerTrackingEvents();
        },

        cancelTouch: function(identifier) {
            var touch = this.findTouch(identifier);
            if (!touch)
                return;
            if (touch.view) {
                touch.view.removeTouch(touch);
                touch.view.trigger("touchcanceled", touch);
            }
            this.removeTouch(touch);
            touch.state = Touch.CANCELED;
            touch.updatePreviewBox();
        },

        removeTouch: function(touch) {
            delete this.touchPointsSet[touch.identifier];
            var index = this.touchPoints.indexOf(touch);
            if (index != -1)
                this.touchPoints.splice(index, 1);
            if (touch.identifier == Touch.MOUSE)
                this.removeMouseTrackingEvents();
            else if (!this.touchPoints.length) {
                this.removeTouchTrackingEvents();
                this.removePointerTrackingEvents();
            }
        },

        installPointerTrackingEvents: function() {
            if (this.pointerEventsInstalled)
                return;
            this.pointerEventsInstalled = true;
            window.addEventListener("MSPointerDown", this.touchEvents.onPointerDown, true);
            window.addEventListener("MSPointerMove", this.touchEvents.onPointerMove, true);
            window.addEventListener("MSPointerUp", this.touchEvents.onPointerUp, true);
            window.addEventListener("MSPointerCancel", this.touchEvents.onPointerCancel, true);
        },

        removePointerTrackingEvents: function() {
            if (!this.pointerEventsInstalled)
                return;
            this.pointerEventsInstalled = false;
            window.removeEventListener("MSPointerDown", this.touchEvents.onPointerDown, true);
            window.removeEventListener("MSPointerMove", this.touchEvents.onPointerMove, true);
            window.removeEventListener("MSPointerUp", this.touchEvents.onPointerUp, true);
            window.removeEventListener("MSPointerCancel", this.touchEvents.onPointerCancel, true);
        },

        installTouchTrackingEvents: function() {
            if (this.touchEventsInstalled)
                return;
            this.touchEventsInstalled = true;
            window.addEventListener("touchstart", this.touchEvents.onTouchStart, true);
            window.addEventListener("touchmove", this.touchEvents.onTouchMove, true);
            window.addEventListener("touchend", this.touchEvents.onTouchEnd, true);
            window.addEventListener("touchcancel", this.touchEvents.onTouchCancel, true);
        },

        removeTouchTrackingEvents: function() {
            if (!this.touchEventsInstalled)
                return;
            this.touchEventsInstalled = false;
            window.removeEventListener("touchstart", this.touchEvents.onTouchStart, true);
            window.removeEventListener("touchmove", this.touchEvents.onTouchMove, true);
            window.removeEventListener("touchend", this.touchEvents.onTouchEnd, true);
            window.removeEventListener("touchcancel", this.touchEvents.onTouchCancel, true);
        },

        installMouseTrackingEvents: function() {
            if (this.mouseEventsInstalled)
                return;
            this.mouseEventsInstalled = true;
            window.addEventListener("mousemove", this.touchEvents.onMouseMove, true);
            window.addEventListener("mouseup", this.touchEvents.onMouseUp, true);
        },

        removeMouseTrackingEvents: function() {
            if (!this.mouseEventsInstalled)
                return;
            this.mouseEventsInstalled = false;
            window.removeEventListener("mousemove", this.touchEvents.onMouseMove, true);
            window.removeEventListener("mouseup", this.touchEvents.onMouseUp, true);
        },

        needsNativeTouch: function(event) {
            var target = $(event.target);
            return (!this.captureTouchSurface &&
                (target.attr("data-native-touch") !== undefined ||
                target.prop("nodeName") === "A"));
        },

        removeFocus: function() {
            if (document.activeElement)
                $(document.activeElement).blur();
        },

        onPointerDown: function(event) {
            if (!this.captureTouchSurface)
                return;
            this.removeFocus();
            
            if (this.findTouch(event.pointerId)) {
                event.preventDefault();
                event.stopImmediatePropagation();
                return;
            }
            var internalTouch = new Touch(event.pointerId);
            internalTouch.view = null;
            internalTouch.state = Touch.START;
            internalTouch.startPosition = internalTouch.currentPosition = Touch.getPointerPosition(event);
            internalTouch.updatePreviewBox();
            this.setTouch(internalTouch);
        
            if (this.captureTouchSurface)
                this.captureTouchSurface.onPointerDownInternal(event);

            this.inlineUpdate();
        },

        handlePointerDown: function(touch) {
            var internalTouch = this.findTouch(touch.pointerId);
            if (internalTouch)
                return internalTouch;
            internalTouch = new Touch(touch.pointerId);
            internalTouch.view = null;
            internalTouch.state = Touch.START;
            internalTouch.startPosition = internalTouch.currentPosition = Touch.getPointerPosition(touch);
            internalTouch.updatePreviewBox();
            this.setTouch(internalTouch);
            return internalTouch;
        },

        onPointerMove: function(event) {
            var internalTouch = this.findTouch(event.pointerId);
            if (!internalTouch) {
                return;
            }
            event.preventDefault();
            event.stopImmediatePropagation();
            internalTouch.state = Touch.MOVE;
            internalTouch.update(Touch.getPointerPosition(event));
            if (internalTouch.view)
                internalTouch.view.trigger("touchmove", internalTouch);
            this.inlineUpdate();
        },

        onPointerUp: function(event) {
            var internalTouch = this.findTouch(event.pointerId);
            if (!internalTouch) {
                console.log("Unregister touch identifier detected for pointerup event", event);
                return;
            }
            event.preventDefault();
            event.stopImmediatePropagation();
            internalTouch.state = Touch.END;
            internalTouch.update(Touch.getPointerPosition(event));
            this.removeTouch(internalTouch);
            if (internalTouch.view) {
                internalTouch.view.removeTouch(internalTouch);
                internalTouch.view.trigger("touchend", internalTouch);
            }
            this.inlineUpdate();
        },

        onPointerCancel: function(event) {
            var internalTouch = this.findTouch(event.pointerId);
            if (!internalTouch) {
                console.log("Unregister touch identifier detected for pointercancel event", event);
                return;
            }
            event.preventDefault();
            event.stopImmediatePropagation();
            internalTouch.state = Touch.CANCELED;
            internalTouch.update(Touch.getPointerPosition(event));
            this.removeTouch(internalTouch);
            if (internalTouch.view) {
                internalTouch.view.removeTouch(internalTouch);
                internalTouch.view.trigger("touchcanceled", internalTouch);
            }
        },

        onTouchStart: function(event) {
            if (!this.captureTouchSurface)
                return;
            this.removeFocus();
            var touches = event.changedTouches;
            for (var i = 0; i < touches.length; ++i) {
                var touch = touches[i];
                if (this.findTouch(touches[i].identifier)) {
                    event.preventDefault();
                    event.stopImmediatePropagation();
                    continue;
                }
                var internalTouch = new Touch(touches[i].identifier);
                internalTouch.view = null;
                internalTouch.state = Touch.START;
                internalTouch.startPosition = internalTouch.currentPosition = Touch.getPosition(touch);
                internalTouch.updatePreviewBox();
                this.setTouch(internalTouch);
            }
            if (this.captureTouchSurface)
                this.captureTouchSurface.onTouchStartInternal(event);
            this.inlineUpdate();
        },

        handleTouchStart: function(touch) {
            var internalTouch = this.findTouch(touch.identifier);
            if (internalTouch)
                return internalTouch;
            internalTouch = new Touch(touch.identifier);
            internalTouch.view = null;
            internalTouch.state = Touch.START;
            internalTouch.startPosition = internalTouch.currentPosition = Touch.getPosition(touch);
            internalTouch.updatePreviewBox();
            this.setTouch(internalTouch);
            return internalTouch;
        },

        onTouchMove: function(event) {
            var touches = event.changedTouches;
            for (var i = 0; i < touches.length; ++i) {
                var touch = touches[i];
                var internalTouch = this.findTouch(touch.identifier);
                if (!internalTouch) {
                    console.log("Unregister touch identifier detected for touchmove event", touch);
                    continue;
                }
                event.preventDefault();
                event.stopImmediatePropagation();
                internalTouch.state = Touch.MOVE;
                internalTouch.update(Touch.getPosition(touch));
                if (internalTouch.view)
                    internalTouch.view.trigger("touchmove", internalTouch);
            }
            this.inlineUpdate();
        },

        onTouchEnd: function(event) {
            var touches = event.changedTouches;
            for (var i = 0; i < touches.length; ++i) {
                var touch = touches[i];
                var internalTouch = this.findTouch(touch.identifier);
                if (!internalTouch) {
                    console.log("Unregister touch identifier detected for touchend event", touch);
                    continue;
                }
                event.preventDefault();
                event.stopImmediatePropagation();
                internalTouch.state = Touch.END;
                internalTouch.update(Touch.getPosition(touch));
                this.removeTouch(internalTouch);
                if (internalTouch.view) {
                    internalTouch.view.removeTouch(internalTouch);
                    internalTouch.view.trigger("touchend", internalTouch);
                }
            }
            this.inlineUpdate();
        },

        onTouchCancel: function(event) {
            var touches = event.changedTouches;
            for (var i = 0; i < touches.length; ++i) {
                var touch = touches[i];
                var internalTouch = this.findTouch(touch.identifier);
                if (!internalTouch) {
                    console.log("Unregister touch identifier detected for touchcanceled event", touch);
                    continue;
                }
                event.preventDefault();
                event.stopImmediatePropagation();
                internalTouch.state = Touch.CANCELED;
                internalTouch.update(Touch.getPosition(touch));
                this.removeTouch(internalTouch);
                if (internalTouch.view) {
                    internalTouch.view.removeTouch(internalTouch);
                    internalTouch.view.trigger("touchcanceled", internalTouch);
                }
            }
            this.inlineUpdate();
        },

        internalTouchInvalidate: function(internalTouch) {
            internalTouch.state = Touch.CANCELED;
            this.removeTouch(internalTouch);
            internalTouch.updatePreviewBox();
            if (internalTouch.view) {
                internalTouch.view.removeTouch(internalTouch);
                internalTouch.view.trigger("touchcanceled", internalTouch);
            }
        },

        handleMouseDown: function(event) {
            this.cancelTouch(Touch.MOUSE);
            var internalTouch = new Touch(Touch.MOUSE);
            internalTouch.type = Touch.MOUSE;
            internalTouch.view = null;
            this.mouseEvent = internalTouch;
            this.setTouch(internalTouch);
            internalTouch.startPosition = internalTouch.currentPosition = Touch.getPosition(event);
            internalTouch.state = Touch.START;
            internalTouch.updatePreviewBox();
            this.installMouseTrackingEvents();
            return internalTouch;
        },

        onMouseMove: function(event) {
            var internalTouch = this.findTouch(Touch.MOUSE);
            if (!internalTouch) {
                return;
            }
            event.preventDefault();
            event.stopImmediatePropagation();
            internalTouch.state = Touch.MOVE;
            internalTouch.update(Touch.getPosition(event));
            if (internalTouch.view)
                internalTouch.view.trigger("touchmove", internalTouch);
            this.inlineUpdate();
        },

        onMouseUp: function(event) {
            this.mouseEvent = null;
            var internalTouch = this.findTouch(Touch.MOUSE);
            if (!internalTouch) {
                return;
            }
            event.preventDefault();
            event.stopImmediatePropagation();
            internalTouch.state = Touch.END;
            internalTouch.update(Touch.getPosition(event));
            this.removeTouch(internalTouch);
            if (internalTouch.view) {
                internalTouch.view.removeTouch(internalTouch);
                internalTouch.view.trigger("touchend", internalTouch);
            }
            this.inlineUpdate();
        }
    });

    TouchManager.instance = new TouchManager();

    return TouchManager;

});
/*
 * Copyright (c) 2013 Adobe Systems Incorporated. All rights reserved.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

define('mobileui/views/touch-view-mixin',[
    "mobileui/views/touch",
    "mobileui/views/touch-manager"], function(Touch, TouchManager) {

    var TouchViewMixin = {
        initializeTouchViewMixin: function() {
            this.touchEvents = {
                installed: false,
                onPointerDown: this.onPointerDown.bind(this),
                onTouchStart: this.onTouchStart.bind(this),
                onMouseDown: this.onMouseDown.bind(this),
                onClick: this.onClick.bind(this)
            };
            this.touchPointsSet = {};
            this.touchPoints = [];
            return this;
        },

        installTouchEvents: function() {
            if (this.touchEvents.installed)
                return;
            var el = this.$el.get(0);
            el.addEventListener("MSPointerDown", this.touchEvents.onPointerDown, false);
            el.addEventListener("touchstart", this.touchEvents.onTouchStart, false);
            el.addEventListener("mousedown", this.touchEvents.onMouseDown, false);
            el.addEventListener("click", this.touchEvents.onClick, false);
        },

        removeTouchEvents: function() {
            if (!this.touchEvents.installed)
                return;
            var el = this.$el.get(0);
            el.removeEventListener("MSPointerDown", this.touchEvents.onPointerDown, false);
            el.removeEventListener("touchstart", this.touchEvents.onTouchStart, false);
            el.removeEventListener("mousedown", this.touchEvents.onMouseDown, false);
            el.removeEventListener("click", this.touchEvents.onClick, false);
        },

        removeTouch: function(touch) {
            delete this.touchPointsSet[touch.identifier];
            var index = this.touchPoints.indexOf(touch);
            if (index != -1)
                this.touchPoints.splice(index, 1);
        },

        _invalidateTouch: function() {
            if (!this.touchPoints)
                return;
            // Make a clone as the touch manager will invalidate the original array.
            _.each(_.clone(this.touchPoints), function(touch) {
                TouchManager.instance.internalTouchInvalidate(touch);
            });
        },

        setTouch: function(touch) {
            this.touchPointsSet[touch.identifier] = touch;
            this.touchPoints.push(touch);
        },

        onTouchStartInternal: function(event) {
            event.preventDefault();
            event.stopImmediatePropagation();

            var touches = event.changedTouches;
            for (var i = 0; i < touches.length; ++i) {
                var touch = touches[i];
                var internalTouch = TouchManager.instance.findTouch(touch.identifier);
                if (!internalTouch)
                    internalTouch = TouchManager.instance.handleTouchStart(touches[i]);
                internalTouch.view = this;
                this.setTouch(internalTouch);
                this.trigger("touchstart", internalTouch);
            }
        },

        onTouchStart: function(event) {
            if (TouchManager.instance.needsNativeTouch(event) || this.disabled())
                return;
            this.onTouchStartInternal(event);
            this.inlineUpdate();
        },

        onPointerDownInternal: function(event) {
            event.preventDefault();
            event.stopImmediatePropagation();

            var internalTouch = TouchManager.instance.findTouch(event.pointerId);
            if (!internalTouch)
                internalTouch = TouchManager.instance.handlePointerDown(event);
            internalTouch.view = this;
            this.setTouch(internalTouch);
            this.trigger("touchstart", internalTouch);
        },

        onPointerDown: function(event) {
            if (TouchManager.instance.needsNativeTouch(event) || this.disabled())
                return;
            this.onPointerDownInternal(event);
            this.inlineUpdate();
        },

        onMouseDown: function(event) {
            if (TouchManager.instance.needsNativeTouch(event) || this.disabled())
                return;
            event.preventDefault();
            event.stopImmediatePropagation();

            var internalTouch = TouchManager.instance.findTouch(Touch.MOUSE);
            if (!internalTouch)
                internalTouch = TouchManager.instance.handleMouseDown(event);
            internalTouch.view = this;
            this.setTouch(internalTouch);
            this.trigger("touchstart", internalTouch);
            this.inlineUpdate();
        },

        onClick: function(event) {
            if (TouchManager.instance.needsNativeTouch(event) || this.disabled())
                return;
            event.preventDefault();
            event.stopImmediatePropagation();
            this.inlineUpdate();
        }
    };

    return TouchViewMixin;
});
define('mobileui/utils/geometry',[],function() {

    var Geometry = {
        dist: function(x1, y1, x2, y2) {
            return Math.sqrt(Math.pow(x1 - x2, 2) + Math.pow(y1 - y2, 2));
        },

        angle: function(x1, y1, x2, y2) {
            var cos = (x1 * x2 + y1 * y2) / (Geometry.dist(0, 0, x1, y1) * Geometry.dist(0, 0, x2, y2));
            return Math.acos(cos) * 180 / Math.PI;
        },

        rotation: function(x1, y1, x2, y2) {
            var angle1 = Geometry.angle(1, 0, x1, y1);
            var angle2 = Geometry.angle(1, 0, x2, y2);
            if (y1 > 0)
                angle1 = - angle1;
            if (y2 > 0)
                angle2 = - angle2;
            return angle1 - angle2;
        }
    };

    return Geometry;

});
/*
 * Copyright (c) 2013 Adobe Systems Incorporated. All rights reserved.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

define('mobileui/views/gesture-detector',["mobileui/views/touch-manager",
        "mobileui/utils/geometry"],
    function(TouchManager, Geometry) {

    function GestureType(type, scrollX, scrollY, distanceX, distanceY) {
        this.type = type;
        this.scrollX = scrollX;
        this.scrollY = scrollY;
        this.distanceX = distanceX;
        this.distanceY = distanceY;
    }

    GestureType.DRAG = "drag";
    GestureType.TRANSFORM = "transform";

    /*
    Gesture types detected:
    1. Tap
    2. Long-tap
    3. Drag - Swipe
    4. Transform (move, scale, rotate)
    */
    function GestureDetector(view) {
        this.touchesStarted = 0;
        this.didStartDragging = false;
        this.didStartTransform = false;
        this.canTap = true;
        this.longTapDuration = 500;
        this.minDragLength = 3;
        this.longTapTimer = null;
        this.longTapTimerCallback = this.onLongTapTimer.bind(this);
        this.longTapTouch = null;
        this.touchParent = null;
        this.dragSurface = null;
        this.draggingTouch = null;
        this.view = null;
        if (view)
            this.install(view);
    }

    _.extend(GestureDetector.prototype, Backbone.Events, {

        install: function(view) {
            this.view = view.setNeedsTouchEvents(true);
            view.on("touchstart", this.onGestureTouchStart.bind(this));
            view.on("touchmove", this.onGestureTouchMove.bind(this));
            view.on("touchend", this.onGestureTouchEnd.bind(this));
            view.on("touchcanceled", this.onGestureTouchCanceled.bind(this));
        },

        installGestureTimers: function(touch) {
            this.clearGestureTimers();
            this.longTapTouch = touch;
            this.longTapTimer = setTimeout(this.longTapTimerCallback, this.longTapDuration);
        },

        clearGestureTimers: function() {
            if (!this.longTapTimer)
                return;
            this.longTapTouch = null;
            clearTimeout(this.longTapTimer);
            this.longTapTimer = null;
        },

        installTransformCapture: function() {
            var parentTransformSurface = this.findParentTouchSurface(new GestureType(GestureType.TRANSFORM));
            if (parentTransformSurface && !parentTransformSurface.noTouchCapture)
                TouchManager.instance.captureTouchSurface = this.view;
        },

        clearTransformCapture: function() {
            if (TouchManager.instance.captureTouchSurface === this.view)
                TouchManager.instance.captureTouchSurface = null;
        },

        computeGestureTransform: function() {
            var pointA = this.view.touchPoints[0];
            var pointB = this.view.touchPoints[1];

            var originX = (pointA.startPosition.localX + pointB.startPosition.localX) / 2;
            var originY = (pointA.startPosition.localY + pointB.startPosition.localY) / 2;

            var centerStartX = (pointA.startPosition.parentX + pointB.startPosition.parentX) / 2;
            var centerStartY = (pointA.startPosition.parentY + pointB.startPosition.parentY) / 2;
            var distanceStart = Geometry.dist(pointA.startPosition.parentX, pointA.startPosition.parentY, pointB.startPosition.parentX, pointB.startPosition.parentY);

            var centerEndX = (pointA.currentPosition.parentX + pointB.currentPosition.parentX) / 2;
            var centerEndY = (pointA.currentPosition.parentY + pointB.currentPosition.parentY) / 2;
            var distanceEnd = Geometry.dist(pointA.currentPosition.parentX, pointA.currentPosition.parentY, pointB.currentPosition.parentX, pointB.currentPosition.parentY);

            var vectorRotation = Geometry.rotation(
                    pointB.startPosition.parentX - pointA.startPosition.parentX,
                    pointB.startPosition.parentY - pointA.startPosition.parentY,
                    pointB.currentPosition.parentX - pointA.currentPosition.parentX,
                    pointB.currentPosition.parentY - pointA.currentPosition.parentY
                );

            return {
                scale: (distanceStart > 0) ? (distanceEnd / distanceStart) : 0,
                dragX: centerEndX - centerStartX,
                dragY: centerEndY - centerStartY,
                originX: originX,
                originY: originY,
                rotation: vectorRotation
            };
        },

        computeDragTransform: function(touch) {
            return {
                dragX: touch.currentPosition.parentX - touch.startPosition.parentX,
                dragY: touch.currentPosition.parentY - touch.startPosition.parentY,
                touch: touch
            };
        },

        onGestureTouchStart: function(touch) {
            this.touchesStarted = (this.view.touchPoints.length == 1) ? 1 : (this.touchesStarted + 1);
            if (this.touchesStarted == 1) {
                this.installGestureTimers(touch);
                this.installTransformCapture();
                this.view.trigger("tapstart", touch);
            } else if (!this.didStartTransform) {
                // Two finger gesture.
                if (this.didStartDragging) {
                    var oldDragTouch = this.view.touchPoints[0];
                    this.dragSurface.trigger("touchdragend", this.computeDragTransform(oldDragTouch), oldDragTouch, false);
                    this.dragSurface = null;
                    this.didStartDragging = false;
                    oldDragTouch.startPosition = oldDragTouch.currentPosition;
                } else {
                    this.canTap = false;
                    this.view.trigger("tapend", touch);
                }
                this.clearGestureTimers();
                this.dragSurface = this.findParentTouchSurface(new GestureType(GestureType.TRANSFORM));
                if (this.dragSurface) {
                    this.didStartTransform = true;
                    this.view.touchPoints[0].attachToSurface(this.dragSurface);
                    this.view.touchPoints[1].attachToSurface(this.dragSurface);
                    this.dragSurface.trigger("touchtransformstart", touch);
                    this.clearTransformCapture();
                }
            }
        },

        cancelTransform: function() {
            if (!this.didStartTransform)
                return;
            this.didStartTransform = false;
            this.dragSurface = null;
        },

        onGestureTouchMove: function(touch) {
            if (this.didStartTransform) {
                // Interpret the tranform out of the first two touches.
                this.dragSurface.trigger("touchtransform", this.computeGestureTransform());
                return;
            }
            if (!this.didStartDragging && this.touchesStarted == 1) {
                var distanceX = touch.startPosition.pageX - touch.currentPosition.pageX,
                    absDistanceX = Math.abs(distanceX);
                var distanceY = touch.startPosition.pageY - touch.currentPosition.pageY,
                    absDistanceY = Math.abs(distanceY);
                if (absDistanceX > absDistanceY)
                    absDistanceY = 0;
                else
                    absDistanceX = 0;
                var scrollX = absDistanceX > this.minDragLength;
                var scrollY = absDistanceY > this.minDragLength;
                if (scrollX || scrollY) {
                    this.canTap = false;
                    this.view.trigger("tapend", touch);
                    this.clearGestureTimers();
                    this.dragSurface = this.findParentTouchSurface(new GestureType(GestureType.DRAG,
                        scrollX, scrollY, distanceX, distanceY));
                    if (this.dragSurface) {
                        touch.attachToSurface(this.dragSurface);
                        touch.dragStartTime = touch.currentPosition.time - touch.startPosition.time;
                        this.didStartDragging = true;
                        this.dragSurface.draggingTouch = touch;
                        this.dragSurface.trigger("touchdragstart", touch);
                    }
                }
            }
            if (this.didStartDragging && touch === this.dragSurface.draggingTouch)
                this.dragSurface.trigger("touchdragmove", this.computeDragTransform(touch), touch);
        },

        startDraggingFromLongTap: function() {
            var touch = this.view.touchPoints[0];
            if (!touch)
                return;
            this.canTap = false;
            this.view.trigger("tapend", touch);
            this.clearGestureTimers();
            this.dragSurface = this;
            this.didStartDragging = true;
            touch.attachToSurface(this.dragSurface);
            touch.dragStartTime = touch.currentPosition.time - touch.startPosition.time;
            this.dragSurface.draggingTouch = touch;
            this.dragSurface.trigger("touchdragstart", touch);
        },

        onLongTapTimer: function() {
            this.clearGestureTimers();
            this.view.trigger("longtaptimer", this.longTapTouch);
            if (!this.view.$el.parent().length)
                this.clearTransformCapture();
        },

        onGestureTouchEnd: function(touch) {
            this.clearGestureTimers();
            if (this.didStartTransform) {
                if (this.view.touchPoints.length == 1) {
                    this.dragSurface.trigger("touchtransformend", touch);
                    // One touch remaining, go back to dragging.
                    this.didStartTransform = false;
                    this.didStartDragging = false;
                    this.dragSurface = null;
                    this.installTransformCapture();
                }
            } else if (this.canTap) {
                this.view.trigger("tapend", touch);
                // We only had one touch during this interval. Figure out if it's a tap or
                // a long-tap and fire the event.
                var touchDuration = touch.currentPosition.time - touch.startPosition.time;
                this.view.trigger((touchDuration < this.longTapDuration) ? "tap" : "longtap", touch);
            }
            if (!this.view.touchPoints.length) {
                if (this.didStartDragging)
                    this.dragSurface.trigger("touchdragend", this.computeDragTransform(touch), touch, true);
                else if (this.didStartTransform)
                    this.dragSurface.trigger("touchtransformend", touch);
                this.finishGesture(touch);
            }
        },

        finishGesture: function(touch) {
            if (this.dragSurface) {
                this.dragSurface.draggingTouch = null;
                this.dragSurface.trigger("gestureend", touch);
                this.dragSurface = null;
            }
            this.didStartTransform = false;
            this.didStartDragging = false;
            this.touchesStarted = 0;
            this.canTap = true;
            this.clearTransformCapture();
        },

        onGestureTouchCanceled: function(touch) {
            this.onGestureTouchEnd(touch);
        },

        findParentTouchSurface: function(gesture) {
            for (var node = this.view; node; node = node.parent()) {
                if (node.respondsToTouchGesture && node.respondsToTouchGesture(gesture))
                    return node;
            }
            return null;
        }
    });

    GestureDetector.GestureType = GestureType;

    return GestureDetector;

});
/*
 * Copyright (c) 2013 Adobe Systems Incorporated. All rights reserved.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

define('mobileui/views/layer-view',["mobileui/utils/rect",
        "mobileui/utils/transform",
        "mobileui/utils/filter",
        "mobileui/utils/outsets",
        "mobileui/utils/animations/animation-set",
        "mobileui/utils/request-animation-frame",
        "mobileui/views/layout-params",
        "mobileui/views/touch-view-mixin",
        "mobileui/views/gesture-detector"
], function(Rect, Transform, Filter, Outsets, AnimationSet, requestAnimationFrame, LayoutParams, TouchViewMixin, GestureDetector) {

    var LayerView = Backbone.View.extend(TouchViewMixin).extend({

        initialize: function() {
            LayerView.__super__.initialize.call(this);
            this.initializeTouchViewMixin();
            this._bounds = new Rect();
            this._transform = new Transform();
            this._filter = new Filter();
            this._margin = new Outsets();
            this._padding = new Outsets();
            this._opacity = 1;
            this._animation = null;

            this._params = null;

            this._bounds.on("change:position", this._onPositionChanged, this);
            this._bounds.on("change:size", this._onSizeChanged, this);
            this._transform.on("change", this._onTransformChanged, this);
            this._filter.on("change", this._onFilterChanged, this);
            this._padding.on("change", this._onPaddingChanged, this);
            this._margin.on("change", this._onMarginChanged, this);

            this._invalidationFlags = null;
            this._needsLayout = false;
            this._state = LayerView.VISIBLE;
            this._needsTouchEvents = false;
            this._visible = true;
            this._disabled = false;

            // Static views will use CSS Layout instead of computing the layout in JS.
            this._isStaticView = false;
        },

        inlineUpdate: function() {
            requestAnimationFrame.runInlinesIfNeeded();
        },

        setNeedsTouchEvents: function(value) {
            if (this._needsTouchEvents == value)
                return this;
            if (this.$el && this.$el.length) {
                if (value)
                    this.installTouchEvents();
                else
                    this.removeTouchEvents();
            }
            this._needsTouchEvents = value;
            return this;
        },

        _triggerEvent: function(event, capture) {
            this.trigger(event.type + (capture ? ":capture" : ""), event);
        },

        _sendEventRecursive: function(event) {
            if (this._disabled || !this._visible)
                return;
            this._triggerEvent(event, true);
            if (event.cancelBubble)
                return;
            _.each(this.childrenViews(), function(view) {
                if (!event.cancelBubble)
                    view._sendEventRecursive(event);
            });
            if (!event.cancelBubble)
                this._triggerEvent(event, false);
        },

        isStaticView: function() {
            return this._isStaticView;
        },

        setIsStaticView: function(value) {
            if (this._isStaticView == value)
                return;
            this._isStaticView = value;
            this.invalidate("staticViewClassName");
            if (this._isStaticView) {
                // Make sure that we get up to date values.
                this.invalidate("position");
                this.invalidate("size");
            }
            return this;
        },

        addGestureDetector: function() {
            if (!this._gestureDetector)
                this._gestureDetector = new GestureDetector(this);
            return this;
        },

        animation: function() {
            if (!this._animation)
                this._animation = new AnimationSet(this);
            return this._animation;
        },

        hasAnimation: function() {
            return !!this._animation;
        },

        forceLayer: function() {
            // Force a 3D layer by activating the animation.
            this.animation();
            this.invalidate("transform");
            return this;
        },

        setElement: function(el) {
            if (this.$el) {
                this.$el.data("layer-view", null);
                this.removeTouchEvents();
            }
            LayerView.__super__.setElement.call(this, el);
            if (this.$el) {
                this.$el.data("layer-view", this);
                if (this._needsTouchEvents)
                    this.installTouchEvents();
            }
        },

        childrenViews: function() {
            var children = [];
            this.$el.children().each(function(i, child) {
                var layerView = $(child).data("layer-view");
                if (layerView)
                    children.push(layerView);
            });
            return children;
        },

        params: function() {
            return this._params;
        },

        setParams: function(params) {
            this._params = params;
            this.setNeedsLayout(true);
            return this;
        },

        ensureParams: function() {
            if (!this._params)
                this._params = new LayoutParams();
            this.setNeedsLayout(true);
            return this._params;
        },

        matchParentSize: function() {
            this.ensureParams().matchParentSize();
            return this;
        },

        matchLineHeight: function() {
            this.ensureParams().matchLineHeight(true);
            return this;
        },

        append: function(view) {
            requestAnimationFrame.setHadDOMUpdates();
            this.$el.append(view.$el);
            return this._childAdded(view, /* useAnimation */ false);
        },

        appendWithAnimation: function(view) {
            requestAnimationFrame.setHadDOMUpdates();
            this.$el.append(view.$el);
            return this._childAdded(view, /* useAnimation */ true);
        },

        prepend: function(view) {
            requestAnimationFrame.setHadDOMUpdates();
            this.$el.prepend(view.$el);
            return this._childAdded(view, /* useAnimation */ false);
        },

        before: function(view, otherView) {
            requestAnimationFrame.setHadDOMUpdates();
            otherView.$el.before(view.$el);
            return this._childAdded(view, /* useAnimation */ false);
        },

        beforeWithAnimation: function(view, otherView) {
            requestAnimationFrame.setHadDOMUpdates();
            otherView.$el.before(view.$el);
            return this._childAdded(view, /* useAnimation */ true);
        },

        after: function(view, otherView) {
            requestAnimationFrame.setHadDOMUpdates();
            otherView.$el.after(view.$el);
            return this._childAdded(view, /* useAnimation */ false);
        },

        afterWithAnimation: function(view, otherView) {
            requestAnimationFrame.setHadDOMUpdates();
            otherView.$el.after(view.$el);
            return this._childAdded(view, /* useAnimation */ true);
        },

        detachWithAnimation: function() {
            return this._internalDetachWithAnimation("detach");
        },

        removeWithAnimation: function() {
            return this._internalDetachWithAnimation("remove");
        },

        detach: function() {
            return this._internalDetach("detach");
        },

        remove: function() {
            return this._internalDetach("remove");
        },

        _internalDetachWithAnimation: function(detach) {
            if (this._state != LayerView.REMOVED) {
                var parentView = this.parent();
                if (parentView)
                    return parentView._childRemoved(this, detach, /*useAnimation*/ true);
                this._internalDetachRemove(detach);
            }
            return $.Deferred().resolveWith(this).promise();
        },

        _internalDetach: function(detach) {
            if (this._state == LayerView.REMOVED)
                return this;
            var parentView = this.parent();
            if (parentView)
                return parentView._childRemoved(this, detach, /* useAnimation */ false);
            this._internalDetachRemove(detach);
            return this;
        },

        _childAdded: function(view, useAnimation) {
            view.setNeedsLayout(true);
            this.setNeedsLayout(true);
            view._state = LayerView.VISIBLE;
            if (useAnimation) {
                view.everHadLayout = false;
                return this._animateAttach(view)
                    .then(function() { return view; });
            }
            return this;
        },

        _animateAttach: function(view) {
            return $.Deferred().resolveWith(view).promise();
        },

        _invalidateTouchRecursive: function() {
            this._invalidateTouch();
            _.each(this.childrenViews(), function(view) {
                view._invalidateTouchRecursive();
            });
        },

        _internalDetachRemove: function(detach) {
            requestAnimationFrame.setHadDOMUpdates();
            this._invalidateTouchRecursive();
            if (detach == "detach")
                this.$el.detach();
            else
                this.$el.remove();
        },

        _childRemoved: function(view, detach, useAnimation) {
            this.setNeedsLayout(true);
            view._state = LayerView.REMOVED;
            if (useAnimation) {
                return this._animateDetach(view).then(function() {
                    view._internalDetachRemove(detach);
                    return view;
                });
            } else {
                view._internalDetachRemove(detach);
            }
            return view;
        },

        _animateDetach: function(view) {
            return $.Deferred().resolveWith(view).promise();
        },

        shouldIgnoreDuringLayout: function() {
            return this._state == LayerView.REMOVED || this.isPositioned();
        },

        isPositioned: function() {
            var params = this.params();
            return params ? params.isPositioned() : false;
        },

        setIsPositioned: function(positioned) {
            if (positioned != this.isPositioned())
                this.ensureParams().setIsPositioned(positioned);
            return this;
        },

        addClass: function(className) {
            this.$el.addClass(className);
            return this;
        },

        removeClass: function(className) {
            this.$el.removeClass(className);
            return this;
        },

        hide: function() {
            if (!this._visible)
                return this;
            this._visible = false;
            this.invalidate("visibility");
            return this;
        },

        show: function() {
            if (this._visible)
                return this;
            this._visible = true;
            this.invalidate("visibility");
            return this;
        },

        setVisible: function(visible) {
            if (this._visible == visible)
                return this;
            this._visible = visible;
            this.invalidate("visibility");
            return this;
        },

        visible: function() {
            return this._visible;
        },

        setDisabled: function(disabled) {
            if (this._disabled == disabled)
                return;
            this._disabled = disabled;
            this.invalidate("disabled");
            return this;
        },

        disabled: function() {
            return this._disabled;
        },

        parent: function() {
            var parent = this.$el.parent();
            for (; parent.length; parent = parent.parent()) {
                var layerView = parent.data("layer-view");
                if (layerView)
                    return layerView;
            }
            return null;
        },

        layoutIfNeeded: function() {
            if (!this._needsLayout)
                return;
            this.layout();
        },

        layoutChildren: function() {
            this.setLayoutOnChildren();
            _.each(this.childrenViews(), function(view) {
                view.layoutIfNeeded();
            });
        },

        layoutBounds: function() {
            if (this._isStaticView)
                return;
            var params = this.params();
            if (!params)
                return;
            var parentView = this.parent();
            if (!parentView)
                return;

            // Take the whole width of the parent.
            if (params.width() == LayoutParams.MATCH_PARENT)
                this.setOuterWidth(parentView.bounds().width());

            // A simple number will be a percentage out of the parent view bounds.
            else if (_.isNumber(params.width()))
                this.setOuterWidth(parentView.bounds().width() * params.width());

            // Equivalent of "matchWidthOf".
            else if (_.isObject(params.width()))
                this.setOuterWidth(params.width().bounds().width());

            // Take the whole height of the parent.
            if (params.height() == LayoutParams.MATCH_PARENT)
                this.setOuterHeight(parentView.bounds().height());

            // A simple number will be a percentage out of the parent view bounds.
            else if (_.isNumber(params.height()))
                this.setOuterHeight(parentView.bounds().height() * params.height());

            // Equivalent of "matchHeightOf".
            else if (_.isObject(params.height()))
                this.setOuterHeight(params.height().bounds().height());

            if (params.x() == LayoutParams.CENTER)
                this.bounds().setX((parentView.bounds().width() - this.bounds().width()) / 2);

            if (params.y() == LayoutParams.CENTER)
                this.bounds().setY((parentView.bounds().height() - this.bounds().height()) / 2);
        },

        setOuterWidth: function(width) {
            this.bounds().setWidth(width - this.margin().horizontal() - this.padding().horizontal());
            return this;
        },

        setOuterHeight: function(height) {
            this.bounds().setHeight(height - this.margin().vertical() - this.padding().vertical());
        },

        setLayoutOnChildren: function() {
            if (!this.checkInvalidationFlag("size"))
                return;
            _.each(this.childrenViews(), function(view) {
                view.setNeedsLayout(true);
            });
        },

        layout: function() {
            this.layoutBounds();
            this.layoutChildren();
            this.setNeedsLayout(false);
        },

        setNeedsLayout: function(needsLayout) {
            if (this._needsLayout == needsLayout)
                return;
            this._needsLayout = needsLayout;
            if (needsLayout && this.$el.parent().length) {
                var parentView = this.parent();
                if (parentView) {
                    parentView.setNeedsLayout(needsLayout);
                } else {
                    requestAnimationFrame.once("layout", this.onBeforeUpdate, this).run();
                }
            }
        },

        onBeforeUpdate: function() {
            this.layoutIfNeeded();
        },

        updateLayout: function() {
            this.setNeedsLayout(true);
            return this;
        },

        setBounds: function(bounds) {
            this._bounds.set(bounds);
        },

        bounds: function() {
            return this._bounds;
        },

        setMargin: function(margin) {
            this._margin.set(margin);
        },

        margin: function() {
            return this._margin;
        },

        setPadding: function(padding) {
            this._padding.set(padding);
        },

        padding: function() {
            return this._padding;
        },

        outerWidth: function() {
            return this.bounds().width() +
                this.padding().horizontal() +
                this.margin().horizontal();
        },

        outerHeight: function() {
            return this.bounds().height() +
                this.padding().vertical() +
                this.margin().vertical();
        },

        paddingWidth: function() {
            return this.bounds().width() +
                this.padding().horizontal();
        },

        paddingHeight: function() {
            return this.bounds().height() +
                this.padding().vertical();
        },

        setTransform: function(transform) {
            this._transform.set(transform);
        },

        transform: function() {
            return this._transform;
        },

        setFilter: function(filter) {
            this._filter.set(filter);
        },

        filter: function() {
            return this._filter;
        },

        opacity: function() {
            return this._opacity;
        },

        setOpacity: function(opacity) {
            this._opacity = opacity;
            this._onOpacityChanged();
            return this;
        },

        getScreenRect: function() {
            return this.$el.get(0).getBoundingClientRect();
        },

        render: function() {
            this.$el.addClass("js-layer-view");
            this._validatePosition();
            this._validateSize();
            this._validateTransform();
            return this;
        },

        invalidate: function(type) {
            this._requestAnimationFrame();
            this._invalidationFlags[type] = true;
        },

        checkInvalidationFlag: function(type) {
            return this._invalidationFlags ? this._invalidationFlags[type] : false;
        },

        _requestAnimationFrame: function() {
            if (this._invalidationFlags)
                return;
            this._invalidationFlags = {};
            requestAnimationFrame(this._update.bind(this));
        },

        _update: function() {
            if (!this._invalidationFlags)
                return;
            var invalidationFlags = this._invalidationFlags;
            this._invalidationFlags = null;
            var self = this;
            _.each(invalidationFlags, function(enabled, type) {
                if (!enabled)
                    return;
                self._validate(type);
            });
            this.trigger("update");
        },

        _validate: function(type) {
            var fn = this["_validate" + _.string.capitalize(type)];
            if (fn)
                fn.call(this);
            else
                this.trigger("validate:" + type);
        },

        _validatePosition: function() {
            if (this._isStaticView)
                return;
            this.$el
                .css("left", this._bounds.x())
                .css("top", this._bounds.y());
        },

        _validateSize: function() {
            if (this._isStaticView)
                return;
            this.$el
                .css("width", this._bounds.width())
                .css("height", this._bounds.height());
            if (this._params && this._params.shouldMatchLineHeight())
                this.$el.css("line-height", this.bounds().height() + "px");
        },

        _validateTransform: function() {
            var result = this._transform;
            if (this._animation && !result.has3DTransforms())
                this.$el.css("transform", result.toString() + " translateZ(0)");
            else
                this.$el.css("transform", result.toString());
        },

        _validateFilter: function() {
            this.$el.css(Filter.propertyName, this._filter.toString());
        },

        _validateOpacity: function() {
            var result = this._opacity;
            this.$el.css("opacity", result);
        },

        _validateVisibility: function() {
            this.$el.toggleClass("js-layer-view-invisible", !this._visible);
        },

        _validateDisabled: function() {
            this.$el.toggleClass("js-layer-view-disabled", this._disabled);
        },

        _validatePadding: function() {
            this.$el.css("padding", this._padding.toCSSString("px"));
        },

        _validateMargin: function() {
            this.$el.css("margin", this._margin.toCSSString("px"));
        },

        _validateStaticViewClassName: function() {
            this.$el.toggleClass("js-static-view", this._isStaticView);
        },

        _onPositionChanged: function() {
            this.invalidate("position");
        },

        _onSizeChanged: function() {
            this.invalidate("size");
        },

        _onTransformChanged: function() {
            this.invalidate("transform");
        },

        _onFilterChanged: function() {
            this.invalidate("filter");
        },

        _onOpacityChanged: function() {
            this.invalidate("opacity");
        },

        _onPaddingChanged: function() {
            this.invalidate("padding");
            this.setNeedsLayout(true);
        },

        _onMarginChanged: function() {
            this.invalidate("margin");
        },

        _readParamsAttribute: function() {
            var paramsAttributes = this.$el.attr("data-params");
            if (!paramsAttributes)
                return;
            var params = this.ensureParams();
            _.each(paramsAttributes.split(","), function(value) {
                params[value].call(params, true);
            });
        },

        _readBoundsAttribute: function() {
            var boundsAttributes = this.$el.attr("data-bounds");
            if (!boundsAttributes)
                return;
            boundsAttributes = _.map(boundsAttributes.split(","), parseFloat);
            this.bounds()
                .setX(boundsAttributes[0])
                .setY(boundsAttributes[1])
                .setWidth(boundsAttributes[2])
                .setHeight(boundsAttributes[3]);
        },

        _readStaticAttribute: function() {
            var staticAttribute = this.$el.attr("data-static-view");
            if (staticAttribute === undefined)
                return;
            this.setIsStaticView(true);
        },

        readViewAttributes: function() {
            this._readParamsAttribute();
            this._readBoundsAttribute();
            this._readStaticAttribute();
        }
    });

    _.extend(LayerView, {
        VISIBLE: "visible",
        REMOVED: "removed"
    });

    return LayerView;

});

/*
 * Copyright (c) 2013 Adobe Systems Incorporated. All rights reserved.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

define('mobileui/ui/navigator-card-view',["mobileui/views/layer-view",
        "mobileui/views/layout-params"],
function(LayerView, LayoutParams) {

    var NavigatorCardView = LayerView.extend({

        initialize: function() {
            NavigatorCardView.__super__.initialize.call(this);
            this.matchParentSize();
            this._navigatorView = null;
            this.on("activate", this._onActivate, this);
        },

        render: function() {
            this.$el.addClass("js-navigator-card-view");
            return NavigatorCardView.__super__.render.call(this);
        },

        // Called by the navigator when this view is set active.
        _setNavigatorView: function(navigatorView) {
            if (this._navigatorView === navigatorView)
                return this;
            this._navigatorView = navigatorView;
            this.trigger("change:navigatorView");
            this.trigger(this._navigatorView ? "attached" : "detached");
            this.setNeedsLayout(true);
            return this;
        },

        navigatorView: function() {
            return this._navigatorView;
        },

        needsTopBar: function() {
            return true;
        },

        displaysOnTop: function() {
            return false;
        },

        hasLayoutMarginFromTopBar: function() {
            return true;
        },

        layout: function() {
            var topBarView = this.topBarView();
            if (topBarView)
                this.margin().setTop(this.needsTopBar() && !this.displaysOnTop() && this.hasLayoutMarginFromTopBar() ?
                    topBarView.bounds().height() : 0);
            NavigatorCardView.__super__.layout.call(this);
        },

        _onActivate: function() {
            this.updateRouterLocation();
            this._updateNavigationBar();
        },

        _updateNavigationBar: function() {
            var topBarView = this.topBarView();
            if (topBarView)
                topBarView.updateVisiblity(this.needsTopBar());
        },

        updateRouterLocation: function() {
            // override this method.
        },

        topBarView: function() {
            return this._navigatorView ? this._navigatorView.topBarView() : null;
        },

        // Overwrite this to provide better history support, when the previous
        // slides are not in the history if the navigator.
        previousCard: function() {
            return null;
        },

        hasPreviousCard: function() {
            return false;
        },

        nextCard: function() {
            return null;
        },

        hasNextCard: function() {
            return false;
        }

    });

    return NavigatorCardView;
});
/*
 * Copyright (c) 2013 Adobe Systems Incorporated. All rights reserved.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

define('mobileui/utils/momentum',["mobileui/utils/time"], function(Time) {

    function computeDirection(x) { return x >= 0 ? 1 : -1; }

    var Momentum = function(duration) {
        this._duration = duration;
        this._friction = 0.005;
        this.reset(0);
    };

    _.extend(Momentum.prototype, Backbone.Events, {
        setDuration: function(duration) {
            this._duration = duration;
            return this;
        },

        setFriction: function(friction) {
            this._friction = friction;
            return this;
        },

        reset: function(startValue) {
            this._currentValue = startValue;
            this._direction = 0;
            this._internalResetGesture();
        },

        computeDelta: function() {
            var time = Time.now(),
                duration = time - this._startTime;
            if (!duration)
                return 0;
            var velocity = (this._currentValue - this._startValue) / duration;
            return Math.max(0, velocity * velocity * this._duration - this._friction * this._duration * this._duration) * computeDirection(velocity);
        },

        compute: function() {
            var delta = this.computeDelta();
            return this._currentValue + delta;
        },

        _internalResetGesture: function() {
            this._startValue = this._currentValue;
            this._startTime = Time.now();
        },

        injectValue: function(value) {
            if (this._currentValue == value)
                return;
            var direction = computeDirection(this._currentValue - value);
            if (this._direction != direction) {
                if (this._direction)
                    this._internalResetGesture();
                this._direction = direction;
            }
            this._currentValue = value;
        },

        direction: function() {
            return this._direction;
        }
    });

    return Momentum;

});
/*
 * Copyright (c) 2013 Adobe Systems Incorporated. All rights reserved.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

define('mobileui/utils/lock',[],function() {

    return _.extend({}, Backbone.Events, {
        _inTransition: false,

        startTransition: function(view) {
            this._inTransition = true;
        },

        endTransition: function(view) {
            this._inTransition = false;
        },

        canStartTransition: function() {
            return !this._inTransition;
        }
    });

});
define('mobileui/ui/app-card-view',["mobileui/ui/navigator-card-view",
        "mobileui/views/layer-view",
        "mobileui/utils/transform",
        "mobileui/utils/filter",
        "mobileui/utils/momentum",
        "mobileui/views/gesture-detector",
        "mobileui/utils/lock"],
    function(NavigatorCardView, LayerView, Transform, Filter, Momentum, GestureDetector, lock) {

    var AppCardView = NavigatorCardView.extend({
        initialize: function() {
            AppCardView.__super__.initialize.call(this);
            this.addGestureDetector();
            this.on("touchdragstart", this._onDragStart, this)
                .on("touchdragmove", this._onDragMove, this)
                .on("touchdragend", this._onDragEnd, this);
            this._momentum = new Momentum().setDuration(300).setFriction(0.000005);
            this._dragStartValue = 0;
            this.forceLayer();
        },

        render: function() {
            this.$el.addClass("js-app-card-view");
            return AppCardView.__super__.render.call(this);
        },

        respondsToTouchGesture: function(gesture) {
            if (!lock.canStartTransition() || gesture.type != GestureDetector.GestureType.DRAG)
                return false;
            return (gesture.scrollX && gesture.distanceX < 0 &&
                this.navigatorView().activeCard() === this &&
                this.navigatorView().canGoBack());
        },

        _backgroundViewOpacity: 0.7,
        _backgroundViewScale: 0.95,

        _ensureGrayscaleOverlay: function() {
            if (!this._grayscaleOverlay) {
                this._grayscaleOverlay = new LayerView()
                    .setDisabled(true)
                    .matchParentSize().setOpacity(this._backgroundViewOpacity).render()
                    .addClass("js-app-card-grayscale-overlay");
            }
            return this._grayscaleOverlay;
        },

        _onDragStart: function() {
            lock.startTransition(this);
            var nextCard = this.navigatorView().prepareHistoryCard().nextCard();
            this._ensureGrayscaleOverlay();
            nextCard.parent().after(this._grayscaleOverlay, nextCard);
            nextCard.transform().get("scale")
                .setX(this._backgroundViewScale)
                .setY(this._backgroundViewScale);
            nextCard.filter().get("grayscale").setIntensity(100);
            var translate = this.transform().get("translate");
            this._dragStartValue = translate.x();
            this._momentum.reset(this._dragStartValue);
        },

        _onDragMove: function(transform) {
            var translate = this.transform().get("translate"),
                value = Math.max(0, this._dragStartValue + transform.dragX);
            translate.setX(value);
            var nextCard = this.navigatorView().nextCard(),
                percentCovered = value / this.bounds().width();
            nextCard.filter().get("grayscale").setIntensity(100 - percentCovered * 100);
            this._grayscaleOverlay.setOpacity(this._backgroundViewOpacity - percentCovered * this._backgroundViewOpacity);
            var scale = this._backgroundViewScale + percentCovered * (1 - this._backgroundViewScale);
            nextCard.transform().get("scale")
                .setX(scale)
                .setY(scale);
            if (nextCard.displaysOnTop()) {
                // Take the menu with us.
                this.topBarView().transform().get("translate").setX(value);
            }
            this._momentum.injectValue(value);
        },

        _onDragEnd: function(transform) {
            this._onDragMove(transform);
            var value = this._momentum.compute() * 4,
                direction = this._momentum.direction();
            if ((value < this.bounds().width()) || (direction > 0))
                return this._revert();
            this._commit();
        },

        _commit: function() {
            var nextCard = this.navigatorView().nextCard();
            this.navigatorView().precommitNextCard();
            var transform = new Transform().translate(this.bounds().width(), 0);
            this.setDisabled(true)
                .animation().start().get("slide-transform")
                .chain()
                .transform(300, transform)
                .callback(function() {
                    this.setDisabled(false)
                        ._removeGrayscaleOverlay();
                    nextCard.filter().clear();
                    lock.endTransition(this);
                    this.navigatorView().commitNextCard();
                }, this);
            this.animation().get("slide")
                .chain()
                .opacity(300, 100);
            nextCard.animation().start().get("slide-filter")
                .chain()
                .filter(300, new Filter().grayscale(0));
            nextCard.animation().get("slide-transform")
                .chain()
                .transform(300, new Transform().scale(1, 1))
                .callback(function() {
                    nextCard.transform().clear();
                });
            if (nextCard.displaysOnTop()) {
                // Take the menu with us.
                var topBarView = this.topBarView();
                topBarView.animation().start().get("card-slide")
                    .removeAll()
                    .chain()
                    .transform(300, new Transform().translate(this.bounds().width(), 0))
                    .callback(function() {
                        topBarView.transform().clear();
                    });
            }
            this._grayscaleOverlay.animation().start().get("slide-opacity")
                .chain()
                .opacity(300, 0);
        },

        _revert: function() {
            var nextCard = this.navigatorView().nextCard(),
                transform = new Transform();
            this.animation().start().get("slide-transform").chain()
                .transform(100, transform)
                .callback(function() {
                    this._removeGrayscaleOverlay();
                    lock.endTransition(this);
                    this.navigatorView().revertNextCard();
                }, this);
            this.animation().get("slide")
                .chain()
                .opacity(100, 1);
            nextCard.animation().start().get("slide-filter")
                .chain()
                .filter(100, new Filter().grayscale(100))
                .callback(function() {
                    nextCard.filter().clear();
                });
            nextCard.animation().get("slide-transform")
                .chain()
                .transform(100, new Transform().scale(this._backgroundViewScale, this._backgroundViewScale))
                .callback(function() {
                    nextCard.transform().clear();
                });
            if (nextCard.displaysOnTop()) {
                // Take the menu with us.
                this.topBarView().animation().start().get("card-slide")
                    .removeAll()
                    .chain()
                    .transform(100, new Transform());
            }
            this._grayscaleOverlay.animation().start().get("slide-opacity")
                .chain()
                .opacity(100, this._backgroundViewOpacity);
        },

        _removeGrayscaleOverlay: function() {
            if (!this._grayscaleOverlay)
                return;
            this._grayscaleOverlay.remove();
            this._grayscaleOverlay = null;
        },

        _onActivate: function(options) {
            AppCardView.__super__._onActivate.call(this, options);
            if (!lock.canStartTransition())
                return;
            var prevCard = options.previousCard;
            if (!prevCard)
                return;
            if (options.goingBack) {
                if (prevCard._animateBackButton)
                    prevCard._animateBackButton(this, options);
            } else {
                if (prevCard._animateForwardButton)
                    prevCard._animateForwardButton(this, options);
            }
        },

        _animateForwardButton: function(nextCard, options) {
            var self = this;
            lock.startTransition();
            this._ensureGrayscaleOverlay();
            this.parent().after(this._grayscaleOverlay, this);
            var transform = new Transform().scale(this._backgroundViewScale, this._backgroundViewScale);
            this.animation().start().get("slide-transform")
                .chain()
                .transform(300, transform)
                .callback(function() {
                    self._removeGrayscaleOverlay();
                    nextCard.filter().clear();
                    lock.endTransition(self);
                });
            this.animation().get("slide-opacity")
                .chain()
                .opacity(300, 0);
            nextCard.animation().start().get("slide-filter")
                .chain()
                .filter(300, new Filter().grayscale(100), new Filter().grayscale(0));
            nextCard.transform().get("translate").setX(this.bounds().width());
            nextCard.animation().get("slide-transform")
                .chain()
                .transform(300,
                    new Transform())
                .callback(function() {
                    nextCard.transform().clear();
                });
            this._grayscaleOverlay.setOpacity(0)
                .animation().start().get("slide-opacity")
                .chain()
                .opacity(300, this._backgroundViewOpacity);

            options.promise = this.animation().promise();
        },

        _animateBackButton: function(nextCard, options) {
            var self = this;
            lock.startTransition();
            this._ensureGrayscaleOverlay();
            nextCard.parent().after(this._grayscaleOverlay, nextCard);
            var transform = new Transform().translate(this.bounds().width(), 0);
            this.animation().start().get("slide-transform")
                .chain()
                .transform(300, transform)
                .callback(function() {
                    self._removeGrayscaleOverlay();
                    nextCard.filter().clear();
                    lock.endTransition(self);
                });
            this.animation().get("slide")
                .chain()
                .opacity(300, 100);
            nextCard.animation().start().get("slide-filter")
                .chain()
                .filter(300, new Filter().grayscale(100), new Filter().grayscale(0));
            nextCard.animation().get("slide-transform")
                .chain()
                .transform(300,
                    new Transform().scale(this._backgroundViewScale, this._backgroundViewScale),
                    new Transform().scale(1, 1))
                .callback(function() {
                    nextCard.transform().clear();
                });
            if (nextCard.displaysOnTop()) {
                // Take the menu with us.
                var topBarView = this.topBarView();
                topBarView.animation().start().get("card-slide")
                    .removeAll()
                    .chain()
                    .transform(300, new Transform().translate(this.bounds().width(), 0))
                    .callback(function() {
                        topBarView.transform().clear();
                    });
            }
            this._grayscaleOverlay.animation().start().get("slide-opacity")
                .chain()
                .opacity(300, this._backgroundViewOpacity, 0);

            options.promise = this.animation().promise();
        }

    });

    return AppCardView;

});
/*
 * Copyright (c) 2013 Adobe Systems Incorporated. All rights reserved.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

define('mobileui/views/gesture-view',["mobileui/views/layer-view",
        "mobileui/views/gesture-detector"],
function(LayerView, GestureDetector) {

    var GestureView = LayerView.extend({

        initialize: function() {
            GestureView.__super__.initialize.call(this);
            this.addGestureDetector();
        },

        render: function() {
            this.$el.addClass("js-gesture-view");
            return GestureView.__super__.render.call(this);
        }

    });

    return GestureView;
});
/*
 * Copyright (c) 2013 Adobe Systems Incorporated. All rights reserved.
 * 
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 * 
 *     http://www.apache.org/licenses/LICENSE-2.0
 * 
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

define('mobileui/utils/effects/base-effect',[],function() {

    function BaseEffect() { }
    _.extend(BaseEffect.prototype, {
        isSupported: function() {
            return false;
        },

        onDragStart: function(containerView, filterView, nextCard) {
            return 0;
        },

        onDragMove: function(containerView, filterView, nextCard, transform, dragStartValue) {
            return 0;
        },

        shouldRevert: function(containerView, value, direction) {
            return false;
        },

        commit: function(duration, containerView, filterView, nextCard) {
            return null;
        },

        revert: function(duration, containerView, filterView, nextCard) {
            return null;
        },

        cleanup: function(containerView, filterView, nextCard) {
        }
    });

    return BaseEffect;

});

/*
 * Copyright (c) 2013 Adobe Systems Incorporated. All rights reserved.
 * 
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 * 
 *     http://www.apache.org/licenses/LICENSE-2.0
 * 
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

define('mobileui/utils/effects/drag-effect',["mobileui/utils/effects/base-effect",
        "mobileui/utils/transform",
        "mobileui/utils/filter"],
    function(BaseEffect, Transform, Filter) {

    function DragEffect(useGrayscale) {
        BaseEffect.call(this);
        this._useGrayscale = useGrayscale;
    }

    _.extend(DragEffect.prototype, BaseEffect.prototype, {
        isSupported: function() {
            return true;
        },

        onDragStart: function(containerView, filterView, nextCard, verticalLayout) {
            containerView.animation().removeAll();
            if (this._useGrayscale)
                nextCard.filter().get("grayscale").setIntensity(100);
            nextCard.setOpacity(0.5);

            var translate = containerView.forceLayer().transform().get("translate");
            return verticalLayout ? translate.x() : translate.y();
        },

        onDragMove: function(containerView, filterView, nextCard, transform, dragStartValue, verticalLayout) {
            var translate = containerView.transform().get("translate"),
                grayscale = this._useGrayscale ? nextCard.filter().get("grayscale") : null,
                value;
            if (verticalLayout) {
                value = Math.min(0, dragStartValue + transform.dragX);
                translate.setX(value);
                if (this._useGrayscale)
                    grayscale.setIntensity(100 + value / containerView.bounds().width() * 100);
                nextCard.setOpacity(-value / containerView.bounds().width() / 2 + 0.5);
            } else {
                value = Math.min(0, dragStartValue + transform.dragY);
                translate.setY(value);
                if (this._useGrayscale)
                    grayscale.setIntensity(100 + value / containerView.bounds().height() * 100);
                nextCard.setOpacity(-value / containerView.bounds().height() / 2 + 0.5);
            }
            return value;
        },

        shouldRevert: function(containerView, value, direction, verticalLayout) {
            value *= 4;
            return ((verticalLayout && ((value > - containerView.bounds().width()) || (direction < 0))) ||
                (!verticalLayout && ((value > - containerView.bounds().height()) || (direction < 0))));
        },

        commit: function(commitDuration, containerView, filterView, nextCard, verticalLayout) {
            var chain = containerView.animation().start().get("slide-transform").chain(),
                transform = new Transform();

            if (verticalLayout)
                transform.translate(-containerView.bounds().width(), 0);
            else
                transform.translate(0, -containerView.bounds().height());
            chain = chain
                .transform(commitDuration, transform)
                .setTimingFunction("easeOut");

            if (this._useGrayscale) {
                nextCard.animation().start().get("slide-filter")
                    .chain()
                    .filter(commitDuration, new Filter().grayscale(0));
            }
            nextCard.animation().start().get("slide-opacity")
                .chain()
                .opacity(commitDuration, 1);

            return chain;
        },

        revert: function(revertDuration, containerView, filterView, nextCard) {
            var chain = containerView.animation().start().get("slide-transform").chain();
            chain = chain
                .transform(revertDuration, new Transform())
                .setTimingFunction("easeOut");

            if (this._useGrayscale) {
                nextCard.animation().start().get("slide-filter")
                    .chain()
                    .filter(revertDuration, new Filter().grayscale(100));
            }
            nextCard.animation().start().get("slide-opacity")
                .chain()
                .opacity(revertDuration, 0.5);

            return chain;
        },

        cleanup: function(containerView, filterView, nextCard) {
            nextCard.filter().clear();
        }
    });

    return DragEffect;

});

define('mobileui/utils/base64',[],function() {

    function generateBase64Alphabet() {
        var a = {},
            charCodeUpperA = "A".charCodeAt(0),
            charCodeLowerA = "a".charCodeAt(0) - 26,
            charCode0 = "0".charCodeAt(0) - 52,
            i;
        for (i = 0; i < 26; ++i)
            a[i] = String.fromCharCode(charCodeUpperA + i);
        for (i = 26; i < 52; ++i)
            a[i] = String.fromCharCode(charCodeLowerA + i);
        for (i = 52; i < 62; ++i)
            a[i] = String.fromCharCode(charCode0 + i);
        a[62] = "+";
        a[63] = "/";
        return a;
    }

    var base64Alphabet;
    var base64 = {
        encode: function(val) {
            if (!base64Alphabet)
                base64Alphabet = generateBase64Alphabet();
            var result = "",
                alphabet = base64Alphabet;
            for (var i = 0; i < val.length; i += 3) {
                // 1111 11 | 11 2222 | 22 22 33 | 33 3333
                // 1111 11 | 22 2222 | 33 33 33 | 44 4444
                var remaining = val.length - i,
                    a = val.charCodeAt(i),
                    b = (remaining > 1) ? val.charCodeAt(i + 1) : 0,
                    c = (remaining > 2) ? val.charCodeAt(i + 2) : 0,
                    x1 = (a & 0xFC) >> 2,
                    x2 = ((a & 0x3) << 4) | ((b & 0xF0) >> 4),
                    x3 = ((b & 0xF) << 2) | ((c & 0xC0) >> 6),
                    x4 = c & 0x3F;

                switch (remaining) {
                    case 1:
                        result += alphabet[x1] + alphabet[x2] + "==";
                        break;
                    case 2:
                        result += alphabet[x1] + alphabet[x2] + alphabet[x3] + "=";
                        break;
                    default:
                        result += alphabet[x1] + alphabet[x2] + alphabet[x3] + alphabet[x4];
                }
            }
            return result;
        },

        url: function(data) {
            return "data:text/plain;base64," + base64.encode(data);
        }
    };

    return base64;

});
/*
 * Copyright (c) 2013 Adobe Systems Incorporated. All rights reserved.
 * 
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 * 
 *     http://www.apache.org/licenses/LICENSE-2.0
 * 
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/* Module based on requirejs.text to provide ahead of time base64 encoding. */
define('mobileui/utils/base64-text',['mobileui/utils/underscore', 'mobileui/utils/text-module', 'mobileui/utils/base64'], function (_, text, base64) {

    var base64_text = _.extend({}, text, {
        encodeContent: base64.encode
    });

    return base64_text;

});

define('mobileui/utils/base64-text!mobileui/utils/filters/shaders/fold.vert',[],function () { return "LyoNCiAqIENvcHlyaWdodCAoYykgMjAxMyBBZG9iZSBTeXN0ZW1zIEluY29ycG9yYXRlZC4gQWxsIHJpZ2h0cyByZXNlcnZlZC4NCiAqDQogKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsNCiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4NCiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdA0KICoNCiAqICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjANCiAqDQogKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlDQogKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLA0KICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuDQogKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kDQogKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4NCiAqLw0KDQpwcmVjaXNpb24gbWVkaXVtcCBmbG9hdDsNCg0KLy8gQnVpbHQtaW4gYXR0cmlidXRlcy4NCg0KYXR0cmlidXRlIHZlYzQgYV9wb3NpdGlvbjsNCmF0dHJpYnV0ZSB2ZWMyIGFfdGV4Q29vcmQ7DQphdHRyaWJ1dGUgdmVjMiBhX21lc2hDb29yZDsNCmF0dHJpYnV0ZSB2ZWMzIGFfdHJpYW5nbGVDb29yZDsNCg0KLy8gQnVpbHQtaW4gdW5pZm9ybXMuDQoNCnVuaWZvcm0gbWF0NCB1X3Byb2plY3Rpb25NYXRyaXg7DQp1bmlmb3JtIHZlYzIgdV9tZXNoU2l6ZTsNCg0KLy8gVW5pZm9ybXMgcGFzc2VkLWluIGZyb20gQ1NTDQoNCnVuaWZvcm0gbWF0NCB0cmFuc2Zvcm07DQp1bmlmb3JtIGZsb2F0IGRyYWdfZGlzdGFuY2U7DQp1bmlmb3JtIGZsb2F0IGxpZ2h0X2ludGVuc2l0eTsNCnVuaWZvcm0gZmxvYXQgcGFkZGluZ19oZWlnaHQ7DQp1bmlmb3JtIGZsb2F0IG1hcmdpbl9oZWlnaHQ7DQp1bmlmb3JtIGZsb2F0IGRvd25feDsNCg0KLy8gVmFyeWluZ3MNCg0KdmFyeWluZyBmbG9hdCB2X2xpZ2h0aW5nOw0KDQovLyBDb25zdGFudHMNCg0KY29uc3QgZmxvYXQgUEkgPSAzLjE0MTU2Mjk7DQoNCi8vIE1haW4NCg0Kdm9pZCBtYWluKCkNCnsNCiAgICB2ZWM0IHBvcyA9IGFfcG9zaXRpb247DQoNCiAgICBib29sIHJpZ2h0U2lkZSA9IChhX3RyaWFuZ2xlQ29vcmQueiA9PSAyLjAgfHwgYV90cmlhbmdsZUNvb3JkLnogPT0gMy4wIHx8IGFfdHJpYW5nbGVDb29yZC56ID09IDUuMCk7DQogICAgYm9vbCBib3R0b21TaWRlID0gKGFfdHJpYW5nbGVDb29yZC56ID09IDMuMCB8fCBhX3RyaWFuZ2xlQ29vcmQueiA9PSA1LjAgfHwgYV90cmlhbmdsZUNvb3JkLnogPT0gNi4wKTsNCiAgICBib29sIGlzU2hhZG93ID0gdV9tZXNoU2l6ZS55IC0gYV90cmlhbmdsZUNvb3JkLnkgIDw9IDEuMDsNCg0KICAgIGZsb2F0IGNvb3JkID0gYV90cmlhbmdsZUNvb3JkLnggKyAocmlnaHRTaWRlID8gMS4wIDogMC4wKTsNCiAgICBmbG9hdCBkb3duX2NvbCA9IGRvd25feCAqIHVfbWVzaFNpemUueDsNCiAgICBmbG9hdCByYXRpbyA9IGNvcygoZG93bl9jb2wgLSBjb29yZCkgLyBkb3duX2NvbCAqIFBJIC8gMi4wICkgKiBkcmFnX2Rpc3RhbmNlOw0KDQogICAgaWYgKGNvb3JkIDwgZG93bl9jb2wgKSB7DQogICAgICAgIHBvcy55ID0gcG9zLnkgKyBtb2QoY29vcmQsIDIuMCkgICogcGFkZGluZ19oZWlnaHQgKiByYXRpbzsNCiAgICAgICAgcG9zLnggPSBwb3MueCAtIChkb3duX2NvbCAtIGNvb3JkKSAvIGRvd25fY29sICogZHJhZ19kaXN0YW5jZSAqICggMS4wIC0gcmF0aW8pICogLjU7DQogICAgICAgIHZfbGlnaHRpbmcgPSAuNSArIChtb2QoYV90cmlhbmdsZUNvb3JkLngsIDIuMCkgLSAuNSkgKiByYXRpbyAqIGxpZ2h0X2ludGVuc2l0eTsNCiAgICB9IGVsc2Ugew0KICAgICAgICBwb3MueCA9IHBvcy54ICsgZHJhZ19kaXN0YW5jZSAqICgxLjAgLSBkb3duX3gpICogLjM7DQogICAgICAgIHZfbGlnaHRpbmcgPSAuNTsNCiAgICB9DQogICAgaWYoaXNTaGFkb3cpIHsNCiAgICAgICAgaWYoYm90dG9tU2lkZSkgew0KICAgICAgICAgICAgcG9zLnggLT0gIGNvb3JkIDwgZG93bl9jb2wgPyAobW9kKGNvb3JkLCAyLjApICAqIHBhZGRpbmdfaGVpZ2h0ICogcmF0aW8pICogLjEgOiAuMDsNCiAgICAgICAgICAgIHBvcy55IC09ICBtYXJnaW5faGVpZ2h0ICsgKCBjb29yZCA8IGRvd25fY29sID8gKG1vZChjb29yZCwgMi4wKSAgKiBwYWRkaW5nX2hlaWdodCAqIHJhdGlvKSAqIDIuMCA6IC4wKTsNCiAgICAgICAgICAgIHBvcy56ID0gMS4wOw0KICAgICAgICAgICAgdl9saWdodGluZyA9IC4wOw0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgcG9zLnkgLT0gbWFyZ2luX2hlaWdodCAtIHBhZGRpbmdfaGVpZ2h0Ow0KICAgICAgICAgICAgcG9zLnogPSAxLjA7DQogICAgICAgICAgICB2X2xpZ2h0aW5nID0gLjA7DQogICAgICAgIH0NCiAgICB9DQoNCiAgICBnbF9Qb3NpdGlvbiA9IHVfcHJvamVjdGlvbk1hdHJpeCAqIHRyYW5zZm9ybSAqIHBvczsNCg0KfQ0K";});

define('mobileui/utils/base64-text!mobileui/utils/filters/shaders/fold.frag',[],function () { return "LyoNCiAqIENvcHlyaWdodCAoYykgMjAxMyBBZG9iZSBTeXN0ZW1zIEluY29ycG9yYXRlZC4gQWxsIHJpZ2h0cyByZXNlcnZlZC4NCiAqIA0KICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7DQogKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuDQogKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQNCiAqIA0KICogICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMA0KICogDQogKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlDQogKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLA0KICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuDQogKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kDQogKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4NCiAqLw0KDQpwcmVjaXNpb24gbWVkaXVtcCBmbG9hdDsNCg0KLy8gVmFyeWluZ3MNCg0KdmFyeWluZyBmbG9hdCB2X2xpZ2h0aW5nOw0KDQovLyBNYWluDQoNCnZvaWQgbWFpbigpDQp7DQogICAgY3NzX01peENvbG9yID0gdmVjNCh2X2xpZ2h0aW5nLCB2X2xpZ2h0aW5nLCB2X2xpZ2h0aW5nLCAxLjApOw0KfQ==";});

/*
 * Copyright (c) 2013 Adobe Systems Incorporated. All rights reserved.
 * 
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 * 
 *     http://www.apache.org/licenses/LICENSE-2.0
 * 
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

define('mobileui/utils/filters/fold',["mobileui/utils/filter",
        "mobileui/utils/base64-text!mobileui/utils/filters/shaders/fold.vert",
        "mobileui/utils/base64-text!mobileui/utils/filters/shaders/fold.frag"], function(Filter, vert, frag) {

    var header = "custom(url(data:text/plain;base64," + vert +
        ") mix(url(data:text/plain;base64," + frag + ") overlay source-atop)";

    return Filter.registerCustomFilter("fold", "width height startPosition currentPosition paddingHeight marginHeight segmentsY",
        function(fn) {
            var distance = Math.min(0, fn._currentPosition - fn._startPosition),
                segYPixelRatio =  1 / fn._segmentsY / fn._paddingHeight;
            var result = header + ", " +
             "11 " + fn._segmentsY + " detached" +
             ", drag_distance " + (distance / fn._width).toFixed(6) +
             ", light_intensity 0.5" +
             ", padding_height " + (fn._paddingHeight * segYPixelRatio).toFixed(6) +
             ", margin_height " + (fn._marginHeight * segYPixelRatio).toFixed(6) +
             ", down_x " + (fn._startPosition / fn._width).toFixed(6) +
             ", transform translate3d(" + (distance / 2).toFixed(6) + "px, 0, 0)" +
             ")";

            return result;
    });
});
/*
 * Copyright (c) 2013 Adobe Systems Incorporated. All rights reserved.
 * 
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 * 
 *     http://www.apache.org/licenses/LICENSE-2.0
 * 
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

define('mobileui/utils/effects/fold-effect',["mobileui/views/layer-view",
        "mobileui/utils/effects/base-effect",
        "mobileui/utils/filter",
        "mobileui/utils/transform",
        "mobileui/utils/filters/fold"],
    function(LayerView, BaseEffect, Filter, Transform, Fold) {

    var shadowSize = 40;

    function FoldEffect(useShadow, useGrayscale) {
        BaseEffect.call(this);
        this._useShadow = useShadow;
        this._useGrayscale = useGrayscale;
    }

    _.extend(FoldEffect.prototype, BaseEffect.prototype, {
        isSupported: function() {
            return Filter.supportsCustomFilters;
        },

        _ensureMarginLayer: function(view) {
            if (!view._filterMarginLayer) {
                view._filterMarginLayer = new LayerView().addClass("js-fold-effect-filter-margin");
                view.prepend(view._filterMarginLayer.render());

                var shadow = new LayerView().addClass("js-fold-effect-filter-margin-shadow");
                shadow.ensureParams().matchParentWidth();
                shadow.bounds().setHeight(shadowSize);
                view._filterMarginLayer.append(shadow.render());
                view._filterMarginLayer._shadow = shadow;
            }
            return view._filterMarginLayer;
        },

        _removeMarginLayer: function(view) {
            if (!view._filterMarginLayer)
                return;
            view._filterMarginLayer.remove();
            view._filterMarginLayer = null;
        },

        onDragStart: function(containerView, filterView, nextCard, verticalLayout, touch) {
            containerView.animation().removeAll();
            // Compute the mesh and the margin of the effect
            // so that we get exactly one tile for the shadow.
            var itemHeight = filterView.bounds().height(),
                segmentsY = Math.ceil(itemHeight / shadowSize) + 2,
                marginHeight = (segmentsY * shadowSize - itemHeight) / 2;

            var filterMargins = this._ensureMarginLayer(filterView);
            filterMargins.bounds()
                .setY(-marginHeight)
                .setHeight(itemHeight + 2 * marginHeight)
                .setX(0)
                .setWidth(filterView.bounds().width());
            filterMargins._shadow.bounds()
                .setY(filterMargins.bounds().height() - shadowSize);

            var fold = filterView.forceLayer().filter()
                .get("fold")
                .setSegmentsY(segmentsY)
                .setPaddingHeight(shadowSize)
                .setMarginHeight(marginHeight)
                .setStartPosition(touch.currentPosition.localX)
                .setCurrentPosition(touch.currentPosition.localX)
                .setWidth(containerView.bounds().width())
                .setHeight(containerView.bounds().height());
            if (this._useShadow)
                containerView.filter().get("dropShadow").setRadius(10).setColor(0);
            containerView.addClass("js-touch-item-view-fold-filter");
            return -this._computeFilterValue(0) * containerView.bounds().width();
        },

        _minShadow: 0.7,
        _maxShadow: 1,

        _computeShadow: function(t) {
            return (1 - t) * (this._maxShadow - this._minShadow) + this._minShadow;
        },

        _minFilterValue: 0.0,
        _maxFilterValue: 1.0,

        _computeFilterValue: function(t) {
            return this._minFilterValue + t * (this._maxFilterValue - this._minFilterValue);
        },

        onDragMove: function(containerView, filterView, nextCard, transform, dragStartValue) {
            var value = Math.min(0, dragStartValue + transform.dragX);
            var t = Math.min(1, Math.max(0, - value / containerView.bounds().width()));
            
            filterView.transform().get("translate")
                .setX(Math.min(0, (dragStartValue + transform.dragX) / 2));

            filterView.filter().get("fold")
                .setCurrentPosition(transform.touch.currentPosition.localX);

            if (this._useShadow)
                containerView.filter().get("dropShadow").setRadius(10).setColor(t);

            if (this._useGrayscale)
                nextCard.filter().get("grayscale").setIntensity(100 - t * 100);
            nextCard.setOpacity(t / 2 + 0.5);
            return value;
        },

        shouldRevert: function(containerView, value, direction) {
            value *= 4;
            return (value > - containerView.bounds().width()) || (direction < 0);
        },

        commit: function(commitDuration, containerView, filterView, nextCard) {
            var chain = containerView.animation().start().get("slide-opacity").chain();

            if (this._useShadow) {
                var filterShadow = new Filter();
                filterShadow.get("dropShadow").setRadius(10).setColor(0);
                chain = chain.filter(commitDuration, filterShadow);
            } else {
                // No filter on the main element, so just do a simple wait.
                chain = chain.wait(commitDuration);
            }

            var startPosition = filterView.filter().get("fold").startPosition();
            filterView.animation().start().get("slide-transform")
                .chain()
                .transform(commitDuration,
                    new Transform().translate(startPosition - 1.5 * containerView.bounds().width(), 0))
                .setTimingFunction("easeOut");

            var filter = filterView.filter().clone();
            filter.get("fold")
                .setCurrentPosition(0);
            filterView.animation().start().get("slide-filter")
                .chain()
                .filter(commitDuration, filter)
                .setTimingFunction("easeOut");

            if (this._useGrayscale) {
                nextCard.animation().start().get("slide-filter")
                    .chain()
                    .filter(commitDuration, new Filter().grayscale(0));
            }
            nextCard.animation().start().get("slide-opacity")
                .chain()
                .opacity(commitDuration, 1);

            return chain;
        },

        revert: function(revertDuration, containerView, filterView, nextCard) {
            var chain = containerView.animation().start().get("slide-opacity").chain();

            if (this._useShadow) {
                var filterShadow = new Filter();
                filterShadow.get("dropShadow")
                    .setRadius(10)
                    .setColor(0);
                chain = chain.filter(revertDuration, new Filter());
            } else {
                // No filter on the main element, so just do a simple wait.
                chain = chain.wait(revertDuration);
            }

            filterView.animation().start().get("slide-transform")
                .chain()
                .transform(revertDuration,
                    new Transform().translate(0, 0))
                .setTimingFunction("easeOut");

            var filter = filterView.filter().clone();
            filter.get("fold")
                .setCurrentPosition(filterView.filter().get("fold").startPosition());

            filterView.animation().start().get("slide-filter")
                .chain()
                .filter(revertDuration, filter)
                .setTimingFunction("easeOut");

            containerView.animation().get("slide")
                .chain()
                .opacity(revertDuration, 1);
            if (this._useGrayscale) {
                nextCard.animation().start().get("slide-filter")
                    .chain()
                    .filter(revertDuration, new Filter().grayscale(100));
            }
            nextCard.animation().start().get("slide-opacity")
                .chain()
                .opacity(revertDuration, 0.5);

            return chain;
        },

        cleanup: function(containerView, filterView, nextCard) {
            nextCard.filter().clear();
            filterView.filter().clear();
            filterView.transform().clear();
            containerView.filter().clear();
            this._removeMarginLayer(filterView);
            containerView.removeClass("js-touch-item-view-fold-filter");
        }
    });

    return FoldEffect;
});
define('mobileui/utils/base64-text!mobileui/utils/filters/shaders/warp.vert',[],function () { return "LyoNCiAqIENvcHlyaWdodCAoYykgMjAxMyBBZG9iZSBTeXN0ZW1zIEluY29ycG9yYXRlZC4gQWxsIHJpZ2h0cyByZXNlcnZlZC4NCiAqIA0KICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7DQogKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuDQogKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQNCiAqIA0KICogICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMA0KICogDQogKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlDQogKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLA0KICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuDQogKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kDQogKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4NCiAqLw0KDQpwcmVjaXNpb24gbWVkaXVtcCBmbG9hdDsNCg0KLy8gQnVpbHQtaW4gYXR0cmlidXRlcy4NCg0KYXR0cmlidXRlIHZlYzQgYV9wb3NpdGlvbjsNCg0KLy8gQnVpbHQtaW4gdW5pZm9ybXMuDQoNCnVuaWZvcm0gbWF0NCB1X3Byb2plY3Rpb25NYXRyaXg7DQoNCi8vIFVuaWZvcm1zIHBhc3NlZC1pbiBmcm9tIENTUw0KDQp1bmlmb3JtIG1hdDQgdHJhbnNmb3JtOw0KDQp1bmlmb3JtIGZsb2F0IHg7DQp1bmlmb3JtIGZsb2F0IHk7DQp1bmlmb3JtIGZsb2F0IHN0cmV0Y2g7DQp1bmlmb3JtIGZsb2F0IHRvdWNoU2l6ZTsNCg0KLy8gQ29uc3RhbnRzDQoNCmNvbnN0IGZsb2F0IFBJID0gMy4xNDE1NjI5Ow0KDQovLyBNYWluDQoNCnZvaWQgbWFpbigpDQp7DQogICAgdmVjNCBwb3MgPSBhX3Bvc2l0aW9uOw0KDQogICAgZmxvYXQgZGlzdGFuY2VUb1RvdWNoID0gYWJzKHBvcy54ICsgMC41IC0geCk7DQogICAgZmxvYXQgY29zID0gY29zKGNsYW1wKFBJICogZGlzdGFuY2VUb1RvdWNoICogdG91Y2hTaXplLCAwLjAsIFBJIC8gMi4wKSk7DQogICAgZmxvYXQgdG91Y2hGYWRlID0gY29zICogbWF4KDAuMCwgdG91Y2hTaXplIC0gZGlzdGFuY2VUb1RvdWNoKSAqIG1pbigwLjUsICgxLjAgLSB5KSAqIHN0cmV0Y2gpOw0KICAgIHBvcy55ID0gKHBvcy55ICsgMC41KSAqIG1heCgwLjAsIHkgLSB0b3VjaEZhZGUgKiBjb3MpIC0gMC41Ow0KDQogICAgZ2xfUG9zaXRpb24gPSB1X3Byb2plY3Rpb25NYXRyaXggKiB0cmFuc2Zvcm0gKiBwb3M7DQp9DQo=";});

define('mobileui/utils/base64-text!mobileui/utils/filters/shaders/warp.frag',[],function () { return "LyoNCiAqIENvcHlyaWdodCAoYykgMjAxMyBBZG9iZSBTeXN0ZW1zIEluY29ycG9yYXRlZC4gQWxsIHJpZ2h0cyByZXNlcnZlZC4NCiAqIA0KICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7DQogKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuDQogKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQNCiAqIA0KICogICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMA0KICogDQogKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlDQogKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLA0KICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuDQogKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kDQogKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4NCiAqLw0KDQpwcmVjaXNpb24gbWVkaXVtcCBmbG9hdDsNCnZvaWQgbWFpbigpDQp7DQp9DQo=";});

/*
 * Copyright (c) 2013 Adobe Systems Incorporated. All rights reserved.
 * 
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 * 
 *     http://www.apache.org/licenses/LICENSE-2.0
 * 
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

 define('mobileui/utils/filters/warp',["mobileui/utils/filter",
         "mobileui/utils/base64-text!mobileui/utils/filters/shaders/warp.vert",
         "mobileui/utils/base64-text!mobileui/utils/filters/shaders/warp.frag"], function(Filter, vert, frag) {

    var header = "custom(url(data:text/plain;base64," + vert +
        ") mix(url(data:text/plain;base64," + frag + ") multiply source-atop)";

    return Filter.registerCustomFilter("warp", "shadow x y",
        function(fn) {
            return header + ", " +
             "30 2, x " + fn._x.toFixed(6) + ", y " + fn._y.toFixed(6) + ", " +
             "transform perspective(1000), stretch 0.1, touchSize 2)";
    });

});
/*
 * Copyright (c) 2013 Adobe Systems Incorporated. All rights reserved.
 * 
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 * 
 *     http://www.apache.org/licenses/LICENSE-2.0
 * 
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

define('mobileui/utils/effects/warp-effect',["mobileui/utils/effects/base-effect",
        "mobileui/utils/filter",
        "mobileui/utils/filters/warp"],
    function(BaseEffect, Filter, Warp) {

    function WarpEffect(useShadow, useGrayscale) {
        BaseEffect.call(this);
        this._useShadow = useShadow;
        this._useGrayscale = useGrayscale;
    }

    _.extend(WarpEffect.prototype, BaseEffect.prototype, {
        isSupported: function() {
            return Filter.supportsCustomFilters;
        },

        onDragStart: function(containerView, filterView, nextCard, verticalLayout, touch) {
            containerView.animation().removeAll();
            var warp = filterView.forceLayer().filter()
                .get("warp")
                .setX(touch.currentPosition.localX / containerView.bounds().width())
                .setY(1)
                .setShadow(this._computeShadow(0));
            if (this._useShadow)
                containerView.filter().get("dropShadow").setRadius(10).setColor(0);
            containerView.addClass("js-touch-item-view-filter");
            return -warp.y() * containerView.bounds().height();
        },

        _minShadow: 0.7,
        _maxShadow: 1,

        _computeShadow: function(t) {
            return (1 - t) * (this._maxShadow - this._minShadow) + this._minShadow;
        },

        onDragMove: function(containerView, filterView, nextCard, transform, dragStartValue) {
            var value = Math.min(0, dragStartValue + transform.dragY);
            var t = Math.min(1, Math.max(0, 2 + value / containerView.bounds().height()));

            filterView.filter().get("warp")
                .setX(transform.touch.currentPosition.localX / containerView.bounds().width())
                .setY(t)
                .setShadow(this._computeShadow(t));

            if (this._useShadow)
                containerView.filter().get("dropShadow").setRadius(10).setColor(1 - t);

            if (this._useGrayscale)
                nextCard.filter().get("grayscale").setIntensity(t * 100);
            nextCard.setOpacity(1 - t / 2);
            return value;
        },

        shouldRevert: function(containerView, value, direction) {
            value /= containerView.bounds().height();
            return (value > - 1.4) || (direction < 0);
        },

        commit: function(commitDuration, containerView, filterView, nextCard) {
            var chain = containerView.animation().start().get("slide-transform").chain();

            if (this._useShadow) {
                var filterShadow = new Filter();
                filterShadow.get("dropShadow").setRadius(10).setColor(0);
                chain = chain.filter(commitDuration, filterShadow);
            } else {
                // No filter on the main element, so just do a simple wait.
                chain = chain.wait(commitDuration);
            }

            var warp = filterView.filter().get("warp");
            var filter = new Filter();
            filter.get("warp")
                .setX(warp.x())
                .setY(0)
                .setShadow(this._computeShadow(1));
            filterView.animation().start().get("slide-filter")
                .chain()
                .filter(commitDuration, filter)
                .setTimingFunction("easeOut");

            if (this._useGrayscale) {
                nextCard.animation().start().get("slide-filter")
                    .chain()
                    .filter(commitDuration, new Filter().grayscale(0));
            }
            nextCard.animation().start().get("slide-opacity")
                .chain()
                .opacity(commitDuration, 1);

            return chain;
        },

        revert: function(revertDuration, containerView, filterView, nextCard) {
            var chain = containerView.animation().start().get("slide-transform").chain();

            if (this._useShadow) {
                var filterShadow = new Filter();
                filterShadow.get("dropShadow")
                    .setRadius(10)
                    .setColor(0);
                chain = chain.filter(revertDuration, new Filter());
            } else {
                // No filter on the main element, so just do a simple wait.
                chain = chain.wait(revertDuration);
            }

            var warp = filterView.filter().get("warp");
            var filter = new Filter();
            filter.get("warp")
                .setX(warp.x())
                .setY(1)
                .setShadow(this._computeShadow(0));

            filterView.animation().start().get("slide-filter")
                .chain()
                .filter(revertDuration, filter)
                .setTimingFunction("easeOut");

            containerView.animation().get("slide")
                .chain()
                .opacity(revertDuration, 1);
            if (this._useGrayscale) {
                nextCard.animation().start().get("slide-filter")
                    .chain()
                    .filter(revertDuration, new Filter().grayscale(100));
            }
            nextCard.animation().start().get("slide-opacity")
                .chain()
                .opacity(revertDuration, 0.5);

            return chain;
        },

        cleanup: function(containerView, filterView, nextCard) {
            nextCard.filter().clear();
            containerView.filter().clear();
            filterView.filter().clear();
            containerView.removeClass("js-touch-item-view-filter");
        }
    });

    return WarpEffect;
});
/*
 * Copyright (c) 2013 Adobe Systems Incorporated. All rights reserved.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

define('mobileui/ui/touch-item-view',["mobileui/views/gesture-detector",
        "mobileui/views/layer-view",
        "mobileui/views/layout-params",
        "mobileui/views/gesture-view",
        "mobileui/utils/momentum",
        "mobileui/utils/transform",
        "mobileui/utils/effects/drag-effect",
        "mobileui/utils/effects/fold-effect",
        "mobileui/utils/effects/warp-effect",
        "mobileui/utils/lock"],
    function(GestureDetector, LayerView, LayoutParams, GestureView, Momentum, Transform, DragEffect, FoldEffect, WarpEffect, lock) {

    var Effects = {
        "drag": new DragEffect(/* use grayscale*/ true),
        "fold": new FoldEffect(/* use shadow */ false, /* use grayscale*/ true),
        "warp": new WarpEffect(/* use shadow */ false, /* use grayscale*/ true)
    };

    var commitDuration = 500,
        revertDuration = 100;

    var ItemView = GestureView.extend({
        initialize: function(listView) {
            ItemView.__super__.initialize.call(this);
            this._listView = null;
            this.on("tap", this._onTap, this)
                .on("touchdragstart", this._onDragStart, this)
                .on("touchdragmove", this._onDragMove, this)
                .on("touchdragend", this._onDragEnd, this);
            this._filterView = new LayerView();
            this.append(this._filterView
                    .matchParentSize()
                    .addClass("js-touch-item-view")
                    .render());
            if (this.model) {
                var modelClassName = this.model.get("className");
                if (modelClassName)
                    this._filterView.addClass(modelClassName);
            }
            this._dragStartValue = 0;
            this._momentum = new Momentum().setDuration(commitDuration).setFriction(0.000005);
            this.setEffect("drag");
            this.setHorizontalLayout();
            this.forceLayer();
        },

        listView: function() {
            return this._listView;
        },

        setListView: function(listView) {
            this._listView = listView;
            return this;
        },

        setEffect: function(effectOrName) {
            var effect = _.isString(effectOrName) ? Effects[effectOrName] : effectOrName;
            if (!effect.isSupported())
                return;
            this._effect = effect;
            return this;
        },

        filterView: function() {
            return this._filterView;
        },

        render: function() {
            ItemView.__super__.render.call(this);
            this.$el.addClass("js-touch-item-parent-view");
            this._onLabelChanged();
            return this;
        },

        addModelLabel: function() {
            if (!this.$labelEl) {
                this.listenTo(this.model, "change:label", this._onLabelChanged);
                this.$labelEl = $("<div />").addClass("js-touch-item-view-label").appendTo(this._filterView.$el);
            }
            return this.$labelEl;
        },

        _onLabelChanged: function() {
            if (this.$labelEl && this.model)
                this.$labelEl.text(this.model.get("label"));
        },

        animateViewDeactived: function(promiseList, scrollView, selectedView, index) {
            var transform = new Transform(),
                translate = transform.get("translate"),
                delta;

            if (!this._verticalLayout) {
                delta = scrollView.scrollLeft() - selectedView.bounds().x();
                if (index > 0)
                    delta = scrollView.bounds().width() - (selectedView.bounds().width() - delta);
                translate.setX(delta);
            } else {
                delta = scrollView.scrollTop() - selectedView.bounds().y();
                if (index > 0)
                    delta = scrollView.bounds().height() - (selectedView.bounds().height() - delta);
                translate.setY(delta);
            }

            // Start from zero.
            this.transform().clear().get("translate");
            this.animation().start()
                .get("slide-transform")
                .chain()
                .transform(commitDuration, transform)
                .setTimingFunction("easeOut");

            promiseList.push(this.animation().promise());
        },

        resetAnimations: function() {
            this.setOpacity(1).transform().clear();
            this.filter().clear();
            this.animation().removeAll();
        },

        navigatorView: function() {
            return this._listView.navigatorView();
        },

        _onDragStart: function(touch) {
            lock.startTransition(this);
            var nextCard = this.navigatorView().nextCard();
            this._dragStartValue = this._effect.onDragStart(this, this._filterView, nextCard, this._verticalLayout, touch);
            this._momentum.reset(this._dragStartValue);
        },

        _onDragMove: function(transform) {
            var nextCard = this.navigatorView().nextCard(),
                value = this._effect.onDragMove(this, this._filterView, nextCard, transform, this._dragStartValue,
                    this._verticalLayout);
            this._momentum.injectValue(value);
        },

        _commit: function() {
            var self = this,
                activeCard = this.navigatorView().activeCard(),
                nextCard = this.navigatorView().nextCard();

            activeCard.setDisabled(true);

            this.navigatorView().precommitNextCard();

            // Start animating the rest of the items in the list.
            var promiseList = [];
            this.trigger("selected", this, promiseList);

            var chain = this._effect.commit(commitDuration, this, this._filterView, nextCard, this._verticalLayout);
            promiseList.push(chain.promise());
            $.when.apply(null, promiseList).then(function() {
                activeCard.setDisabled(false);
                nextCard.filter().clear();
                self.navigatorView().commitNextCard();
                self._effect.cleanup(self, self._filterView, nextCard);
                lock.endTransition(self);
            });
        },

        _revert: function() {
            var nextCard = this.navigatorView().nextCard();
            var chain = this._effect.revert(revertDuration, this, this._filterView, nextCard, this._verticalLayout);
            chain.callback(function() {
                this.navigatorView().revertNextCard();
                this._effect.cleanup(this, this._filterView, nextCard);
                lock.endTransition(this);
            }, this);
        },

        _onDragEnd: function(transform) {
            this._onDragMove(transform);
            if (this._effect.shouldRevert(this, this._momentum.compute(), this._momentum.direction(), this._verticalLayout))
                return this._revert();
            this._commit();
        },

        _onTap: function(touch) {
            if (!lock.canStartTransition())
                return;
            this.navigatorView().revertNextCard();
            this._onTapStart();
            var nextCard = this.navigatorView().nextCard();
            if (!nextCard)
                return;
            lock.startTransition(this);
            this.trigger("animation:start");
            this._effect.onDragStart(this, this._filterView, nextCard, this._verticalLayout, touch);
            this._commit();
        },

        respondsToTouchGesture: function(gesture) {
            if (!lock.canStartTransition() || gesture.type != GestureDetector.GestureType.DRAG)
                return false;
            var canStartTransition =
                (this._verticalLayout && gesture.scrollX && gesture.distanceX > 0) ||
                (!this._verticalLayout && gesture.scrollY);
            if (!canStartTransition)
                return false;
            this._onTapStart();
            return !!this.navigatorView().nextCard();
        },

        setVerticalLayout: function() {
            this._filterView.$el.toggleClass("js-vertical-item-view", true);
            this._verticalLayout = true;
            this.setParams(new LayoutParams().fillParentHeight().matchParentWidth());
            return this;
        },

        setHorizontalLayout: function() {
            this._filterView.$el.toggleClass("js-vertical-item-view", false);
            this._verticalLayout = false;
            this.setParams(new LayoutParams().fillParentWidth().matchParentHeight());
            return this;
        }
    });

    return ItemView;

});
/*
 * Copyright (c) 2013 Adobe Systems Incorporated. All rights reserved.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

define('mobileui/views/content-view',["mobileui/views/layer-view",
        "mobileui/views/layout-params"], function(LayerView, LayoutParams) {

    var ContentView = LayerView.extend({
        initialize: function() {
            ContentView.__super__.initialize.call(this);
            this.$contentView = this.createContentElement()
                .addClass("js-content-view-content");
            this._html = null;
            this._text = null;
        },

        render: function() {
            this.$el.addClass("js-content-view");
            this.$el.append(this.$contentView);
            return ContentView.__super__.render.call(this);
        },

        _validateHtml: function() {
            if (this._html) {
                this.$contentView.html(this._html);
                this._html = null;
            }
        },

        _validateText: function() {
            if (this._text) {
                this.$contentView.text(this._text);
                this._text = null;
            }
        },

        setContent: function(html) {
            this._text = null;
            this._html = html;
            this.setNeedsLayout(true);
            return this;
        },

        setTextContent: function(text) {
            this._html = null;
            this._text = text;
            this.setNeedsLayout(true);
            return this;
        },

        addContentClass: function(className) {
            this.$contentView.addClass(className);
            return this;
        },

        content: function() {
            return this.$contentView;
        },

        createContentElement: function() {
            return $("<div />");
        },

        layout: function() {
            ContentView.__super__.layout.call(this);
            this._validateHtml();
            this._validateText();
        }
    });

    return ContentView;

});
/*
 * Copyright (c) 2013 Adobe Systems Incorporated. All rights reserved.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

define('mobileui/utils/view-injector',["require"], function(require) {

    function InjectorState(globalView, parentView, parentState) {
        this.globalView = globalView;
        this.parentView = parentView;
        this.parentState = null;
        this._createsStaticViews = false;
    }

    _.extend(InjectorState.prototype, {
        pushView: function(view) {
            view.readViewAttributes();
            view.render();
            this.setContextView("data-name", this.globalView, view);
            this.setContextView("data-parent-name", this.parentView, view);
            var viewContext = view.$el.attr("data-context"),
                globalView = this.globalView;
            if (viewContext === "local")
                globalView = view;
            return new InjectorState(globalView, view, this);
        },

        setContextView: function(attribute, globalView, view) {
            var viewName = view.$el.attr(attribute);
            if (!viewName)
                return;
            var setterName = "set" + _.string.capitalize(viewName);
            if (_.isFunction(globalView[setterName]))
                globalView[setterName].call(globalView, view);
            else
                globalView[name] = view;
        },

        createStaticViews: function() {
            return this._createsStaticViews;
        },

        newStateWithStaticViews: function() {
            if (this._createsStaticViews)
                return this;
            var state = new InjectorState(this.globalView, this.parentView);
            state._createsStaticViews = true;
            return state;
        }
    });

    function ViewInjector() {
    }

    _.extend(ViewInjector.prototype, {
        convertViews: function(state, children) {
            var self = this,
                wait = $.Deferred(),
                waitList = [];
            children.each(function(i, child) {
                child = $(child);
                var viewName = child.attr("data-view");
                if (viewName === undefined) {
                    var childrenWait = self.convertViews(state.newStateWithStaticViews(), child.children());
                    if (childrenWait)
                        waitList.push(childrenWait);
                    return;
                }
                // FIXME: Make sure that the optimizer will be able to include all of the views
                // during the compile time. Shall we preparse the content?
                var requireWait = $.Deferred();
                require([viewName], function(ViewConstructor) {
                    var view = new ViewConstructor({ el: child });
                    if (state.createStaticViews())
                        view.setIsStaticView(true);
                    var newState = state.pushView(view),
                        childrenWait = self.convertViews(newState, child.children());
                    $.when(childrenWait).then(function() {
                        requireWait.resolve();
                    });
                });
                waitList.push(requireWait.promise());
            });
            if (!waitList.length)
                return null;
            $.when.call(null, waitList).then(function() {
                wait.resolve();
            });
            return wait;
        },

        convert: function(globalStateView, startingView) {
            if (!startingView)
                startingView = globalStateView;
            var state = new InjectorState(globalStateView, startingView);
            return this.convertViews(state, startingView.$el.children()) || $.Deferred().resolve().promise();
        }
    });

    return ViewInjector;
});
/*
 * Copyright (c) 2013 Adobe Systems Incorporated. All rights reserved.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

define('mobileui/ui/button-view',["mobileui/views/gesture-view"], function(GestureView) {

    var ButtonView = GestureView.extend({
        initialize: function() {
            ButtonView.__super__.initialize.call(this);
            this.matchLineHeight()
                .forceLayer();
            this._label = null;
            this.bounds().setSize(70, 40);
            this.on("tapstart", this._onTapStart, this);
            this.on("tapend", this._onTapEnd, this);
            this._state = "up";
            this._prevState = null;
            this.$labelEl = $("<div />").addClass("js-button-view-label");
        },

        setLabel: function(label) {
            this._label = label;
            this.invalidate("label");
            return this;
        },

        _readLabelAttribute: function() {
            var labelAttribute = this.$el.attr("data-label");
            if (!labelAttribute)
                return;
            this.setLabel(labelAttribute);
        },

        readViewAttributes: function() {
            ButtonView.__super__.readViewAttributes.call(this);
            this._readLabelAttribute();
        },

        render: function() {
            ButtonView.__super__.render.call(this);
            this.$el.addClass("js-button-view")
                    .append(this.$labelEl);
            this._validateLabel();
            this._validateState();
            return this;
        },

        _validateLabel: function() {
            if (this._label)
                this.$labelEl.text(this._label);
        },

        _validateState: function() {
            if (this._prevState)
                this.$el.removeClass("js-button-view-" + this._prevState);
            this.$el.addClass("js-button-view-" + this._state);
            this._prevState = this._state;
        },

        _onTapStart: function() {
            this._state = "down";
            this.invalidate("state");
        },

        _onTapEnd: function() {
            this._state = "up";
            this.invalidate("state");
        }
    });

    return ButtonView;

});
/*
 * Copyright (c) 2013 Adobe Systems Incorporated. All rights reserved.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

define('mobileui/ui/link-view',["mobileui/ui/button-view"], function(ButtonView) {

    var LinkView = ButtonView.extend({
        initialize: function() {
            LinkView.__super__.initialize.call(this);
            this.on("tap", this._onLinkTap, this);
        },

        render: function() {
            LinkView.__super__.render.call(this);
            this.$el.addClass("js-link-view");
            return this;
        },

        _onLinkTap: function() {
            window.open(this.$el.attr("href"));
        }
    });

    return LinkView;

});
/*
 * Copyright (c) 2013 Adobe Systems Incorporated. All rights reserved.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

define('sample/app',[],function() {

    var app = {};
    return _.extend(app, Backbone.Events, {
        router: null,
        mainView: null,
        defaultCard: "Splash View"
    });

});
/*
 * Copyright (c) 2013 Adobe Systems Incorporated. All rights reserved.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

define('mobileui/views/scroll-view',["mobileui/views/gesture-view",
        "mobileui/views/layer-view",
        "mobileui/views/gesture-detector",
        "mobileui/utils/boilerplate",
        "mobileui/utils/momentum",
        "mobileui/utils/geometry",
        "mobileui/utils/transform"],
function(GestureView, LayerView, GestureDetector, boilerplate, Momentum,
            Geometry, Transform) {

    var minScrollIndicatorSize = 10;

    var ScrollView = GestureView.extend({

        initialize: function() {
            ScrollView.__super__.initialize.call(this);
            this.on("touchdragstart", this._onTouchDragStart, this);
            this.on("touchdragmove", this._onTouchDragMove, this);
            this.on("touchdragend", this._onTouchDragEnd, this);
            this._contentView = null;
            this._scrollLeft = 0;
            this._scrollTop = 0;
            this._touchStartState = null;
            this._canOverScroll = false;
            this._scrollDirection = ScrollView.BOTH;
            this._scrollAnimationDuration = 300;
            this._momentumLeft = new Momentum(this._scrollAnimationDuration);
            this._momentumTop = new Momentum(this._scrollAnimationDuration);
            this._maxMomentum = 100;
            this._useAnimation = false;

            this._horizontalView = new LayerView();
            this._horizontalView.forceLayer()
                .addClass("js-scroll-view-indicator")
                .addClass("js-scroll-view-horizontal-indicator")
                .setOpacity(0);
            this._horizontalView.bounds().setSize(1, 4);
            this._horizontalView.transform().translate().scale(0, 1);
            this.append(this._horizontalView.render());

            this._verticalView = new LayerView();
            this._verticalView.forceLayer()
                .addClass("js-scroll-view-indicator")
                .addClass("js-scroll-view-vertical-indicator")
                .setOpacity(0);
            this._verticalView.bounds().setSize(4, 1);
            this._verticalView.transform().translate().scale(1, 0);
            this.append(this._verticalView.render());

            this._snapToChildrenBounds = false;
            this._scrollBarsVisible = false;
            this._selectedView = null;
            this._maxIncrement = 1;
        },

        render: function() {
            this.$el
                .addClass("js-scroll-view")
                .on("mousewheel", this._onMouseWheel.bind(this));
            return ScrollView.__super__.render.call(this);
        },

        setSnapToChildrenBounds: function() {
            this._snapToChildrenBounds = true;
            return this;
        },

        setScrollAnimationDuration: function(duration) {
            this._scrollAnimationDuration = duration;
            this._momentumLeft.setDuration(duration);
            this._momentumTop.setDuration(duration);
            return this;
        },

        setScrollDirection: function(direction) {
            this._scrollDirection = direction;
            this.invalidate("scroll");
            return this;
        },

        _readSnapToChildrenBoundsAttribute: function() {
            var snapToChildrenBoundsAttribute = this.$el.attr("data-snap");
            if (snapToChildrenBoundsAttribute === undefined)
                return;
            this.setSnapToChildrenBounds();
        },

        _readScrollDirectionAttribute: function() {
            var scrollDirectionAttribute = this.$el.attr("data-scroll-direction");
            if (!scrollDirectionAttribute)
                return;
            this.setScrollDirection(scrollDirectionAttribute);
        },

        readViewAttributes: function() {
            ScrollView.__super__.readViewAttributes.call(this);
            this._readSnapToChildrenBoundsAttribute();
            this._readScrollDirectionAttribute();
        },

        selectedView: function() {
            return this._selectedView;
        },

        scrollLeft: function() {
            return this._scrollLeft;
        },

        scrollTop: function() {
            return this._scrollTop;
        },

        isScrolling: function() {
            return this._canOverScroll;
        },

        _verticalScrollHeight: function() {
            return Math.max(minScrollIndicatorSize, this.bounds().height() / this.scrollHeight() * this.bounds().height());
        },

        _horizontalScrollWidth: function() {
            return Math.max(minScrollIndicatorSize, this.bounds().width() / this.scrollWidth() * this.bounds().width());
        },

        _updateScrollBarVisibility: function(scrollBar, visible) {
            var wasVisible = scrollBar.visible();
            if (wasVisible == visible)
                return;
            scrollBar.setVisible(visible);
            scrollBar.animation().get("scrollbar-opacity").removeAll();
            scrollBar.setOpacity((visible && this._scrollBarsVisible) ? 1 : 0);
        },

        layout: function() {
            ScrollView.__super__.layout.call(this);

            if (!this._selectedView)
                this._updateSelectedView();

            this._updateScrollBarVisibility(this._verticalView, this.hasVerticalScroll());
            this._verticalView
                .bounds().setX(this.bounds().width() - this._verticalView.bounds().width());

            this._updateScrollBarVisibility(this._horizontalView, this.hasHorizontalScroll());
            this._horizontalView
                .bounds().setY(this.bounds().height() - this._horizontalView.bounds().height());

            this._verticalView.transform().get("scale").setY(this._verticalScrollHeight());
            this._horizontalView.transform().get("scale").setX(this._horizontalScrollWidth());

            this.invalidate("scroll");
        },

        _animateScrollBar: function(scrollBar, show) {
            if (!scrollBar.visible())
                return;
            scrollBar.animation().start().get("scrollbar-opacity")
                .removeAll()
                .chain()
                .opacity(100, show ? 1 : 0);
        },

        showScrollBars: function() {
            if (this._scrollBarsVisible)
                return;
            this._scrollBarsVisible = true;
            this._animateScrollBar(this._verticalView, true);
            this._animateScrollBar(this._horizontalView, true);
        },

        hideScrollBars: function() {
            if (!this._scrollBarsVisible)
                return;
            this._scrollBarsVisible = false;
            this._animateScrollBar(this._verticalView, false);
            this._animateScrollBar(this._horizontalView, false);
        },

        setContentView: function(view) {
            if (this._contentView === view)
                return;
            if (this._contentView) {
                this._contentView.remove();
                this._contentView = null;
            }
            if (view) {
                this._contentView = view.forceLayer();
                this.prepend(view);
            }
            return this;
        },

        contentView: function() {
            return this._contentView;
        },

        scrollToWithAnimation: function(left, top) {
            this._useAnimation = true;
            this.scrollTo(left, top);
        },

        scrollTo: function(left, top, noSelectedViewUpdate) {
            if (!this._contentView)
                return;
            if (this._scrollLeft == left &&
                this._scrollTop == top)
                return;
            this._scrollLeft = left;
            this._scrollTop = top;
            if (!noSelectedViewUpdate)
                this._updateSelectedView();
            this.invalidate("scroll");
            this.trigger("scroll");
        },

        scrollBy: function(left, top, noSelectedViewUpdate) {
            if (!this._contentView || (!left && !top))
                return;
            this._scrollLeft += left;
            this._scrollTop += top;
            if (!noSelectedViewUpdate)
                this._updateSelectedView();
            this.invalidate("scroll");
            this.trigger("scroll");
        },

        scrollWidth: function() {
            return this._contentView ? this._contentView.bounds().width() : 0;
        },

        scrollHeight: function() {
            return this._contentView ? this._contentView.bounds().height() : 0;
        },

        maxScrollLeft: function() {
            return Math.max(0, this._contentView.outerWidth() - this.bounds().width());
        },

        maxScrollTop: function() {
            return Math.max(0, this._contentView.outerHeight() - this.bounds().height());
        },

        hasHorizontalScroll: function() {
            return this.scrollWidth() > this.bounds().width();
        },

        hasVerticalScroll: function() {
            return this.scrollHeight() > this.bounds().height();
        },

        _internalSetSelectedView: function(view) {
            if (this._selectedView == view)
                return;
            this._selectedView = view;
            this.trigger("change:selected");
        },

        _updateSelectedView: function(checkForMaxIncrement) {
            if (!this._snapToChildrenBounds)
                return;
            // Align scroll with child objects.
            if (!this._contentView) {
                this._internalSetSelectedView(null);
                return;
            }
            var shortestDistance = 0, nearestView = null,
                centerX = this._scrollLeft + this.bounds().width() / 2,
                centerY = this._scrollTop + this.bounds().height() / 2;
            var children = this._contentView.childrenViews();
            _.each(children, function(view) {
                var dist = Geometry.dist(centerX, centerY, view.bounds().centerX(), view.bounds().centerY());
                if (!nearestView || shortestDistance > dist) {
                    shortestDistance = dist;
                    nearestView = view;
                }
            });
            if (!nearestView || !children.length) {
                this._internalSetSelectedView(null);
                return;
            }
            var newIndex = _.indexOf(children, nearestView);
            if (checkForMaxIncrement) {
                var oldIndex = this._selectedView ? _.indexOf(children, this._selectedView) : -1;
                if (oldIndex != -1 && Math.abs(newIndex - oldIndex) > this._maxIncrement) {
                    newIndex = Math.min(children.length - 1, Math.max(0, oldIndex + (newIndex > oldIndex ? 1 : -1)));
                    nearestView = children[newIndex];
                }
            }
            this._internalSetSelectedView(nearestView);
        },

        _snapScrollToChildrenPosition: function() {
            if (!this._selectedView || !this._snapToChildrenBounds)
                return;
            if (this._scrollDirection != ScrollView.VERTICAL)
                this._scrollLeft = this._selectedView.bounds().x();
            if (this._scrollDirection != ScrollView.HORIZONTAL)
                this._scrollTop = this._selectedView.bounds().y();
        },

        _checkScrollPosition: function() {
            if (!this._canOverScroll && this._snapToChildrenBounds)
                this._snapScrollToChildrenPosition();
            if (!this._canOverScroll || this._scrollDirection == ScrollView.VERTICAL)
                this._scrollLeft = Math.max(0, Math.min(this._scrollLeft, this.maxScrollLeft()));
            if (!this._canOverScroll || this._scrollDirection == ScrollView.HORIZONTAL)
                this._scrollTop = Math.max(0, Math.min(this._scrollTop, this.maxScrollTop()));
        },

        _validateScroll: function() {
            if (!this._contentView)
                return;
            if (this._useAnimation) {
                this._useAnimation = false;
                this._validateScrollWithAnimation();
                return;
            }
            this._checkScrollPosition();
            if (this._contentView.getLayout) {
                var contentViewLayout = this._contentView.getLayout();
                if (contentViewLayout && contentViewLayout.scroll) {
                    var scrollOptions = {
                        left: this._scrollLeft,
                        top: this._scrollTop
                    };
                    contentViewLayout.scroll(this, scrollOptions);
                    return;
                }
            }
            this._internalScroll();
        },

        _computeVerticalBarPosition: function(scrollTop) {
            return scrollTop / this.scrollHeight() * (this.bounds().height() - this._verticalView.bounds().height());
        },

        _computeHorizontalBarPosition: function(scrollLeft) {
            return scrollLeft / this.scrollWidth() * (this.bounds().width() - this._horizontalView.bounds().width());
        },

        _internalScroll: function() {
            var contentView = this.contentView();
            contentView
                .transform()
                .get("translate")
                .setX(-this._scrollLeft).setY(-this._scrollTop);
            this._verticalView.transform().get("translate").setY(this._computeVerticalBarPosition(this._scrollTop));
            this._horizontalView.transform().get("translate").setX(this._computeHorizontalBarPosition(this._scrollLeft));
        },

        _adjustMomentum: function(momentum, scroll, maxScroll) {
            return ((momentum > 0 && scroll >= 0) ||
                (momentum < maxScroll && scroll <= maxScroll)) ?
                    scroll :
                    Math.max(scroll - this._maxMomentum, Math.min(momentum, scroll + this._maxMomentum));
        },

        _validateScrollWithAnimation: function() {
            var momentumLeft = this._scrollLeft,
                momentumTop =  this._scrollTop;
            if (this._scrollDirection == ScrollView.VERTICAL)
                momentumLeft = Math.max(0, Math.min(momentumLeft, this.maxScrollLeft()));
            if (this._scrollDirection == ScrollView.HORIZONTAL)
                momentumTop = Math.max(0, Math.min(momentumTop, this.maxScrollTop()));
            this._checkScrollPosition();
            momentumLeft = this._adjustMomentum(momentumLeft, this._scrollLeft, this.maxScrollLeft());
            momentumTop = this._adjustMomentum(momentumTop, this._scrollTop, this.maxScrollTop());
            if (this._contentView.getLayout) {
                var contentViewLayout = this._contentView.getLayout();
                if (contentViewLayout && contentViewLayout.scrollWithAnimation) {
                    var scrollOptions = {
                        left: this._scrollLeft,
                        top: this._scrollTop,
                        momentumLeft: momentumLeft,
                        momentumTop: momentumTop,
                        duration: this._scrollAnimationDuration
                    };
                    contentViewLayout.scrollWithAnimation(this, scrollOptions);
                }
            }
            this._internalScrollWithAnimation(momentumLeft, momentumTop);
        },

        _internalScrollWithAnimation: function(momentumLeft, momentumTop) {
            this.showScrollBars();
            var contentView = this.contentView();
            var chain = contentView.animation().inlineStart().get("scroll").removeAll().chain();
            var chainVertical = this._verticalView.animation().inlineStart().get("scroll").removeAll().chain();
            var chainHorizontal = this._horizontalView.animation().inlineStart().get("scroll").removeAll().chain();
            var verticalTransform, horizontalTransform;

            if (momentumLeft != this._scrollLeft ||
                momentumTop != this._scrollTop) {
                chain = chain.transform(this._scrollAnimationDuration / 2,
                                    new Transform().translate(-momentumLeft, -momentumTop))
                             .setTimingFunction("easeOut");

                verticalTransform = this._verticalView.transform().clone();
                verticalTransform.get("translate").setY(this._computeVerticalBarPosition(momentumTop));

                chainVertical = chainVertical.transform(this._scrollAnimationDuration / 2, verticalTransform)
                                .setTimingFunction("easeOut");

                horizontalTransform = this._horizontalView.transform().clone();
                horizontalTransform.get("translate").setX(this._computeHorizontalBarPosition(momentumLeft));
                chainHorizontal = chainHorizontal.transform(this._scrollAnimationDuration / 2, horizontalTransform)
                                .setTimingFunction("easeOut");

                this.trigger("scroll:animation", momentumLeft, momentumTop, this._scrollAnimationDuration / 2, /* momentum */ true);
            }
            this.trigger("scroll:animation", this._scrollLeft, this._scrollTop, this._scrollAnimationDuration, /* momentum */ false);
            chain.transform(this._scrollAnimationDuration,
                            new Transform().translate(-this._scrollLeft, -this._scrollTop))
                 .setTimingFunction("easeOut")
                 .callback(function() {
                     this.hideScrollBars();
                     this.trigger("scroll");
                 }, this);

            verticalTransform = this._verticalView.transform().clone();
            verticalTransform.get("translate").setY(this._computeVerticalBarPosition(this._scrollTop));
            chainVertical.transform(this._scrollAnimationDuration, verticalTransform)
                                .setTimingFunction("easeOut");

            horizontalTransform = this._horizontalView.transform().clone();
            horizontalTransform.get("translate").setX(this._computeHorizontalBarPosition(this._scrollLeft));
            chainHorizontal.transform(this._scrollAnimationDuration, horizontalTransform)
                                .setTimingFunction("easeOut");
        },

        _onMouseWheel: function(event) {
            event.preventDefault();
            event.stopImmediatePropagation();
            var ev = event.originalEvent,
                left = 0, top = ev.wheelDelta;
            if (ev.hasOwnProperty("wheelDeltaX")) {
                left = ev.wheelDeltaX;
                top = ev.wheelDeltaY;
            }
            if (boilerplate.lookupPrefix(ev, "directionInvertedFromDevice")) {
                left *= -1;
                top *= -1;
            }
            this.scrollBy(left, top);
            this.showScrollBars();
        },

        respondsToTouchGesture: function(gesture) {
            if (!this._contentView || this._scrollDirection == ScrollView.NONE ||
                gesture.type != GestureDetector.GestureType.DRAG)
                return false;
            return (this._scrollDirection != ScrollView.VERTICAL && gesture.scrollX) ||
                (this._scrollDirection != ScrollView.HORIZONTAL && gesture.scrollY);
        },

        _stopScrollAnimation: function() {
            this._useAnimation = false;
            var contentView = this.contentView();
            if (contentView.hasAnimation()) {
                var transform = contentView.transform().get("translate");
                this._scrolLeft = -transform.x();
                this._scrollTop = -transform.y();
                this.contentView().animation().stop().get("scroll").removeAll();
                this.trigger("scroll");
            }
        },

        _onTouchDragStart: function() {
            this._stopScrollAnimation();
            this._touchStartState = {
                scrollLeft: this._scrollLeft,
                scrollTop: this._scrollTop
            };
            this._momentumLeft.reset(this._scrollLeft);
            this._momentumTop.reset(this._scrollTop);
            this._canOverScroll = true;
            this.showScrollBars();
        },

        _onTouchDragMove: function(transform) {
            if (!this._touchStartState)
                return;
            var deltaX = this._touchStartState.scrollLeft - transform.dragX,
                deltaY = this._touchStartState.scrollTop - transform.dragY;
            this._momentumLeft.injectValue(deltaX);
            this._momentumTop.injectValue(deltaY);
            this.scrollTo(deltaX, deltaY, true);
        },

        _onTouchDragEnd: function(transform) {
            var deltaX = this._touchStartState.scrollLeft - transform.dragX,
                deltaY = this._touchStartState.scrollTop - transform.dragY;
            this._momentumLeft.injectValue(deltaX);
            this._momentumTop.injectValue(deltaY);
            this._scrollLeft = this._momentumLeft.compute();
            this._scrollTop = this._momentumTop.compute();
            this._useAnimation = true;
            this._canOverScroll = false;
            this._touchStartState = null;
            this._updateSelectedView(true);
            this.invalidate("scroll");
        }
    }, {
        BOTH: "both",
        VERTICAL: "vertical",
        HORIZONTAL: "horizontal",
        NONE: "none"
    });

    return ScrollView;

});
/*
 * Copyright (c) 2013 Adobe Systems Incorporated. All rights reserved.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

define('mobileui/views/linear-layout',["mobileui/utils/transform",
        "mobileui/views/layout-params"], function(Transform, LayoutParams) {

    function fillsParent(params, isVertical) {
        return isVertical ? (params.height() == LayoutParams.FILL_PARENT)
            : (params.width() == LayoutParams.FILL_PARENT);
    }

    function matchChildren(params, isVertical) {
        return isVertical ? (params.width() == LayoutParams.MATCH_CHILDREN)
            : (params.height() == LayoutParams.MATCH_CHILDREN);
    }

    var LinearLayout = {

        Vertical: "vertical",
        Horizontal: "horizontal",

        direction: null,

        layout: function(containerView, options) {
            var children = containerView.childrenViews(),
                isVertical = this.direction == LinearLayout.Vertical,
                padding = containerView.padding(),
                offset = 0,
                containerParams = containerView.params(),
                computeChildrenSize = containerParams ? matchChildren(containerParams, isVertical) : false,
                maxChildrenSize = 0,
                promiseList = [],
                childrenWeight = 0,
                hasParentFillers = false,
                spacePerWeight = 0,
                previousMargin = null;

            _.each(children, function(view) {
                if (!view.visible())
                    return;
                if (view.shouldIgnoreDuringLayout()) {
                    view.layoutIfNeeded();
                    return;
                }
                var params = view.params();
                if (params && fillsParent(params, isVertical)) {
                    childrenWeight += params.weight();
                    hasParentFillers = true;
                    offset += isVertical ? view.padding().vertical() : view.padding().horizontal();
                } else {
                    view.layoutIfNeeded();
                    offset += isVertical ? view.paddingHeight() : view.paddingWidth();
                }
                var viewMargin = view.margin();
                offset += isVertical ? viewMargin.bottom() : viewMargin.right();

                // Collapse top margin for the current view with the bottom margin of the previous view.
                var collapedMargin = isVertical ? viewMargin.top() - (previousMargin ? previousMargin.bottom() : 0) :
                        viewMargin.left() -  (previousMargin ? previousMargin.right() : 0);
                offset += Math.max(0, collapedMargin);

                previousMargin = viewMargin;
            });

            if (hasParentFillers) {
                var totalSpace = (isVertical ? containerView.bounds().height() : containerView.bounds().width()),
                    remainingSpace = totalSpace - offset;
                spacePerWeight = (childrenWeight > 0) ? remainingSpace / childrenWeight : 0;
            }
            offset = isVertical ? padding.top() : padding.left();
            previousMargin = null;

            _.each(children, function(view) {
                if (!view.visible())
                    return;
                var params = view.params(),
                    viewBounds = view.bounds(),
                    viewMargin = view.margin();
                if (!view.shouldIgnoreDuringLayout()) {
                    // Collapse top margin for the current view with the bottom margin of the previous view.
                    var collapedMargin = isVertical ? viewMargin.top() - (previousMargin ? previousMargin.bottom() : 0) :
                        viewMargin.left() -  (previousMargin ? previousMargin.right() : 0);
                    offset += Math.max(0, collapedMargin);

                    // We already compute the margins in JS, so balance the margins,
                    // by removing them from the positions here.
                    var newX = isVertical ? padding.left() : offset - viewMargin.left(),
                        newY = isVertical ? offset - viewMargin.top() : padding.top();

                    if (params && fillsParent(params, isVertical)) {
                        var space = Math.ceil(spacePerWeight * params.weight());
                        if (isVertical)
                            viewBounds.setHeight(space);
                        else
                            viewBounds.setWidth(space);
                        view.layoutIfNeeded();
                    }
                    if (viewBounds.x() != newX ||
                        viewBounds.y() != newY) {
                        if ((options.wait || options.duration) && view.everHadLayout) {
                            var startTransform = Transform().translate(
                                viewBounds.x() - newX,
                                viewBounds.y() - newY);
                            view.transform().set(startTransform);
                            view.animation()
                                .inlineStart()
                                .get("layout")
                                .removeAll()
                                .chain(options.wait)
                                .transform(options.duration, Transform());
                            promiseList.push(view.animation().promise());
                        }
                        viewBounds.setX(newX).setY(newY);
                    }
                    offset += isVertical ? (view.paddingHeight() + viewMargin.bottom()) : (view.paddingWidth() + viewMargin.right());
                    previousMargin = viewMargin;
                }
                view.everHadLayout = true;
                if (computeChildrenSize)
                    maxChildrenSize = Math.max(maxChildrenSize, isVertical ? view.outerWidth() : view.outerHeight());
            });

            if (isVertical) {
                if (!hasParentFillers && (!containerParams || containerParams.height() == LayoutParams.MATCH_CHILDREN))
                    containerView.bounds().setHeight(offset - padding.top());
                if (computeChildrenSize)
                    containerView.bounds().setWidth(maxChildrenSize);
            } else {
                if (!hasParentFillers && (!containerParams || containerParams.width() == LayoutParams.MATCH_CHILDREN))
                    containerView.bounds().setWidth(offset - padding.left());
                if (computeChildrenSize)
                    containerView.bounds().setHeight(maxChildrenSize);
            }

            if (options.promise) {
                $.when.apply(null, promiseList).then(function() {
                    options.promise.resolveWith(containerView);
                });
            }
        }
    };

    return LinearLayout;

});
/*
 * Copyright (c) 2013 Adobe Systems Incorporated. All rights reserved.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

define('mobileui/views/vertical-layout',["mobileui/utils/transform", "mobileui/views/linear-layout"], function(Transform, LinearLayout) {

    var VerticalLayout = _.extend({}, LinearLayout, {
        direction: LinearLayout.Vertical
    });

    return VerticalLayout;

});
/*
 * Copyright (c) 2013 Adobe Systems Incorporated. All rights reserved.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

define('mobileui/views/horizontal-layout',["mobileui/utils/transform", "mobileui/views/linear-layout"], function(Transform, LinearLayout) {

    var HorizontalLayout = _.extend({}, LinearLayout, {
        direction: LinearLayout.Horizontal
    });

    return HorizontalLayout;

});
/*
 * Copyright (c) 2013 Adobe Systems Incorporated. All rights reserved.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

define('mobileui/views/layout-view',["mobileui/views/layer-view",
        "mobileui/views/vertical-layout",
        "mobileui/views/horizontal-layout",
        "mobileui/views/layout-params"
    ], function(LayerView, VerticalLayout, HorizontalLayout, LayoutParams) {

    var LayoutView = LayerView.extend({

        initialize: function() {
            LayoutView.__super__.initialize.call(this);
            this._layout = null;
            this._animationWait = null;
            this._animationDuration = null;
            this._layoutPromise = null;
        },

        render: function() {
            this.$el.addClass("js-vertical-box-view");
            return LayoutView.__super__.render.call(this);
        },

        _internalComputeLayout: function(layout) {
            if (layout == "vertical")
                return VerticalLayout;
            if (layout == "horizontal")
                return HorizontalLayout;
            return layout;
        },

        appendFiller: function() {
            var filler = new LayerView().setParams(new LayoutParams().fillParentWidth());
            this.append(filler);
            return this;
        },

        getLayout: function() {
            return this._layout;
        },

        setLayout: function(layout) {
            layout = this._internalComputeLayout(layout);
            if (this._layout === layout)
                return this;
            this._layout = layout;
            this._animationWait = null;
            this._animationDuration = null;
            this._layoutPromise = null;
            this.setNeedsLayout(true);
            return this;
        },

        _readLayoutAttribute: function() {
            var layoutAttribute = this.$el.attr("data-layout");
            if (!layoutAttribute)
                return;
            this.setLayout(layoutAttribute);
        },

        readViewAttributes: function() {
            LayoutView.__super__.readViewAttributes.call(this);
            this._readLayoutAttribute();
        },

        setLayoutWithAnimation: function(layout) {
            layout = this._internalComputeLayout(layout);
            if (this._layout === layout)
                return $.Deferred().resolveWith(this).promise();
            this._layout = layout;
            this._animationWait = null;
            this._animationDuration = LayoutView.AnimationDuration;
            this.setNeedsLayout(true);
            this._layoutPromise = $.Deferred();
            return this._layoutPromise.promise();
        },

        layout: function() {
            if (this._layout) {
                this.layoutBounds();
                this.setLayoutOnChildren();
                this._layout.layout(this, {
                    wait: this._animationWait,
                    duration: this._animationDuration,
                    promise: this._layoutPromise
                });
                this._animationWait = null;
                this._animationDuration = null;
                this._layoutPromise = null;
                this.setNeedsLayout(false);
            } else {
                LayoutView.__super__.layout.call(this);
            }
        },

        _animateAttach: function(view) {
            this._animationWait = null;
            this._animationDuration = LayoutView.AnimationDuration;
            view.animation().start().get("opacity").removeAll()
                // Dummy wait until the layout animation is finished.
                .chain(LayoutView.AnimationDuration)
                .opacity(LayoutView.AnimationDuration, 0, 1);
            view.setOpacity(0);
            return view.animation().promise();
        },

        _animateDetach: function(view, callback) {
            this._animationDuration = LayoutView.AnimationDuration;
            this._animationWait = LayoutView.AnimationDuration * 2;
            view.animation().start().get("opacity").removeAll()
                .chain(LayoutView.AnimationDuration)
                .opacity(LayoutView.AnimationDuration, 1, 0)
                // Inject another dummy wait, so that layout animation is also finished.
                .wait(this._animationDuration);
            return view.animation().promise().then(function() {
                // Reset the opacity to 1 after we remove the object.
                if (view.hasAnimation() && !view.opacity())
                    view.setOpacity(1);
            });
        }
    });

    LayoutView.AnimationDuration = 200;

    return LayoutView;

});
/*
 * Copyright (c) 2013 Adobe Systems Incorporated. All rights reserved.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

define('mobileui/ui/list-view',["mobileui/views/scroll-view",
        "mobileui/views/layout-view",
        "mobileui/views/layout-params"], function(ScrollView, LayoutView, LayoutParams) {
    
    var ListView = ScrollView.extend({
        initialize: function() {
            ListView.__super__.initialize.call(this);
            this._itemRendererFactory = null;
            this._viewItems = {};
            this.setScrollDirection(ScrollView.VERTICAL);
            this.setContentView(
                new LayoutView().setLayout("vertical")
                    .setParams(new LayoutParams()
                        .matchParentWidth()
                        .matchChildrenHeight()));
            this._initModel();
        },

        _initModel: function() {
            if (!this.model)
                return;
            this.listenTo(this.model, "add", this._onModelAdd);
            this.listenTo(this.model, "remove", this._onModelRemove);
            this.listenTo(this.model, "sort", this._onModelSort);
            this.model.each(this._onModelAdd, this);
        },

        setCollection: function(model) {
            if (this.model) {
                _.each(this._viewItems, function(view) {
                    view.remove();
                });
                this._viewItems = null;
                this.stopListening(this.model);
                this.model = null;
            }
            this.model = model;
            this._initModel();
            return this;
        },

        _onModelAdd: function(model) {
            if (!this._itemRendererFactory || this._viewItems[model.cid])
                return;
            var view = this._itemRendererFactory(model);
            if (!view)
                return;
            this._viewItems[model.cid] = view;
            var prevView = this.previousItemView(model);
            if (prevView)
                this.contentView().after(view, prevView);
            else
                this.contentView().append(view);
        },

        previousItemView: function(model) {
            if (!this.model)
                return null;
            var index = this.model.indexOf(model);
            if (index == -1)
                return null;
            for (var i = index - 1; i >= 0; --i) {
                var prevItem = this.model.at(i),
                    view = this._viewItems[prevItem.cid];
                if (view)
                    return view;
            }
            return null;
        },

        indexOfView: function(lookupView) {
            var index = 0;
            for (var key in this._viewItems) {
                if (_.has(this._viewItems, key)) {
                    if (lookupView === this._viewItems[key])
                        return index;
                    ++index;
                }
            }
            return -1;
        },

        itemView: function(model) {
            if (!this.model)
                return null;
            return this._viewItems[model.cid];
        },

        _onModelRemove: function(model) {
            var view = this._viewItems[model.cid];
            if (!view)
                return;
            view.remove();
        },

        _onModelSort: function() {
            // implement this.
        },

        itemRendererFactory: function() {
            return this._itemRendererFactory;
        },

        setItemRendererFactory: function(factory) {
            this._itemRendererFactory = factory;
            return this;
        },

        render: function() {
            this.$el.addClass("js-list-view");
            return ListView.__super__.render.call(this);
        }
    });

    return ListView;
});
/*
 * Copyright (c) 2013 Adobe Systems Incorporated. All rights reserved.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

define('mobileui/views/measured-view',["mobileui/views/content-view",
        "mobileui/views/layout-params"], function(ContentView, LayoutParams) {

    var MeasuredView = ContentView.extend({
        initialize: function() {
            MeasuredView.__super__.initialize.call(this);
        },

        render: function() {
            this.$el.addClass("js-measured-view");
            return MeasuredView.__super__.render.call(this);
        },

        layout: function() {
            this.layoutBounds();
            this.layoutChildren();
            this._validateHtml();
            this._validateText();
            var params = this.params(),
                hasParentDerivedWidth = params && params.hasParentDerivedWidth(),
                hasParentDerivedHeight = params && params.hasParentDerivedHeight();
            if (this.checkInvalidationFlag("size")) {
                this.$contentView.css("width", hasParentDerivedWidth ? this.bounds().width() : "");
                this.$contentView.css("height", hasParentDerivedHeight ? this.bounds().height() : "");
            }
            if (hasParentDerivedWidth || hasParentDerivedHeight) {
                // Make sure we are not going to flicker while doing this forced layout.
                this.$contentView.css("visibility", "hidden");
                if (!hasParentDerivedWidth)
                    this.bounds().setWidth(this.$contentView.outerWidth());
                if (!hasParentDerivedHeight)
                    this.bounds().setHeight(this.$contentView.outerHeight());
                this.invalidate("layoutVisibility");
            }

            this.setNeedsLayout(false);
        },

        _validateLayoutVisibility: function() {
            this.$contentView.css("visibility", "");
        }
    });

    return MeasuredView;

});
/*
 * Copyright (c) 2013 Adobe Systems Incorporated. All rights reserved.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

define('mobileui/ui/touch-list-view',["mobileui/ui/app-card-view",
        "mobileui/ui/list-view"],
    function(AppCardView, ListView) {

    var TouchListView = AppCardView.extend({

        initialize: function(options) {
            TouchListView.__super__.initialize.call(this);
            this._listView = new ListView().matchParentSize()
                .setItemRendererFactory(this._onItemRendererFactory.bind(this))
                .setCollection(this.model)
                .setScrollDirection("none");
            this._listView.contentView().matchParentSize();
            this.append(this._listView.render());
            this.on("deactivate", this._onDeactivate, this);
            this._useVerticalLayout = null;
            // Force a 3D layer.
            this.animation();
            this.transform().clear();
        },

        listView: function() {
            return this._listView;
        },

        render: function() {
            this.$el.addClass("js-touch-list-view");
            return TouchListView.__super__.render.call(this);
        },

        _onItemRendererFactory: function(model) {
            return this._createTouchListItemView(model).render()
                .setListView(this)
                .on("selected", this._onItemSelected, this);
        },

        _onItemSelected: function(selectedView, promiseList) {
            var self = this,
                selectedViewIndex = this._listView.indexOfView(selectedView);
            this.model.each(function(model, index) {
                var view = self._listView.itemView(model);
                if (!view || view == selectedView)
                    return;
                view.animateViewDeactived(promiseList, self._listView, selectedView, index - selectedViewIndex);
            });
        },

        _onDeactivate: function() {
            var self = this;
            this.model.each(function(model) {
                var view = self._listView.itemView(model);
                if (view)
                    view.resetAnimations();
            });
        },

        setUseVerticalLayout: function(useVerticalLayout) {
            if (this._useVerticalLayout == useVerticalLayout)
                return;
            if (useVerticalLayout)
                this.setVerticalLayout();
            else
                this.setHorizontalLayout();
        },

        _internalShouldUseVerticalLayout: function() {
            return true;
        },

        layout: function() {
            this.setUseVerticalLayout(this._internalShouldUseVerticalLayout());
            TouchListView.__super__.layout.call(this);
        },

        setVerticalLayout: function() {
            this._useVerticalLayout = true;
            var self = this;
            this.model.each(function(model) {
                var view = self._listView.itemView(model);
                if (!view)
                    return;
                view.setVerticalLayout();
            });
            this._listView.contentView().setLayout("vertical");
        },

        setHorizontalLayout: function() {
            this._useVerticalLayout = false;
            var self = this;
            this.model.each(function(model) {
                var view = self._listView.itemView(model);
                if (!view)
                    return;
                view.setHorizontalLayout();
            });
            this._listView.contentView().setLayout("horizontal");
        }

    });

    return TouchListView;

});
define('sample/views/url-card-view-mixin',["sample/app"],
    function(app) {

    var UrlCardViewMixin = {

        updateRouterLocation: function() {
            if (app.noUrlChanges)
                return;
            var url = this.url();
            if (!url)
                return;
            app.router.navigate(url, { trigger: false });
        }
    };

    return UrlCardViewMixin;

});
/*
 * Copyright (c) 2013 Adobe Systems Incorporated. All rights reserved.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

define('sample/cards/splash-view',["mobileui/ui/touch-item-view",
        "mobileui/ui/touch-list-view",
        "mobileui/views/layout-view",
        "mobileui/views/content-view",
        "sample/views/url-card-view-mixin",
        "sample/app"],
    function(TouchItemView,
            TouchListView,
            LayotView,
            ContentView,
            UrlCardViewMixin,
            app) {

    var SplashLabels = [
        {
            label: "San Francisco",
            className: "js-sf-item-view"
        }
    ];

    var ItemView = TouchItemView.extend({
        initialize: function() {
            ItemView.__super__.initialize.call(this);

            this._layoutView = new LayotView()
                .matchParentSize()
                .setLayout("vertical");
            this._filterView.append(this._layoutView.render());

            this._travelGuideView = new ContentView()
                .setTextContent("Photo Gallery")
                .addClass("js-splash-item-view-guide-label");
            this._travelGuideView.ensureParams().matchParentWidth().fillParentHeight().matchLineHeight(true);
            this._travelGuideView.padding().setTop(30);
            this._layoutView.append(this._travelGuideView.render());

            this._labelView = new ContentView();
            this._labelView.$el.append(this.addModelLabel().addClass("js-splash-item-view-label"));
            this._labelView.ensureParams().matchParentWidth().fillParentHeight();
            this._layoutView.append(this._labelView.render());

            this._exploreContentView = new ContentView()
                .setTextContent("Slide up")
                .addClass("js-splash-item-view-explore-label");
            this._exploreContentView.ensureParams().matchParentWidth().fillParentHeight().matchLineHeight(true);
            this._exploreContentView.padding().setBottom(30);
            this._layoutView.append(this._exploreContentView.render());

            this.setEffect("warp");
        },

        render: function() {
            ItemView.__super__.render.call(this);
            this.filterView().$el.addClass("js-splash-item-view");
            return this;
        },

        layout: function() {
            ItemView.__super__.layout.call(this);
            this.$labelEl.css("font-size", Math.min(this._labelView.bounds().height() / 4,
                this._labelView.bounds().width() / 8) + "px");
        },

        _onTapStart: function() {
            if (app.mainView.navigatorView().nextCard())
                return;
            app.mainView.navigatorView().prepareNextCard(app.router.lookupCard("City View"));
        }
    });

    var SplashView = TouchListView.extend(_.extend({

        isDefaultScreen: true,

        initialize: function(options) {
            this.model = new Backbone.Collection();
            this.model.add(_.map(SplashLabels, function(item) {
                return new Backbone.Model(item);
            }));
            SplashView.__super__.initialize.call(this);
        },

        displaysOnTop: function() {
            return true;
        },

        url: function() {
            return "card/" + encodeURIComponent("Splash View");
        },

        render: function() {
            this.$el.addClass("js-splash-view");
            return SplashView.__super__.render.call(this);
        },

        _createTouchListItemView: function(model) {
            return new ItemView({model: model});
        },

        _internalShouldUseVerticalLayout: function() {
            return false;
        }

    }, UrlCardViewMixin));

    return {
        label: "Splash View",
        view: SplashView
    };

});
/*
 * Copyright (c) 2013 Adobe Systems Incorporated. All rights reserved.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

define('sample/cards/city-view',["mobileui/ui/touch-item-view",
        "mobileui/ui/touch-list-view",
        "sample/views/url-card-view-mixin",
        "sample/app"],
    function(TouchItemView,
            TouchListView,
            UrlCardViewMixin,
            app) {

    var CityLabels = [
        {
            label: "Mood",
            className: "js-city-mood-item-view"
        },
        {
            label: "Location",
            className: "js-city-location-item-view"
        },
        {
            label: "Search",
            className: "js-city-search-item-view"
        }
    ];

    var ItemView = TouchItemView.extend({
        initialize: function() {
            ItemView.__super__.initialize.call(this);
            this.addModelLabel().addClass("js-city-item-view-label");
        },

        render: function() {
            ItemView.__super__.render.call(this);
            this.filterView().$el.addClass("js-city-item-view");
            return this;
        },

        _onTapStart: function() {
            if (app.mainView.navigatorView().nextCard())
                return;
            app.mainView.navigatorView().prepareNextCard(app.router.lookupCard("Mood View"));
        }
    });

    var CityView = TouchListView.extend(_.extend({

        initialize: function(options) {
            this.model = new Backbone.Collection();
            this.model.add(_.map(CityLabels, function(item) {
                return new Backbone.Model(item);
            }));
            CityView.__super__.initialize.call(this);
        },

        url: function() {
            return "card/" + encodeURIComponent("City View");
        },

        render: function() {
            this.$el.addClass("js-city-view");
            return CityView.__super__.render.call(this);
        },

        _createTouchListItemView: function(model) {
            return new ItemView({model: model});
        },

        _internalShouldUseVerticalLayout: function() {
            this.layoutBounds();
            return this.bounds().width() < 600;
        }

    }, UrlCardViewMixin));

    return {
        label: "City View",
        view: CityView
    };

});
/*
 * Copyright (c) 2013 Adobe Systems Incorporated. All rights reserved.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

define('sample/cards/mood-view',["mobileui/ui/touch-item-view",
        "mobileui/ui/touch-list-view",
        "sample/views/url-card-view-mixin",
        "sample/app"],
    function(TouchItemView,
            TouchListView,
            UrlCardViewMixin,
            app) {

    var MoodLabels = [
        {
            label: "Do",
            className: "js-do-item-view",
            hue: 180,
            saturation: 23
        },
        {
            label: "See",
            className: "js-see-item-view",
            hue: 283,
            saturation: 15
        },
        {
            label: "Buy",
            className: "js-buy-item-view",
            hue: 6,
            saturation: 53

        },
        {
            label: "Eat",
            className: "js-eat-item-view",
            hue: 53,
            saturation: 54
        }
    ];

    var ItemView = TouchItemView.extend({
        initialize: function() {
            ItemView.__super__.initialize.call(this);
            this.addModelLabel().addClass("js-mood-item-view-label");
            this.setEffect("fold");
        },

        render: function() {
            ItemView.__super__.render.call(this);
            this.filterView().$el.addClass("js-mood-item-view");
            return this;
        },

        _onTapStart: function() {
            if (app.mainView.navigatorView().nextCard())
                return;
            app.mainView.navigatorView().prepareNextCard(app.router.lookupCard("Locations View",
                this.model.get("hue") + ":" + this.model.get("saturation")));
        }
    });

    var MoodView = TouchListView.extend(_.extend({

        initialize: function(options) {
            this.model = new Backbone.Collection();
            this.model.add(_.map(MoodLabels, function(item) {
                return new Backbone.Model(item);
            }));
            MoodView.__super__.initialize.call(this);
        },

        url: function() {
            return "card/" + encodeURIComponent("Mood View");
        },

        render: function() {
            this.$el.addClass("js-mood-view");
            return MoodView.__super__.render.call(this);
        },

        _createTouchListItemView: function(model) {
            return new ItemView({model: model});
        }

    }, UrlCardViewMixin));

    return {
        label: "Mood View",
        view: MoodView
    };

});
define('sample/data/locations',[],function() {
    var LocationLabels = [
        {
            label: "The Abbey (club)"
        },
        {
            label: "Alameda Corridor"
        },
        {
            label: "Alex Theatre"
        },
        {
            label: "Ambassador Hotel (Los Angeles)"
        },
        {
            label: "Amoeba Music"
        },
        {
            label: "Andaz West Hollywood"
        },
        {
            label: "Anderton Court Shops"
        },
        {
            label: "Angels Flight"
        },
        {
            label: "Angelus Temple"
        },
        {
            label: "Los Angeles Aqueduct"
        },
        {
            label: "ArcLight Hollywood"
        },
        {
            label: "Avalon Hollywood"
        },
        {
            label: "Avenel Cooperative Housing Project"
        },
        {
            label: "The Abbey (club)"
        }
    ];

    var collection = new Backbone.Collection();
    collection.add(_.map(LocationLabels, function(item, i) {
        return new Backbone.Model(item).set("index", i);
    }));

    return collection;
});
/*
 * Copyright (c) 2013 Adobe Systems Incorporated. All rights reserved.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

define('sample/cards/locations-view',["mobileui/ui/touch-item-view",
        "mobileui/ui/touch-list-view",
        "mobileui/views/layout-params",
        "sample/views/url-card-view-mixin",
        "sample/data/locations",
        "sample/app"],
    function(TouchItemView,
            TouchListView,
            LayoutParams,
            UrlCardViewMixin,
            LocationLabels,
            app) {

    var ItemView = TouchItemView.extend({
        initialize: function(options) {
            _.extend(this, options);
            ItemView.__super__.initialize.call(this);
            this.addModelLabel().addClass("js-location-item-view-label");
            this.setEffect("fold");
        },

        setVerticalLayout: function() {
            this._verticalLayout = true;
            this.setParams(new LayoutParams().matchParentWidth());
            this.bounds().setHeight(100);
        },

        render: function() {
            ItemView.__super__.render.call(this);
            this.filterView().$el.addClass("js-location-item-view")
                .css("background-color", "hsl(" + this.hue + ", " + this.saturation + "%, " + Math.min(100, 28 + this.model.get("index") * 2) + "%)");
            return this;
        },

        _onTapStart: function() {
            if (app.mainView.navigatorView().nextCard())
                return;
            app.mainView.navigatorView().prepareNextCard(app.router.lookupCard("Location View", encodeURIComponent(this.model.get("label"))));
        }
    });

    var LocationsView = TouchListView.extend(_.extend({

        initialize: function(options) {
            this.hue = 283;
            this.saturation = 15;
            if (options && options.path) {
                var data = decodeURIComponent(options.path).split(":");
                this.hue = parseInt(data[0], 10);
                this.saturation = parseInt(data[1], 10);
            }
            this.model = LocationLabels;
            LocationsView.__super__.initialize.call(this);
            this.listView().setScrollDirection("vertical");
            this.listView().contentView().setParams(new LayoutParams()
                    .matchParentWidth().matchChildrenHeight());
            this.setVerticalLayout();
        },

        url: function() {
            return "card/" + encodeURIComponent("Locations View") + "/" + this.hue + ":" + this.saturation;
        },

        render: function() {
            this.$el.addClass("js-locations-view");
            return LocationsView.__super__.render.call(this);
        },

        _createTouchListItemView: function(model) {
            return new ItemView({ model: model, hue: this.hue, saturation: this.saturation });
        }

    }, UrlCardViewMixin));

    return {
        label: "Locations View",
        view: LocationsView
    };

});
/*
 * Copyright (c) 2013 Adobe Systems Incorporated. All rights reserved.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

define('sample/cards/location-view',["mobileui/views/content-view",
        "mobileui/views/measured-view",
        "mobileui/views/scroll-view",
        "mobileui/views/layout-view",
        "mobileui/views/layer-view",
        "mobileui/utils/transform",
        "mobileui/ui/app-card-view",
        "sample/views/url-card-view-mixin",
        "sample/data/locations",
        "sample/app"],
    function(ContentView,
            MeasuredView,
            ScrollView,
            LayoutView,
            LayerView,
            Transform,
            AppCardView,
            UrlCardViewMixin,
            LocationLabels,
            app) {

    var imagePaddingHeight = 150;

    var LocationView = AppCardView.extend(_.extend({
        initialize: function(options) {
            LocationView.__super__.initialize.call(this);
            this._hadPictureScrollScale = false;

            this._scrollView = new ScrollView().setScrollDirection("vertical");
            this._scrollView.matchParentSize();
            this._scrollView
                .on("scroll", this._onScroll, this)
                .on("scroll:animation", this._onScrollAnimation, this);
            this.append(this._scrollView.render());

            this._contentView = new LayoutView().setLayout("vertical")
                .addClass("js-location-content-view");
            this._contentView.ensureParams().matchParentWidth().matchChildrenHeight();
            this._contentView.margin().setTop(imagePaddingHeight);
            this._scrollView.setContentView(this._contentView.render());

            this._labelView = new ContentView()
                .addClass("js-location-view-label")
                .addContentClass("center");
            this._labelView.ensureParams().matchParentWidth();
            this._labelView.bounds().setHeight(100);
            this._contentView.append(this._labelView.render());

            if (options && options.path) {
                var decodedPath = decodeURIComponent(options.path);
                this.model = LocationLabels.find(function(item) {
                    return item.get("label") == decodedPath;
                });
            }
            if (!this.model)
                this.model = LocationLabels.first();
            this._labelView.setTextContent(this.model.get("label"));

            this._twoColumnView1 = new LayoutView().setLayout("horizontal")
                .addClass("js-location-two-column-view");
            this._twoColumnView1.ensureParams().matchParentWidth().matchChildrenHeight();
            this._contentView.append(this._twoColumnView1.render());

            this._labelView1 = new ContentView()
                .addClass("js-location-two-column-cell-view")
                .addContentClass("center");
            this._labelView1.ensureParams().fillParentWidth();
            this._labelView1.bounds().setHeight(40);
            this._labelView1.setTextContent("Label1");
            this._twoColumnView1.append(this._labelView1.render());

            this._labelView2 = new ContentView()
                .addClass("js-location-two-column-cell-view")
                .addContentClass("center");
            this._labelView2.ensureParams().fillParentWidth();
            this._labelView2.bounds().setHeight(40);
            this._labelView2.setTextContent("Label2");
            this._twoColumnView1.append(this._labelView2.render());

            this._twoColumnView2 = new LayoutView().setLayout("horizontal")
                .addClass("js-location-two-column-view");
            this._twoColumnView2.ensureParams().matchParentWidth().matchChildrenHeight();
            this._contentView.append(this._twoColumnView2.render());

            this._labelView3 = new ContentView()
                .addClass("js-location-two-column-cell-view")
                .addContentClass("center");
            this._labelView3.ensureParams().fillParentWidth();
            this._labelView3.bounds().setHeight(40);
            this._labelView3.setTextContent("Label3");
            this._twoColumnView2.append(this._labelView3.render());

            this._labelView4 = new ContentView()
                .addClass("js-location-two-column-cell-view")
                .addContentClass("center");
            this._labelView4.ensureParams().fillParentWidth();
            this._labelView4.bounds().setHeight(40);
            this._labelView4.setTextContent("Label4");
            this._twoColumnView2.append(this._labelView4.render());

            this._textContentView = new MeasuredView().setContent(
                "<div class='js-location-view-paragraph'>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Proin aliquam velit a ante tincidunt vitae tristique purus pharetra. Maecenas ut bibendum augue. Suspendisse dignissim vestibulum feugiat. Nulla facilisi. Nam purus risus, vehicula quis adipiscing sed, rhoncus nec tellus. Cras elementum, odio et pharetra elementum, est mauris pharetra magna, non malesuada nunc elit non augue. Duis commodo nisl vel augue semper eget tincidunt neque ultrices.</div>" +
                "<div class='js-location-view-paragraph'>Phasellus in velit mauris. Quisque cursus dapibus imperdiet. Aliquam erat volutpat. Cum sociis natoque penatibus et magnis dis parturient montes, nascetur ridiculus mus. Vestibulum ut elit dui, ac sagittis nisi. Donec porta magna sit amet ante vulputate in semper neque interdum. Nulla non lacus quam, et tempor mauris. Vestibulum non suscipit est. Donec mollis lectus eu purus lobortis cursus. Mauris facilisis ligula vitae mauris suscipit tempus. Praesent malesuada rhoncus quam, in interdum tortor pulvinar in. Fusce suscipit, nisl et lobortis convallis, sapien massa pharetra felis, vitae adipiscing libero est dictum mi. Integer lobortis diam ut quam ultricies quis auctor dui pulvinar. Nulla facilisi. Ut pellentesque adipiscing tempor.</div>" +
                "<div class='js-location-view-paragraph'>Nullam at lobortis justo. Sed vel sapien sem. Aliquam elementum erat non tortor vehicula porttitor. Nam euismod, nulla vitae semper aliquam, quam tortor convallis mi, quis hendrerit mauris nisl at elit. Nunc eu leo orci, vitae fringilla ipsum. Praesent urna massa, sodales eget faucibus et, ultrices at augue. Nunc sit amet augue vel mi posuere sagittis in sed lacus. Proin ac enim sed sem placerat laoreet sed nec lectus. Suspendisse porta libero eget urna imperdiet at rhoncus risus molestie.</div>");
            this._textContentView.padding().setAll(10);
            this._textContentView.ensureParams().matchParentWidth();
            this._contentView.append(this._textContentView.render());

            // Append the picture view first, so that it displays under
            // the content of our card when it is scrolled.
            this._pictureScrollView = new ScrollView().setScrollDirection("horizontal").setSnapToChildrenBounds()
                .addClass("js-location-picture-scroll-view")
                .forceLayer();
            this._pictureScrollView.on("scroll", this._onPictureViewScroll, this);
            this._pictureScrollView.ensureParams().matchParentWidth();
            this._pictureScrollView.bounds().setHeight(imagePaddingHeight);
            this._scrollView.before(this._pictureScrollView.render(), this._contentView);

            this._pictureView =  new LayoutView().setLayout("horizontal");
            this._pictureView.ensureParams().matchChildrenWidth().matchParentHeight();
            this._pictureScrollView.setContentView(this._pictureView.render());

            var colors = ["DeepSkyBlue", "PaleVioletRed", "MediumSlateBlue", "DarkSeaGreen", "BurlyWood"];
            for (var i = 0; i < colors.length; ++i) {
                var picture = new LayerView();
                picture.addGestureDetector()
                    .on("tap", this._onPictureTap.bind(this, picture));
                picture.color = colors[i];
                picture.index = i + 1;
                picture.ensureParams().matchWidthOf(this._pictureScrollView).matchParentHeight();
                picture.$el.css("background-color", colors[i])
                    .append($("<div />")
                        .css("font-size", "2.5em")
                        .addClass("center")
                        .text(i + 1));
                this._pictureView.append(picture.render());
            }

            this._canOpenPictureView = false;
        },

        _onPictureTap: function(view) {
            app.mainView.navigatorView().pushCard(app.router.lookupCard("Picture View",
                encodeURIComponent(view.color + ":" + view.index)), {
                scaleFrom: this._pictureScrollView
            });
        },

        _onScroll: function() {
            var scrollTop = this._scrollView.scrollTop();
            if (this._hadPictureScrollScale)
                this._pictureScrollView.animation().get("scroll-scale").removeAll();
            if (scrollTop < 0) {
                this._hadPictureScrollScale = true;
                var height = imagePaddingHeight - scrollTop,
                    scaleRatio = height / imagePaddingHeight;
                this._canOpenPictureView = scaleRatio > this._pictureScrollView.transform().get("scale").y();
                this._pictureScrollView.forceLayer()
                    .transform()
                        .get("scale")
                        .setX(scaleRatio)
                        .setY(scaleRatio);
            } else if (this._hadPictureScrollScale) {
                this._hadPictureScrollScale = false;
                this._canOpenPictureView = false;
                this._pictureScrollView.transform().clear();
            }
        },

        _onScrollAnimation: function(scrollLeft, scrollTop, duration, momentumScroll) {
            if (!this._hadPictureScrollScale && scrollTop >= 0)
                return;
            var height = imagePaddingHeight - scrollTop,
                scaleRatio = height / imagePaddingHeight;
            if (!momentumScroll)
                scaleRatio = Math.max(1, scaleRatio);
            this._pictureScrollView.animation().start()
                .get("scroll-scale")
                .removeAll()
                .chain()
                .transform(duration, new Transform().scale(scaleRatio, scaleRatio))
                .setTimingFunction("easeOut")
                .callback(function() {
                    if (!momentumScroll)
                        this._hadPictureScrollScale = scrollTop < 0;
                }, this);

            if (!momentumScroll && this._canOpenPictureView &&
                this._pictureScrollView.transform().get('scale').y() > 1.5) {
                var view = this._pictureScrollView.selectedView();
                if (view)
                    this._onPictureTap(view);
            }
        },

        _onPictureViewScroll: function() {
            if (this._scrollView.scrollTop() > 0 && !this._scrollView.isScrolling())
                this._scrollView.scrollToWithAnimation(0, 0);
        },

        render: function() {
            this.$el.addClass("js-location-view");

            return LocationView.__super__.render.call(this);
        },

        url: function() {
            return "card/" + encodeURIComponent("Location View") + "/" + encodeURIComponent(this.model.get("label"));
        }
    }, UrlCardViewMixin));

    return {
        label: "Location View",
        view: LocationView
    };

});
/*
 * Copyright (c) 2013 Adobe Systems Incorporated. All rights reserved.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

define('sample/cards/picture-view',["mobileui/ui/app-card-view",
        "mobileui/views/layer-view",
        "mobileui/utils/transform",
        "sample/views/url-card-view-mixin",
        "mobileui/utils/lock"],
    function(AppCardView, LayerView, Transform, UrlCardViewMixin, lock) {

    var PictureView = AppCardView.extend(_.extend({
        initialize: function(options) {
            PictureView.__super__.initialize.call(this);
            this.addGestureDetector();
            this.on("tap", this._onTap, this);
            this._initialView = null;
            this._needsTopBar = false;

            this._pictureView = new LayerView().matchParentSize().addClass("js-picture-view").forceLayer();
            this.append(this._pictureView.render());
            this.color = "";
            this.index = 0;
            if (options && options.path) {
                var data = decodeURIComponent(options.path).split(":");
                this.color = data[0];
                this.index = data[1];
                this._pictureView.$el.css("background-color", this.color)
                    .append($("<div />")
                        .css("font-size", "2.5em")
                        .addClass("center")
                        .text(this.index));
            }
        },

        _computeViewTransform: function(view) {
            if (!view)
                return new Transform().translate(0, 0).scale(1, 1);
            var rect = view.getScreenRect();
            return new Transform().translate(rect.left, rect.top)
                .scale(rect.width / this.navigatorView().bounds().width(), 
                    rect.height / this.navigatorView().bounds().height());
        },

        _onActivate: function(options) {
            this._needsTopBar = false;

            if (options.goingBack)
                return PictureView.__super__._onAppCardViewActivate.call(this, options);
            
            this.updateRouterLocation();

            lock.startTransition();
            
            this._initialView = options.scaleFrom;
            this._pictureView.transform().take(this._computeViewTransform(this._initialView));

            this._pictureView.animation().start().get("show")
                .chain()
                .transform(100, new Transform().translate(0, 0).scale(1, 1))
                .callback(function() {
                    lock.endTransition(this);
                    this._updateNavigationBar();
                }, this);
            options.promise = this._pictureView.animation().promise();
        },

        _animateBackButton: function(nextCard, options) {
            if (!this._initialView)
                return PictureView.__super__._animateBackButton.call(this, nextCard, options);

            var self = this;
            lock.startTransition();
            
            this._pictureView.animation().start().get("show")
                .chain()
                .transform(100, this._computeViewTransform(this._initialView))
                .callback(function() {
                    lock.endTransition(this);
                }, this);
            
            options.promise = this._pictureView.animation().promise();
        },

        _onDragStart: function() {
            this._needsTopBar = true;
            this._updateNavigationBar();
            PictureView.__super__._onDragStart.call(this);
        },

        needsTopBar: function() {
            return this._needsTopBar;
        },

        hasLayoutMarginFromTopBar: function() {
            return false;
        },

        url: function() {
            return "card/" + encodeURIComponent("Picture View") + "/" + encodeURIComponent(this.color + ":" + this.index);
        },

        render: function() {
            this.$el.addClass("js-picture-view-container");
            return PictureView.__super__.render.call(this);
        },

        _onTap: function() {
            this._needsTopBar = !this._needsTopBar;
            this._updateNavigationBar();
        }

    }, UrlCardViewMixin));

    return {
        label: "Picture View",
        view: PictureView
    };

});
/*
 * Copyright (c) 2013 Adobe Systems Incorporated. All rights reserved.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

define('sample/cards/list',[
    "sample/cards/splash-view",
    "sample/cards/city-view",
    "sample/cards/mood-view",
    "sample/cards/locations-view",
    "sample/cards/location-view",
    "sample/cards/picture-view"
    ],
function() {
    return _.toArray(arguments);
});
/*
 * Copyright (c) 2013 Adobe Systems Incorporated. All rights reserved.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

define('mobileui/ui/scroll-card-view',["mobileui/ui/navigator-card-view",
        "mobileui/views/scroll-view"],
function(NavigatorCardView, ScrollView) {

    var ScrollCardView = NavigatorCardView.extend({

        initialize: function() {
            ScrollCardView.__super__.initialize.call(this);
            this._scrollView = new ScrollView()
                    .matchParentSize()
                    .setScrollDirection(ScrollView.VERTICAL);
            this.append(this._scrollView.render());
        },

        render: function() {
            this.$el.addClass("js-scroll-card-view");
            return ScrollCardView.__super__.render.call(this);
        },

        scrollView: function() {
            return this._scrollView;
        }

    });

    return ScrollCardView;
});
/*
 * Copyright (c) 2013 Adobe Systems Incorporated. All rights reserved.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

define('mobileui/ui/navigator-top-bar-view',["mobileui/views/layout-view",
        "mobileui/views/layout-params",
        "mobileui/utils/transform",
        "mobileui/ui/button-view"],
function(LayoutView, LayoutParams, Transform, ButtonView) {

    var NavigatorTopBarView = LayoutView.extend({
        initialize: function() {
            NavigatorTopBarView.__super__.initialize.call(this);
            this.bounds().setHeight(NavigatorTopBarView.height);
            this.ensureParams().matchParentWidth();
            this.setLayout("horizontal");
            this._topBarVisible = true;
            this.invalidate("topBarVisibility");
        },

        render: function() {
            this.$el.addClass("js-navigator-top-bar-view");
            return NavigatorTopBarView.__super__.render.call(this);
        },

        updateVisiblity: function(visible) {
            if (this._topBarVisible == visible)
                return;
            this._topBarVisible = visible;
            this.invalidate("topBarVisibilityWithAnimation");
        },

        _topBarPosition: function() {
            return this._topBarVisible ? 0 : - this.bounds().height();
        },

        _validateTopBarVisibility: function() {
            this.transform().get("translate").setY(this._topBarPosition());
        },

        _validateTopBarVisibilityWithAnimation: function() {
            this.animation().start().get("visibility").removeAll()
                .chain()
                .transform(100, new Transform().translate(0,
                    this._topBarPosition()));
        }
    });

    _.extend(NavigatorTopBarView, {
        height: 50
    });

    return NavigatorTopBarView;
});
/*
 * Copyright (c) 2013 Adobe Systems Incorporated. All rights reserved.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

define('mobileui/ui/navigator-content-view',["mobileui/views/layer-view",
        "mobileui/views/layout-params"],
function(LayerView, LayoutParams) {

    var NavigatorContentView = LayerView.extend({
        initialize: function() {
            NavigatorContentView.__super__.initialize.call(this);
            this.ensureParams().matchParentWidth().matchParentHeight();
        },

        render: function() {
            this.$el.addClass("js-navigator-content-view");
            return NavigatorContentView.__super__.render.call(this);
        }
    });

    return NavigatorContentView;
});
/*
 * Copyright (c) 2013 Adobe Systems Incorporated. All rights reserved.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

define('mobileui/ui/navigator-view',["mobileui/views/layer-view",
        "mobileui/views/layout-params",
        "mobileui/ui/navigator-top-bar-view",
        "mobileui/ui/navigator-content-view"],
function(LayerView, LayoutParams, NavigatorTopBarView, NavigatorContentView) {

    var NavigatorView = LayerView.extend({
        initialize: function() {
            NavigatorView.__super__.initialize.call(this);
            this.matchParentSize();

            this._contentView = new NavigatorContentView()
                .forceLayer();
            this.append(this._contentView.render());

            this._topBarView = new NavigatorTopBarView()
                .forceLayer();
            this._contentView.append(this._topBarView.render());

            this._historyCards = [];
            this._activeCard = null;
            this._nextCard = null;
            this._precommitCard = null;
            this._usesHistory = true;
            this._removeCardAfterCommit = false;
        },

        render: function() {
            this.$el.addClass("js-navigator-view");
            return NavigatorView.__super__.render.call(this);
        },

        setUsesHistory: function(value) {
            this._usesHistory = value;
            return this;
        },

        topBarView: function() {
            return this._topBarView;
        },

        contentView: function() {
            return this._contentView;
        },

        activeCard: function() {
            return this._activeCard;
        },

        nextCard: function() {
            return this._nextCard;
        },

        canGoBack: function() {
            return this._historyCards.length > 0 ||
                (this._activeCard && this._activeCard.hasPreviousCard());
        },

        canGoForward: function() {
            return this._activeCard && this._activeCard.hasNextCard();
        },

        forwardCard: function() {
            return this._activeCard ? this._activeCard.nextCard() : null;
        },

        previousCard: function() {
            var card = _.last(this._historyCards);
            if (!card && this._activeCard)
                card = this._activeCard.previousCard();
            return card;
        },

        prepareHistoryCard: function() {
            var card = this.previousCard();
            return this.prepareNextCard(card);
        },

        prepareNextCard: function(card) {
            // Animation started, add a new card in the back.
            if (this._nextCard)
                this.revertNextCard();
            this._removeCardAfterCommit = false;
            this._nextCard = card;
            if (this._activeCard && !this._activeCard.displaysOnTop())
                this.contentView().before(this._nextCard, this._activeCard);
            else
                this.contentView().before(this._nextCard, this._topBarView);
            this._nextCard._setNavigatorView(this);
            this._nextCard.trigger("card:next");
            this.trigger("card:next", this._nextCard);
            return this;
        },

        _isLastHistoryCard :function(card) {
            return _.last(this._historyCards) == this._nextCard;
        },

        revertNextCard: function() {
            if (this._precommitCard)
                return this.commitNextCard();
            if (!this._nextCard)
                return this;
            this._nextCard.trigger("card:revert");
            this.trigger("card:revert", this._nextCard);
            this._nextCard._setNavigatorView(null);
            // If this was a history card, we just put it back and detach.
            if (this._isLastHistoryCard(this._nextCard))
                this._nextCard.detach();
            else
                this._nextCard.remove();
            this._nextCard = null;
            this._removeCardAfterCommit = false;
            return this;
        },

        precommitNextCard: function() {
            if (!this._nextCard)
                return this;
            // Figure out if we are going forward or backwards.
            this._removeCardAfterCommit = !this._usesHistory || this._isLastHistoryCard(this._nextCard);
            if (this._usesHistory) {
                if (this._removeCardAfterCommit)
                    this._historyCards.pop();
                else
                    this._historyCards.push(this._activeCard);
            }
            this._precommitCard = this._activeCard;
            this._activeCard = this._nextCard;
            this._nextCard = null;
            this._activeCard.trigger("card:precommit");
            this.trigger("card:precommit", this._activeCard);
            return this;
        },

        commitNextCard: function() {
            // Figure out if we are going forward or backwards.
            if (this._precommitCard) {
                this._precommitCard.trigger("deactivate");
                this._precommitCard._setNavigatorView(null);
                if (this._removeCardAfterCommit)
                    this._precommitCard.remove();
                else
                    this._precommitCard.detach();
                this._precommitCard = null;
            }
            if (this._activeCard.displaysOnTop())
                this._contentView.append(this._activeCard);
            this._activeCard.trigger("card:commit");
            this.trigger("card:commit", this._activeCard);
            this._activeCard.trigger("activate", { goingBack: false });
            this.trigger("activate", this._activeCard, { goingBack: false });
            this._activeCard.trigger("ready");
            return this;
        },

        resetCard: function(card) {
            this.revertNextCard();
            var previousActiveCard = this._activeCard;
            if (this._activeCard) {
                this._activeCard.trigger("deactivate");
                this.trigger("deactivate", this._activeCard);
                this._activeCard = null;
            }
            var options = {
                goingBack: false,
                promise: null
            };
            if (card) {
                this._activeCard = card;
                this._activeCard._setNavigatorView(this);
                this._activeCard.trigger("activate", options);
                this.trigger("activate", this._activeCard, options);
                if (card.displaysOnTop())
                    this._contentView.append(card);
                else
                    this._contentView.before(card, this._topBarView);
            }
            if (previousActiveCard) {
                if (!options.promise) {
                    previousActiveCard._setNavigatorView(null).remove();
                    this._activeCard.trigger("ready");
                } else
                    options.promise.then(function() {
                        previousActiveCard._setNavigatorView(null).remove();
                        self._activeCard.trigger("ready");
                    });
            }
        },

        pushCard: function(card, pushOptions) {
            this.revertNextCard();
            if (!card)
                card = this.forwardCard();
            var previousActiveCard = this._activeCard;
            if (this._activeCard) {
                this._activeCard.trigger("deactivate");
                this.trigger("deactivate", this._activeCard);
                if (this._usesHistory)
                    this._historyCards.push(this._activeCard);
                this._activeCard = null;
            }
            var options = _.extend({
                goingBack: false,
                promise: null,
                previousCard: previousActiveCard
            }, pushOptions);
            if (card) {
                this._activeCard = card;
                this._activeCard._setNavigatorView(this);
                this._activeCard.trigger("activate", options);
                this.trigger("activate", this._activeCard, options);
                if (card.displaysOnTop())
                    this._contentView.append(card);
                else
                    this._contentView.before(card, this._topBarView);
            }
            if (previousActiveCard) {
                if (!options.promise) {
                    previousActiveCard._setNavigatorView(null).detach();
                    this._activeCard.trigger("ready");
                } else {
                    var self = this;
                    options.promise.then(function() {
                        previousActiveCard._setNavigatorView(null).detach();
                        self._activeCard.trigger("ready");
                    });
                }
            }
        },

        popCard: function() {
            this.revertNextCard();
            var previousActiveCard = this._activeCard,
                self = this;
            var nextCard = this.previousCard();
            if (this._activeCard) {
                this._activeCard.trigger("deactivate");
                this.trigger("deactivate", this._activeCard);
                this._activeCard = null;
            }
            if (nextCard) {
                var options = {
                    goingBack: true,
                    promise: null,
                    previousCard: previousActiveCard
                };
                if (_.last(this._historyCards) === nextCard)
                    this._historyCards.splice(this._historyCards.length - 1, 1);
                this._activeCard = nextCard;
                if (previousActiveCard)
                    this._contentView.before(this._activeCard, previousActiveCard);
                else
                    this._contentView.before(this._activeCard, this._topBarView);
                this._activeCard._setNavigatorView(this);
                this._activeCard.trigger("activate", options);
                this.trigger("activate", this._activeCard);
                if (previousActiveCard) {
                    if (!options.promise) {
                        previousActiveCard._setNavigatorView(null).remove();
                        if (this._activeCard.displaysOnTop())
                            this._contentView.append(this._activeCard);
                        this._activeCard.trigger("ready");
                    } else
                        options.promise.then(function() {
                            previousActiveCard._setNavigatorView(null).remove();
                            if (self._activeCard.displaysOnTop())
                                self._contentView.append(self._activeCard);
                            self._activeCard.trigger("ready");
                        });
                }
            } else if (previousActiveCard)
                previousActiveCard._setNavigatorView(null).remove();
            return this._activeCard;
        }
    });

    return NavigatorView;

});
/*
 * Copyright (c) 2013 Adobe Systems Incorporated. All rights reserved.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

define('sample/tests/old-test',["mobileui/ui/scroll-card-view",
        'mobileui/ui/navigator-view',
        'mobileui/views/layer-view',
        'mobileui/views/gesture-view',
        'mobileui/views/measured-view',
        'mobileui/views/layout-view',
        'mobileui/views/scroll-view',
        'mobileui/utils/transform',
        'mobileui/utils/animations/transform-animation',
        'mobileui/views/layout-params',
        'sample/app'], function(ScrollCardView,
             NavigatorView,
             LayerView,
             GestureView,
             MeasuredView,
             LayoutView,
             ScrollView,
             Transform,
             TransformAnimation,
             LayoutParams,
             app) {

    var OldTestView = ScrollCardView.extend({

        initialize: function() {
            OldTestView.__super__.initialize.call(this);
            this.on("activate", this._onViewActivated, this);
        },

        _onViewActivated: function() {
            app.router.navigate("test/" + encodeURIComponent("Old test"), { trigger: false });
        },

        render: function() {
            OldTestView.__super__.render.call(this);
            this.$el.addClass("js-old-test-view");
            var self = this;

            var layer0 = new LayoutView().setParams(new LayoutParams().matchChildren());
            this.scrollView().setContentView(layer0);
            layer0.setLayout("vertical");

            var layer1 = new LayoutView();
            layer1.setLayout("vertical");
            layer1.bounds().setSize(100, 300);

            var layer1_content1 = new LayerView();
            layer1_content1.bounds().setSize(90, 50);
            layer1_content1.render().$el.addClass("red-box").html("Inside of the first layer");
            layer1.append(layer1_content1);

            var layer1_content2 = new GestureView();
            layer1_content2.setParams(new LayoutParams().fillParentHeight()).bounds().setWidth(90);
            layer1_content2.render().$el.addClass("green-box").html("Inside of the second layer");
            layer1.append(layer1_content2);
            layer1_content2.on("tap", function() {
                self.scrollView().setScrollDirection(ScrollView.VERTICAL);
                layer0.setLayoutWithAnimation("vertical");
            });

            var layer1_content3 = new LayerView();
            layer1_content3.bounds().setSize(90, 50);
            layer1_content3.render().$el.addClass("red-box").html("Inside of the third layer");
            layer1.append(layer1_content3);

            var layer2 = new GestureView();

            layer0.append(layer1.render().addClass("blue-box"))
                .append(layer2.render().addClass("red-box"));

            //layer1.transform().rotate(20);

            layer2.bounds().setWidth(200).setHeight(100);
            //layer2.transform().perspective(100).rotateY(20);
            layer2.on("tap", function() {
                self.scrollView().setScrollDirection(ScrollView.HORIZONTAL);
                layer0.setLayoutWithAnimation("horizontal");
            });

            var layer4 = new LayoutView();
            layer4.setLayout("vertical").addGestureDetector();

            layer4.bounds().setX(100);
            layer0.append(layer4.render().addClass("red-box"));
            layer4.setParams(new LayoutParams().matchChildren());
            layer4.append(new MeasuredView().render().setContent("Line 1"));
            layer4.append(new MeasuredView().render().setContent("Line 2 is super long"));
            layer4.append(new MeasuredView().render().setContent("Line 3"));
            layer4.append(new MeasuredView().render().setContent("Line 4"));
            layer4.padding().setLeft(100).setTop(50).setBottom(10).setRight(60);

            // layer4.animation().chain()
            //     .transform(100, Transform().rotate(100));
                // .wait(500)
                // .transform(100, Transform().rotate(0))
                // .wait(500)
                // .transform(100, Transform().rotate(30))
                // .wait(500)
                // .transform(100, Transform().rotate(-30))
                // .wait(500)
                // .transform(100, Transform().rotate(0));

            var layer5;

            layer4.animation().chain(10);
            layer4.animation().start().once("stop", function() {
                var layer3 = new MeasuredView();
                layer0.beforeWithAnimation(layer3.render().addClass("green-box"), layer1);
                layer3.setContent("Box of the right size");

                layer5 = new MeasuredView();
                layer0.beforeWithAnimation(layer5.render().addClass("green-box"), layer4);
                layer5.setContent("Box of the right size<br /> - test");
            });

            layer4.on("tap", function() {
                if (!layer5)
                    return;
                if (layer5.parent())
                    layer5.detachWithAnimation();
                else
                    layer0.beforeWithAnimation(layer5, layer4);
            });

            var layer6 = new ScrollView().setScrollDirection(ScrollView.VERTICAL);
            layer6.setContentView(new LayoutView().render().setLayout("vertical"));
            layer6.contentView()
                .setParams(new LayoutParams().matchChildrenHeight())
                .append(new MeasuredView().render().setContent("Item 1"))
                .append(new MeasuredView().render().setContent("Item 2"))
                .append(new MeasuredView().render().setContent("Item 3"))
                .append(new MeasuredView().render().setContent("Item 4"))
                .append(new MeasuredView().render().setContent("Item 6"))
                .append(new MeasuredView().render().setContent("Item 7"))
                .append(new MeasuredView().render().setContent("Item 8"))
                .append(new MeasuredView().render().setContent("Item 9"));
            layer6.$el.addClass("green-box");
            layer6.bounds().setSize(100, 100);
            layer6.scrollTo(0, 100);
            layer0.append(layer6.render());


            var layer7 = new ScrollView().setScrollDirection(ScrollView.HORIZONTAL);
            layer7.setContentView(new LayoutView().render().setLayout("horizontal"));
            layer7.contentView()
                .setParams(new LayoutParams().matchChildrenWidth())
                .append(new MeasuredView().render().setContent("Item 1"))
                .append(new MeasuredView().render().setContent("Item 2"))
                .append(new MeasuredView().render().setContent("Item 3"))
                .append(new MeasuredView().render().setContent("Item 4"))
                .append(new MeasuredView().render().setContent("Item 6"))
                .append(new MeasuredView().render().setContent("Item 7"))
                .append(new MeasuredView().render().setContent("Item 8"))
                .append(new MeasuredView().render().setContent("Item 9"));
            layer7.$el.addClass("green-box");
            layer7.bounds().setSize(100, 100);
            layer7.scrollTo(100, 0);
            layer0.append(layer7.render());

            // setInterval(function() {
            //     if (!layer5)
            //         return;
            //     var layer6 = new MeasuredView();
            //     layer0.before(layer6.render().addClass("green-box"), layer4, true);
            //     layer6.setContent("Box of the right size<br /> - test");
            // }, 1000);


            return this;
        }

    });

    return {
        label: "Old test",
        view: OldTestView
    };

});
/*
 * Copyright (c) 2013 Adobe Systems Incorporated. All rights reserved.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

define('sample/tests/list',[
    "sample/tests/old-test"
    ],
function() {
    return _.toArray(arguments);
});
/*
 * Copyright (c) 2013 Adobe Systems Incorporated. All rights reserved.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

define('sample/views/index-view',["mobileui/ui/app-card-view",
        "mobileui/ui/list-view",
        "mobileui/views/layout-params",
        "mobileui/views/measured-view",
        "sample/cards/list",
        "sample/tests/list",
        "sample/app"],
    function(AppCardView, ListView, LayoutParams,
        MeasuredView, CardsList, TestsList, app) {

    var ItemView = MeasuredView.extend({
        initialize: function() {
            ItemView.__super__.initialize.call(this);
            this.addGestureDetector();
            this.on("tap", this._onTap, this);
            this.setParams(new LayoutParams().matchParentWidth());
            this.listenTo(this.model, "change:label", this._onLabelChanged);
            this.padding().setAll(10);
        },

        render: function() {
            ItemView.__super__.render.call(this);
            this.$el.addClass("js-item-view");
            this._onLabelChanged();
            return this;
        },

        _onLabelChanged: function() {
            this.setTextContent(this.model.get("label"));
        },

        _onTap: function() {
            this.trigger("selected", this.model);
        }
    });

    var IndexView = AppCardView.extend({

        initialize: function(options) {
            IndexView.__super__.initialize.call(this);
            this.model = new Backbone.Collection();
            this.model.add(_.map(CardsList, function(item) {
                return new Backbone.Model(item);
            }));
            this.model.add(_.map(TestsList, function(item) {
                return new Backbone.Model(item);
            }));
        },

        render: function() {
            this.$el.addClass("js-index-view");
            this._listView = new ListView().matchParentSize()
                .setItemRendererFactory(this._onItemRendererFactory.bind(this))
                .setCollection(this.model);
            this.append(this._listView.render());
            return IndexView.__super__.render.call(this);
        },

        _onItemRendererFactory: function(model) {
            return new ItemView({model: model}).render()
                .on("selected", this._onItemSelected, this);
        },

        _onItemSelected: function(model) {
            app.mainView.navigatorView().pushCard(
                app.router.lookupCard(model.get("label")));
        },

        url: function() {
            return "/";
        }

    });

    return IndexView;

});
/*
 * Copyright (c) 2013 Adobe Systems Incorporated. All rights reserved.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

define('sample/router',["sample/app", "sample/views/index-view", "sample/cards/list", "sample/tests/list"],
    function(app, IndexView, CardsList, TestsList) {

    var Router = Backbone.Router.extend({
        routes: {
            "card/*path/*options": "card",
            "card/*path": "card",
            "index": "index",
            "*path": "defaultHandler"
        },

        defaultHandler: function() {
            var view = this.lookupCard(app.defaultCard);
            app.mainView.navigatorView().resetCard(view ? view : new IndexView().render());
        },

        index: function() {
            app.mainView.navigatorView().pushCard(new IndexView().render());
        },

        card: function(path, pathOptions) {
            var view = this.lookupCard(decodeURIComponent(path), pathOptions);
            app.mainView.navigatorView().resetCard(view ? view : new IndexView().render());
        },

        lookupCard: function(label, pathOptions) {
            var viewItem = _.find(CardsList, function(item) {
                return item.label == label;
            });
            if (!viewItem) {
                viewItem = _.find(TestsList, function(item) {
                    return item.label == label;
                });
                if (!viewItem)
                    return null;
            }
            var ViewConstructor = viewItem.view;
            if (!ViewConstructor)
                return null;
            var view = new ViewConstructor({
                path: pathOptions
            }).render();
            return view;
        }
    });

    var router = app.router = new Router();

    app.on("start", function() {
        Backbone.history.start({});
    });

    return router;
});
/*
 * Copyright (c) 2013 Adobe Systems Incorporated. All rights reserved.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

define('mobileui/ui/window-view',["mobileui/views/layout-view"], function(LayoutView) {

    var WindowView = LayoutView.extend({
        initialize: function() {
            WindowView.__super__.initialize.call(this);
            if (WindowView.instance) {
                // Support nested WindowViews.
                return;
            }
            // Keep a reference to the main view so that DialogView can attach itself to the window.
            WindowView.instance = this;
            $(window).on("resize", this._onWindowResize.bind(this));
            this._onWindowResize();
            // Make sure we eat all the events before reaching the browser,
            // to prevent any default scrolling behavior.
            this.setNeedsTouchEvents(true);
            var eventRelay = this._sendEventRecursive.bind(this);
            $(window).on("keydown", eventRelay);
            $(window).on("keyup", eventRelay);
            $(window).on("keypress", eventRelay);
        },

        render: function() {
            this.$el.addClass("js-window-view");
            return WindowView.__super__.render.call(this);
        },

        // Overwrite this function to return the main element of the WindowView.
        // It's used in DialogView to apply effects when a new Dialog is shown.
        contentView: function() {
            return null;
        },

        _onWindowResize: function() {
            this.bounds()
                .setSize(window.innerWidth, window.innerHeight);
            this.setNeedsLayout(true);
        }
    }, {
        fromLayer: function(layer) {
            var windowLayer = layer;
            console.log(layer);
            for (; windowLayer; windowLayer = windowLayer.parent()) {
                if (windowLayer instanceof WindowView)
                    return windowLayer;
            }
            return null;
        }
    });

    WindowView.instance = null;

    return WindowView;
});
/*
 * Copyright (c) 2013 Adobe Systems Incorporated. All rights reserved.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

define('mobileui/ui/dialog-view',['mobileui/views/layout-view',
        'mobileui/views/layer-view',
        'mobileui/views/layout-params',
        'mobileui/ui/window-view',
        'mobileui/utils/transform',
        'mobileui/utils/lock'],
    function(LayoutView, LayerView, LayoutParams, WindowView, Transform, app) {

    var activeDialogView = null;

    var DialogView = LayoutView.extend({

        initialize: function() {
            DialogView.__super__.initialize.call(this);
            this.setParams(new LayoutParams().matchParentWidth().matchParentHeight());

            this._backgroundView = new LayerView()
                .addGestureDetector()
                .matchParentSize()
                .addClass("js-dialog-background-view")
                .setOpacity(0)
                .on("tap", this._onBackgroundTap, this)
                .render();
            this.append(this._backgroundView);

            this._contentView = new LayoutView()
                .setParams(new LayoutParams().matchParentWidth().matchChildrenHeight())
                .setLayout("vertical")
                .addClass("js-dialog-content-view")
                .render();
            this.append(this._contentView);
            this._canShow = true;
            this._canHide = true;
            this._isActive = false;

            this.on("keydown", this._onKeyDown, this);
        },

        isActive: function() {
            return this._isActive;
        },

        contentView: function() {
            return this._contentView;
        },

        render: function() {
            DialogView.__super__.render.call(this);
            this.$el.addClass("js-dialog-view");
            return this;
        },

        layout: function() {
            DialogView.__super__.layout.call(this);
            this._contentView.bounds().setY(this.bounds().height() - this._contentView.bounds().height());
        },

        _makeTransform: function(r1, r2, y) {
            var height = this._attachedView.bounds().height();
            return new Transform()
                    .perspective(1000)
                    .translate(0, y * height)
                    .translate(0, -height / 2)
                    .rotateX(-r1)
                    .translate(0, height)
                    .rotateX(r2)
                    .translate(0, -height / 2);
        },

        _validateShowAnimation: function() {
            if (!this._attachedView)
                return;
            this._backgroundView.animation().start().get("dialog-opacity")
                .chain()
                .opacity(300, 0.3);
            this._contentView.transform().get("translate").setY(this.bounds().height());
            this._contentView.animation().start().get("show-transition").removeAll()
                .chain()
                .transform(300, new Transform().translate());
            if (this._canShow) {
                this._attachedView.transform().set(this._makeTransform(0, 0, 0));
                this._attachedView.animation().start().get("dialog-transform")
                    .removeAll()
                    .chain()
                    .transform(200, this._makeTransform(35, 0, 0.05))
                    .transform(200, this._makeTransform(35, 35, 0.15));
            } else {
                this._attachedView.animation().start().get("dialog-transform")
                    .removeAll()
                    .chain()
                    .transform(200, this._makeTransform(35, 35, 0.15));
            }
        },

        _validateHideAnimation: function() {
            if (!this._attachedView)
                return this._onHideAnimationEnd();
            this._contentView.transform().get("translate");
            this._contentView.animation().start().get("show-transition").removeAll()
                .chain()
                .transform(400, new Transform().translate(0, this.bounds().height()))
                .callback(this._onHideAnimationEnd, this);
            if (this._canHide) {
                this._attachedView.animation().start().get("dialog-transform")
                    .removeAll()
                    .chain()
                    .transform(200, this._makeTransform(35, 10, 0.05))
                    .transform(200, this._makeTransform(0, 0, 0));
            }
            this._backgroundView.animation().start().get("dialog-opacity")
                .chain()
                .opacity(300, 0);
        },

        _onHideAnimationEnd: function() {
            if (activeDialogView === this)
                activeDialogView = null;
            if (this._canHide && this._attachedView) {
                this._attachedView.transform().clear();
                this._attachedView.setDisabled(false);
            }
            this._attachedView = null;
            this.setVisible(false);
            this.trigger("hide");
        },

        show: function(container) {
            if (this._isActive)
                return;
            this._isActive = true;
            if (activeDialogView) {
                activeDialogView._canHide = false;
                this._canShow = false;
            }
            activeDialogView = this;
            this.setVisible(true);
            var parentWindow = WindowView.fromLayer(container);
            if (this.parent() !== parentWindow)
                parentWindow.append(this);
            this._attachedView = parentWindow.contentView();
            if (this._attachedView)
                this._attachedView.setDisabled(true);
            this.trigger("show");
            this.invalidate("showAnimation");
            return this;
        },

        hide: function() {
            if (!this._isActive)
                return;
            this._isActive = false;
            this.invalidate("hideAnimation");
            return this;
        },

        _onBackgroundTap: function() {
            this.hide();
        },

        _onKeyDown: function() {
            switch (event.keyCode) {
                case 27: // escape
                    return this.hide();
            }
        }
    });

    return DialogView;

});
/*
 * Copyright (c) 2013 Adobe Systems Incorporated. All rights reserved.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

define('mobileui/ui/checkbox-view',[
        "mobileui/views/gesture-view",
        "mobileui/views/layer-view",
        "mobileui/utils/transform",
        "mobileui/utils/filter",
        "mobileui/utils/momentum",
        "mobileui/views/gesture-detector"], 
    function(GestureView, LayerView, Transform, Filter, Momentum, GestureDetector) {

    var CheckboxView = GestureView.extend({
        initialize: function() {
            CheckboxView.__super__.initialize.call(this);
            this.addGestureDetector();
            this.on("touchdragstart", this._onDragStart, this)
                .on("touchdragmove", this._onDragMove, this)
                .on("touchdragend", this._onDragEnd, this);
            this._momentum = new Momentum().setDuration(100).setFriction(0.000005);
            this._dragStartValue = 0;
            this.bounds().setSize(100, 30);
            this.forceLayer();
            this._needleView = new LayerView();
            this._needleView.forceLayer().ensureParams().matchParentHeight().setWidth(0.5);
            this.append(this._needleView.render().addClass("js-checkbox-needle-view"));
            this.on("tap", this._onTap, this);
            this.on("tapend", this._onTapEnd, this);
            this._checked = false;
        },

        setChecked: function(checked) {
            if (this._checked == checked)
                return this;
            this._checked = checked;
            this.invalidate("checked");
            this.trigger("change");
            return this;
        },

        checked: function() {
            return this._checked;
        },

        toggle: function() {
            this._checked = !this._checked;
            this.invalidate("checkedWithAnimation");
            this.trigger("change");
            return this;
        },

        layout: function() {
            CheckboxView.__super__.layout.call(this);
            this._validateChecked();
        },

        render: function() {
            CheckboxView.__super__.render.call(this);
            this.$el.addClass("js-checkbox-view");
            this._validateChecked();
            return this;
        },

        _needlePosition: function() {
            return this._checked ? this.bounds().width() / 2 : 0;
        },

        _needleFilterOpacity: function() {
            return this._checked ? 0 : 100;
        },

        _validateChecked: function() {
            this._needleView.transform().get("translate").setX(this._needlePosition());
            this._needleView.filter().get("grayscale").setIntensity(this._needleFilterOpacity());
        },

        _validateCheckedWithAnimation: function() {
            this._needleView.animation().start()
                .get("checkbox-transform").removeAll()
                .chain()
                .transform(100, new Transform().translate(this._needlePosition(), 0));
            this._needleView.animation()
                .get("checkbox-filter").removeAll()
                .chain()
                .filter(100, new Filter().grayscale(this._needleFilterOpacity()));
        },

        _onTap: function() {
            this.toggle();
        },

        _onDragStart: function() {
            var translate = this._needleView.transform().get("translate");
            this._dragStartValue = translate.x();
            this._momentum.reset(this._dragStartValue);
        },

        _updateDragPosition: function(value) {
            var position = Math.min(this.bounds().width() / 2, Math.max(0, value)),
                translate = this._needleView.transform().get("translate");
            translate.setX(position);
            this._needleView.filter().get("grayscale")
                .setIntensity(100 - position / this.bounds().width() * 200);
        },

        _onDragMove: function(transform) {
            var value = Math.max(0, this._dragStartValue + transform.dragX);
            this._updateDragPosition(value);
            this._momentum.injectValue(value);
        },

        _onDragEnd: function(transform) {
            this._onDragMove(transform);
            var value = this._momentum.compute(),
                direction = this._momentum.direction(),
                oneQuadWidth = this.bounds().width() / 4;
            if (!this._checked && ((value < oneQuadWidth) || (direction > 0)))
                return this._revert();
            if (this._checked && ((value > oneQuadWidth * 3) || (direction < 0)))
                return this._revert();
            this._commit();
        },

        _commit: function() {
            this.toggle();
        },

        _revert: function() {
            this._validateCheckedWithAnimation();
        },

        respondsToTouchGesture: function(gesture) {
            if (gesture.type != GestureDetector.GestureType.DRAG || !gesture.scrollX)
                return false;
            return (this._checked) ? gesture.distanceX > 0 : gesture.distanceX < 0;
        }
    });

    return CheckboxView;

});
define('mobileui/ui/app-checkbox-view',["mobileui/ui/checkbox-view",
        "mobileui/views/layout-view",
        "mobileui/views/content-view",
        "mobileui/views/layer-view",
        "mobileui/utils/transform"], 
    function(CheckboxView,
            LayoutView,
            ContentView,
            LayerView,
            Transform) {

    var AppCheckboxView = CheckboxView.extend({
        initialize: function() {
            AppCheckboxView.__super__.initialize.call(this);
            this.addClass("slide-switch-container");
            
            this._slideSwitch = new LayerView().addClass("dark-slide-switch");
            this._slideSwitch.matchParentSize();
            this.append(this._slideSwitch.render());

            this._onOffContainer = new LayoutView()
                .forceLayer()
                .addClass("js-checkbox-on-off-container")
                .setLayout("horizontal");
            this._onOffContainer.ensureParams().matchChildrenWidth().matchParentHeight();
            this._slideSwitch.append(this._onOffContainer.render());

            this._onLabel = new ContentView().addClass("js-checkbox-on-label").setTextContent("ON")
                .matchLineHeight();
            this._onLabel.ensureParams().matchWidthOf(this).matchParentHeight();
            this._onOffContainer.append(this._onLabel.render());

            this._offLabel = new ContentView().addClass("js-checkbox-off-label").setTextContent("OFF")
                .matchLineHeight();
            this._offLabel.ensureParams().matchWidthOf(this).matchParentHeight();
            this._onOffContainer.append(this._offLabel.render());

            this._slideSwitch.append(this._needleView.addClass("switch"));
        },

        render: function() {
            AppCheckboxView.__super__.render.call(this);
            this.$el.addClass("app-checkbox-view");
            return this;
        },

        layout: function() {
            var padding = this.bounds().width() / 2;
            this._onLabel.padding().setRight(padding);
            this._offLabel.padding().setLeft(padding);
            AppCheckboxView.__super__.layout.call(this);
        },

        _onOffContainerPosition: function() {
            return this._checked ? 0 : -this.bounds().width();
        },

        _validateChecked: function() {
            AppCheckboxView.__super__._validateChecked.call(this);
            this._onOffContainer.transform()
                .get("translate")
                .setX(this._onOffContainerPosition());
        },

        _validateCheckedWithAnimation: function() {
            AppCheckboxView.__super__._validateCheckedWithAnimation.call(this);
            this._onOffContainer.animation().start()
                .get("checkbox-transform").removeAll()
                .chain()
                .transform(100, new Transform().translate(this._onOffContainerPosition(), 0));
        },

        _updateDragPosition: function(value) {
            AppCheckboxView.__super__._updateDragPosition.call(this, value);
            var needlePosition = Math.min(this.bounds().width() / 2, Math.max(0, value)),
                position = needlePosition * 2 - this.bounds().width(),
                translate = this._onOffContainer.transform().get("translate");
            translate.setX(position);
        }
    });

    return AppCheckboxView;
});
/*
 * Copyright (c) 2013 Adobe Systems Incorporated. All rights reserved.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

define('mobileui/ui/settings-dialog-view',['mobileui/ui/dialog-view',
        'mobileui/views/layout-view',
        'mobileui/views/content-view',
        'mobileui/ui/app-checkbox-view',
        'mobileui/utils/settings'],
    function(DialogView, LayoutView, ContentView, AppCheckboxView, settings) {

    var SettingsDialogView = DialogView.extend({

        _addSettingsLine: function(label, valueName) {
            var boxView = new LayoutView()
                .addClass("js-setting-line-view")
                .setLayout("horizontal")
                .render();
            boxView.margin().setAll(13);
            boxView.ensureParams().matchParentWidth();
            boxView.bounds().setHeight(40);

            var labelView = new ContentView().setTextContent(label)
                .addClass("js-setting-line-label-view").render();
            labelView.content().addClass("js-setting-line-label-content-view");
            labelView.ensureParams().fillParentWidth().matchParentHeight();
            boxView.append(labelView);

            var checkboxView = new AppCheckboxView().setChecked(settings.getBoolean(valueName))
                    .addClass("js-setting-line-checbox-view").render();
            checkboxView.ensureParams().matchParentHeight();
            checkboxView.on("change", function() {
                settings.setBoolean(valueName, checkboxView.checked());
            });
            boxView.append(checkboxView);

            this.contentView().append(boxView);
        },

        render: function() {
            SettingsDialogView.__super__.render.call(this);
            this.$el.addClass("js-settings-dialog-view");
            return this;
        }

    });

    return SettingsDialogView;

});
/*
 * Copyright (c) 2013 Adobe Systems Incorporated. All rights reserved.
 * 
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 * 
 *     http://www.apache.org/licenses/LICENSE-2.0
 * 
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

define('mobileui/utils/cache',["mobileui/utils/boilerplate"], function(boilerplate) {

    var Cache = function() {
        this._cache = boilerplate.lookupPrefix(window, "applicationCache");
        if (!this._cache)
            return;
        this._cache.addEventListener("updateready", this._onCacheUpdateReady.bind(this));
    };

    _.extend(Cache.prototype, Backbone.Events, {
        _onCacheUpdateReady: function() {
            console.log("Cache: ", this._cache.status);
            if (this._cache.status != this._cache.UPDATEREADY) {
                console.log("No cache update.");
                return;
            }
            console.log("Update ready.");
            this.trigger("updateready");
        },

        swapCache: function() {
            console.log("Swapping cache.");
            this._cache.swapCache();
            console.log("Reloading app.");
            window.location.reload();
        },

        checkForUpdates: function() {
            if (!this._cache)
                return;
            try {
                this._cache.update();
            } catch (e) {
                // FIXME: Opera throws an INVALID_STATE_ERR.
            }
        }
    });

    return new Cache();

});
/*
 * Copyright (c) 2013 Adobe Systems Incorporated. All rights reserved.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

define('sample/views/app-settings-dialog-view',['mobileui/ui/settings-dialog-view',
        'mobileui/ui/button-view',
        'mobileui/utils/cache',
        'mobileui/utils/settings'],
    function(SettingsDialogView, ButtonView, cache, settings) {

    var AppSettingsDialogView = SettingsDialogView.extend({

        initialize: function() {
            AppSettingsDialogView.__super__.initialize.call(this);

            this._addSettingsLine("Preview touch events", "touch.preview");

            var contentView = this.contentView();
            this._updateButton = new ButtonView().setLabel("Check for updates")
                .on("tap", this._onUpdateButtonTap, this);
            this._updateButton.margin().setAll(10);
            this._updateButton.ensureParams().matchParentWidth();
            contentView.append(this._updateButton.render().addClass("dark-button"));

            this._refreshButton = new ButtonView().setLabel("Refresh")
                .on("tap", this._onRefreshButtonTap, this);
            this._refreshButton.margin().setAll(10);
            this._refreshButton.ensureParams().matchParentWidth();
            contentView.append(this._refreshButton.render().addClass("dark-button").addClass("dark-cta"));
        },

        _onUpdateButtonTap: function() {
            this.hide();
            cache.checkForUpdates();
        },

        _onRefreshButtonTap: function() {
            window.location.reload();
        }

    });

    return AppSettingsDialogView;

});
/*
 * Copyright (c) 2013 Adobe Systems Incorporated. All rights reserved.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

define('sample/views/app-navigator-view',['mobileui/ui/navigator-view',
        'mobileui/views/content-view',
        'mobileui/ui/button-view',
        'sample/views/app-settings-dialog-view',
        'mobileui/utils/settings',
        'mobileui/utils/lock',
        'sample/app'], function(NavigatorView, ContentView, ButtonView, AppSettingsDialogView, settings, lock, app) {

    var AppNavigatorView = NavigatorView.extend({

        initialize: function() {
            AppNavigatorView.__super__.initialize.call(this);
            this.topBarView().addClass("dark-header-bar");
            this.addTopBarButtons();

            this.on("card:precommit", this._updateBackButton, this);
            this.on("activate", this._updateBackButton, this);
        },

        render: function() {
            this.$el.addClass("js-app-navigator-view");
            this.contentView().addClass("js-app-navigator-content-view");
            return AppNavigatorView.__super__.render.call(this);
        },

        addTopBarButtons: function() {
            var topBar = this.topBarView();

            this._titleLabel = new ContentView()
                .setTextContent("MobileUI")
                .matchParentSize()
                .setIsPositioned(true)
                .matchLineHeight();
            topBar.append(this._titleLabel.render().addClass("js-navigator-top-bar-title-view"));

            this._backButton = new ButtonView().setLabel("Back")
                .on("tap", this._onBackButtonTap, this);
            this._backButton.margin().setLeft(5).setTop(5);
            topBar.append(this._backButton.render().addClass("dark-button"));

            this._homeButton = new ButtonView().setLabel("Home")
                .on("tap", this._onBackButtonTap, this);
            this._homeButton.margin().setLeft(5).setTop(5);
            topBar.append(this._homeButton.render().addClass("dark-button"));

            topBar.appendFiller();

            this._settingsButton = new ButtonView().setLabel("Settings")
                .on("tap", this._onSettingsButtonTap, this);
            this._settingsButton.margin().setRight(5).setTop(5);
            this._settingsButton.bounds().setWidth(80);
            topBar.append(this._settingsButton.render().addClass("dark-button"));
        },

        backButton: function() {
            return this._backButton;
        },

        homeButton: function() {
            return this._homeButton;
        },

        _updateBackButton: function() {
            if (this.canGoBack()) {
                this._backButton.show();
                this._homeButton.hide();
            } else {
                this._backButton.hide();
                if (this.activeCard() && this.activeCard().isDefaultScreen) {
                    this._homeButton.hide();
                } else {
                    this._homeButton.show();
                }
            }
        },

        _onBackButtonTap: function() {
            if (!lock.canStartTransition())
                return;
            if (!this.popCard())
                this.pushCard(app.router.lookupCard(app.defaultCard));
        },

        _onSettingsButtonTap: function() {
            if (this._settingsView)
                return;
            this._settingsView = new AppSettingsDialogView()
                .once("hide", this._onSettingsViewHidden, this)
                .render()
                .show(this);
        },

        _onSettingsViewHidden: function() {
            this._settingsView.remove();
            this._settingsView = null;
        }

    });

    return AppNavigatorView;

});
/*
 * Copyright (c) 2013 Adobe Systems Incorporated. All rights reserved.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

define('mobileui/ui/confirm-dialog-view',['mobileui/ui/dialog-view',
        'mobileui/views/layout-view',
        'mobileui/views/measured-view',
        'mobileui/ui/button-view',
        'mobileui/views/layout-params'],
    function(DialogView, LayoutView, MeasuredView, ButtonView, LayoutParams) {

    var ConfirmDialogView = DialogView.extend({

        initialize: function() {
            ConfirmDialogView.__super__.initialize.call(this);
            this._message = "Yes/No?";

            var contentView = this.contentView();

            this._labelView = new MeasuredView();
            this._labelView.margin().setAll(10);
            this._labelView.setParams(new LayoutParams().matchParentWidth());
            contentView.append(this._labelView.render());

            this._acceptButton = new ButtonView()
                .setLabel("Yes")
                .on("tap", this._onAcceptButtonTap, this)
                .addClass("dark-button").addClass("dark-cta");
            this._acceptButton.margin().setAll(10);
            this._acceptButton.ensureParams().matchParentWidth();
            contentView.append(this._acceptButton.render());

            this._refuseButton = new ButtonView()
                .setLabel("No")
                .on("tap", this._onRefuseButtonTap, this)
                .addClass("dark-button");
            this._refuseButton.margin().setAll(10);
            this._refuseButton.ensureParams().matchParentWidth();
            contentView.append(this._refuseButton.render());
        },

        setMessage: function(message) {
            if (this._message == message)
                return;
            this._message = message;
            this._labelView.setTextContent(message);
            return this;
        },

        render: function() {
            ConfirmDialogView.__super__.render.call(this);
            this.$el.addClass("js-confirm-dialog-view");
            return this;
        },

        _onAcceptButtonTap: function() {
            this.trigger("accept");
            this.hide();
        },

        _onRefuseButtonTap: function() {
            this.trigger("refuse");
            this.hide();
        }

    });

    return ConfirmDialogView;

});
/*
 * Copyright (c) 2013 Adobe Systems Incorporated. All rights reserved.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

define('sample/views/main-view',['sample/app',
        'mobileui/views/layer-view',
        'mobileui/ui/window-view',
        'mobileui/views/touch',
        'mobileui/utils/filter',
        'sample/views/app-navigator-view',
        'mobileui/ui/confirm-dialog-view',
        'mobileui/utils/cache',
        'mobileui/utils/filters/fold',
        'mobileui/utils/filters/warp',
        'mobileui/utils/settings'],
    function(app,
             LayerView,
             WindowView,
             Touch,
             Filter,
             AppNavigatorView,
             ConfirmDialogView,
             cache,
             fold,
             warp,
             settings)
    {

    var MainView = WindowView.extend({

        initialize: function() {
            MainView.__super__.initialize.call(this);
            this._navigatorView = new AppNavigatorView();
            this.append(this._navigatorView.render());
            this.listenTo(cache, 'updateready', this._onUpdateReady);
            this._updateConfirmView = null;
            this._exitConfirmView = null;
            if (Filter.supportsCustomFilters) {
                this._filterPool = new LayerView()
                    .setDisabled()
                    .setIsPositioned()
                    .setOpacity(0)
                    .forceLayer();
                this._filterPool.bounds().setY(10000);
                this._filterPool.filter().get("fold");
                this._filterPool.filter().get("warp");
                this.append(this._filterPool.render());
            }
            document.addEventListener("backbutton", this._handleBackButton.bind(this), true);
        },

        render: function() {
            MainView.__super__.render.call(this);
            this.$el.addClass("js-main-view");
            return this;
        },

        navigatorView: function() {
            return this._navigatorView;
        },

        contentView: function() {
            return this._navigatorView;
        },

        _onUpdateReady: function() {
            if (this._updateConfirmView)
                return;
            this._updateConfirmView = new ConfirmDialogView()
                .setMessage("New application version is available. Would you like to load the new version now?")
                .render()
                .once("hide", this._onUpdateConfirmViewHidden, this)
                .once("accept", this._onUpdateConfirmViewAccepted, this)
                .show();
        },

        _onUpdateConfirmViewHidden: function() {
            this._updateConfirmView.remove();
            this._updateConfirmView = null;
        },

        _onUpdateConfirmViewAccepted: function() {
            try {
                cache.swapCache();
            } catch(e) {
                // FIXME: We get an INVALID_STATE_ERR if we get here with no cache update.
            }
        },

        _handleBackButton: function() {
            if (!app.canStartTransition())
                return;
            if (!this.navigatorView().canGoBack()) {
                this._confirmExit();
                return;
            }
            this.navigatorView().popCard();
        },

        _confirmExit: function() {
            if (this._exitConfirmView)
                return;
            this._exitConfirmView = new ConfirmDialogView()
                .setMessage("Are you sure you want to quit?")
                .render()
                .once("hide", this._onExitConfirmViewHidden, this)
                .once("accept", this._onExitConfirmViewAccepted, this)
                .show();
        },

        _onExitConfirmViewHidden: function() {
            this._exitConfirmView.remove();
            this._exitConfirmView = null;
        },

        _onExitConfirmViewAccepted: function() {
            window.navigator.app.exitApp();
        }
    });

    app.on("init", function() {
        settings.on("change:touch.preview", function() {
            Touch.preview = settings.getBoolean("touch.preview");
        });
        app.mainView = new MainView({
            el: $("#main").get(0)
        }).render();
    });

    return MainView;

});

/*
 * Copyright (c) 2013 Adobe Systems Incorporated. All rights reserved.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

define('views/demo-view',["mobileui/views/layer-view",
        "sample/app",
        "sample/router",
        "sample/views/main-view"], function(LayerView, sampleApp, sampleRouter, MainView) {

    var DemoView = LayerView.extend({
        initialize: function() {
            DemoView.__super__.initialize.call(this);
            this.addClass("js-demo-view");
            sampleApp.noUrlChanges = true;
            sampleApp.mainView = this._mainView = new MainView().matchParentSize();
            this.append(this._mainView.render());
            sampleRouter.defaultHandler();
        }
    });

    return DemoView;
});
/*
 * Copyright (c) 2013 Adobe Systems Incorporated. All rights reserved.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

define('views/touch-hold-view',["mobileui/views/gesture-view",
        "mobileui/views/content-view",
        "mobileui/utils/bus"],
    function(GestureView, ContentView, bus) {

    var TouchHoldView = GestureView.extend({
        initialize: function() {
            TouchHoldView.__super__.initialize.call(this);
            this.addClass("js-touch-hold-view");

            this._contentView = null;

            this.on("tapstart", this._onTapStart, this);
            this.on("tapend", this._onTapEnd, this);
            this.on("tap", this._onTap, this);
            this.on("longtaptimer", this._onLongTap, this);
            
            this._state = "up";
            this._prevState = null;

            this._tapCount = 0;
            this._longTapCount = 0;

            this._validateState();
        },

        setContentView: function(view) {
            this._contentView = view;
            this.invalidate("state");
            return this;
        },

        _validateLabel: function() {
            if (this._contentView)
                this._contentView.$el.html(this._computeLabel());
        },

        _computeLabel: function() {
            var result = $("<div />");
            if (this._tapCount)
                result.append($("<div />").text("Taps: " + this._tapCount));
            if (this._longTapCount)
                result.append($("<div />").text("Long taps: " + this._longTapCount));
            console.log(result.get(0));
            return result;
        },

        _validateState: function() {
            if (this._prevState)
                this.$el.removeClass("js-touch-hold-view-" + this._prevState);
            this.$el.addClass("js-touch-hold-view-" + this._state);
            this._prevState = this._state;
        },

        _onTapStart: function() {
            this._state = "down";
            this.invalidate("state");
        },

        _onTapEnd: function() {
            this._state = "up";
            this.invalidate("state");
        },

        _onTap: function() {
            ++this._tapCount;
            this.invalidate("label");
        },

        _onLongTap: function() {
            ++this._longTapCount;
            this.invalidate("label");
        }
    });

    return TouchHoldView;

});
/*
 * Copyright (c) 2013 Adobe Systems Incorporated. All rights reserved.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

define('mobileui/views/pan-view',["mobileui/views/gesture-view",
        "mobileui/utils/transform",
        "mobileui/views/gesture-detector"], 
    function(GestureView, Transform, GestureDetector) {

    var PanView = GestureView.extend({
        initialize: function() {
            PanView.__super__.initialize.call(this);
            this._shouldRestoreTransform = true;
            this.forceLayer();

            this.on("touchdragstart", this._onPanViewTouchDragStart, this);
            this.on("touchdragend", this._onPanViewTouchDragEnd, this);
            this.on("touchdragmove", this._onPanViewDragMove, this);

            this._startTransform = null;
        },

        render: function() {
            this.$el.addClass("js-pan-view");
            return PanView.__super__.render.call(this);
        },

        _restoreTransform: function(el) {
            this.trigger("transformend");
            if (this._shouldRestoreTransform)
                this.resetTransform();
        },

        setShouldRestoreTransform: function(value) {
            this._shouldRestoreTransform = value;
            if (value && !this._startTransform)
                this.resetTransform();
            return this;
        },

        resetTransform: function() {
            this.animation().start().get("transform").chain()
                .transform(500, new Transform());
        },

        _onPanViewTouchDragStart: function() {
            this.animation().removeAll();
            this._startTransform = this.transform().toMatrix3d();
        },

        _onPanViewDragMove: function(transform) {
            this.transform().clear()
                .translate(transform.dragX, transform.dragY)
                .append(this._startTransform);
        },

        _onPanViewTouchDragEnd: function() {
            this._restoreTransform();
        },

        respondsToTouchGesture: function(gesture) {
            if (this.disabled())
                return false;
            return (gesture.type == GestureDetector.GestureType.DRAG);
        }

    });

    return PanView;
});
/*
 * Copyright (c) 2013 Adobe Systems Incorporated. All rights reserved.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

define('mobileui/views/transform-view',["mobileui/views/gesture-view",
        "mobileui/utils/transform",
        "mobileui/views/gesture-detector"], 
    function(GestureView, Transform, GestureDetector) {

    var TransformView = GestureView.extend({
        initialize: function() {
            TransformView.__super__.initialize.call(this);

            this._shouldRestoreTransform = true;

            this.forceLayer();

            this.on("touchtransformstart", this._onTransformViewTouchTransformStart, this);
            this.on("touchtransformend", this._onTransformViewTouchTransformEnd, this);
            this.on("touchtransform", this._onTouchTransformMove, this);

            this._startTransform = null;
        },

        render: function() {
            this.$el.addClass("js-transform-view");
            return TransformView.__super__.render.call(this);
        },

        _restoreTransform: function(el) {
            this.trigger("transformend");
            if (this._shouldRestoreTransform)
                this.resetTransform();
        },

        setShouldRestoreTransform: function(value) {
            this._shouldRestoreTransform = value;
            if (value && !this._startTransform)
                this.resetTransform();
            return this;
        },

        resetTransform: function() {
            this.animation().start().get("transform").chain()
                .transform(500, new Transform());
        },

        _onTransformViewTouchTransformStart: function() {
            this.animation().removeAll();
            this._startTransform = this.transform().toMatrix3d();
        },

        _onTouchTransformMove: function(transform) {
            console.log(transform);
            this.transform().clear()
                .translate(transform.dragX, transform.dragY)
                .append(this._startTransform)
                .translate(transform.originX, transform.originY)
                .rotate(transform.rotation)
                .scale(transform.scale, transform.scale)
                .translate(-transform.originX, -transform.originY);
            console.log(this.transform().toString());
        },

        _onTransformViewTouchTransformEnd: function() {
            this._restoreTransform();
        },

        respondsToTouchGesture: function(gesture) {
            if (this.disabled())
                return false;
            return (gesture.type == GestureDetector.GestureType.TRANSFORM);
        }

    });

    return TransformView;
});
/*
 * Copyright (c) 2013 Adobe Systems Incorporated. All rights reserved.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

define('views/slide-container-view',["mobileui/views/layer-view",
        "mobileui/views/content-view",
        "mobileui/utils/view-injector",
        "mobileui/utils/rect",
        "mobileui/utils/bus",
        // Add all the dynamic components in here, so that the r.js optimizer
        // preloads them in the generated output.
        "mobileui/ui/link-view",
        "views/demo-view",
        "views/touch-hold-view",
        "mobileui/views/pan-view",
        "mobileui/views/transform-view"],
    function(LayerView, ContentView, ViewInjector, Rect, bus) {

    var defaultSlideRect = new Rect().setSize(1024, 768);

    var SlideContainerView = LayerView.extend({
        initialize: function() {
            SlideContainerView.__super__.initialize.call(this);
            this._slideBounds = new Rect()
                .set(defaultSlideRect)
                .on("change:size", this._onSlideBoundsChanged, this);

            this._contentView = new LayerView()
                .addClass("js-slide-container-content-view");
            if (this.constructor.label) {
                this.addClass("js-slide-container-" + this.constructor.label);
                this._contentView.addClass("js-slide-" + this.constructor.label);
            }
            this._contentView.bounds().set(this._slideBounds);
            this.append(this._contentView.render());

            var self = this;
            this._contentView.$el.html(this._template);
            var viewInjector = new ViewInjector();
            viewInjector.convert(this, this._contentView).then(function() {
                self.trigger("views:injected");
            });

            this._slideNumber = new ContentView()
                .setIsStaticView(true)
                .setTextContent(this.constructor.index + 1)
                .addClass("js-slide-number");
            this._contentView.append(this._slideNumber.render());
        },

        _onSlideBoundsChanged: function() {
            this.validate("slideBounds");
        },

        slideBounds: function() {
            return this._slideBounds;
        },

        _onViewsInjected: function() {
            console.log("Loaded injected views!");
        },

        render: function() {
            this.$el.addClass("js-slide-container-view");
            return SlideContainerView.__super__.render.call(this);
        },

        layout: function() {
            SlideContainerView.__super__.layout.call(this);
            this._validateSlideBounds();
        },

        _validateSlideBounds: function() {
            var factorX = this.bounds().width() / this._slideBounds.width(),
                factorY = this.bounds().height() / this._slideBounds.height(),
                scaleFactor = Math.min(factorX, factorY);
            this._contentView.transform().get("translate")
                .setX((this.bounds().width() - this._slideBounds.width() * scaleFactor) / 2)
                .setY((this.bounds().height() - this._slideBounds.height() * scaleFactor) / 2);
            this._contentView.transform().get("scale")
                .setX(scaleFactor)
                .setY(scaleFactor);
        }
    });

    return SlideContainerView;

});
/*
 * Copyright (c) 2013 Adobe Systems Incorporated. All rights reserved.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

define('views/slide-view',["mobileui/ui/app-card-view",
        "mobileui/ui/touch-item-view",
        "mobileui/utils/bus",
        // Make sure that the container view is preloaded by the optimizer.
        "views/slide-container-view"],
    function(AppCardView, TouchItemView, bus) {

    var needsTopBar = false;

    var SlideItemView = TouchItemView.extend({
        initialize: function(slideView) {
            SlideItemView.__super__.initialize.call(this, slideView);
            this.setVerticalLayout().matchParentSize();
        },

        render: function() {
            this.$el.addClass("js-slide-item-view");
            return SlideItemView.__super__.render.call(this);
        },

        _onTapStart: function() {
            this.listView().prepareNextCard();
        },

        _onTap: function(touch) {
            this.listView().trigger("tap", touch);
        }
    });

    var SlideView = AppCardView.extend({
        initialize: function() {
            SlideView.__super__.initialize.call(this);

            this._contentView = new SlideItemView().setListView(this);
            this.append(this._contentView.render());

            this.on("ready", this._onSlideViewReady, this);
            this.on("deactivate", this._onDeactivate, this);
            this.on("tap", this._onTap, this);
            this.on("keydown", this._onKeyDown, this);

            this._slideContentView = null;
        },

        setSlideContentView: function(slideContentView) {
            if (this._slideContentView) {
                this._slideContentView.remove();
                this._slideContentView = null;
            }
            if (slideContentView) {
                this._slideContentView = slideContentView;
                slideContentView.matchParentSize();
                this._contentView.filterView().append(slideContentView);
            }
            return this;
        },

        slideContentView: function() {
            return this._slideContentView;
        },

        _onSlideViewReady: function() {
            // Make sure we have slides on the left and right ready for next frame.
            // Trigger the cache system to create the following view.
            if (this.hasNextCard())
                SlideView.precache(this.nextSlide());
        },

        _onDeactivate: function() {
            this._contentView.resetAnimations();
        },

        needsTopBar: function() {
            return needsTopBar;
        },

        hasLayoutMarginFromTopBar: function() {
            return false;
        },

        prepareNextCard: function() {
            if (this.navigatorView().nextCard())
                return;
            var nextCard = this.nextCard();
            if (nextCard)
                this.navigatorView().prepareNextCard(nextCard);
        },

        hasNextCard: function() {
            return this._slideContentView ? bus.get("slideManager").hasNextSlide(this._slideContentView) : false;
        },

        nextSlide: function() {
            return this._slideContentView ? bus.get("slideManager").lookupNextSlide(this._slideContentView) : null;
        },

        nextCard: function() {
            return SlideView.encapsulateSlide(this.nextSlide());
        },

        hasPreviousCard: function() {
            return this._slideContentView ? bus.get("slideManager").hasPreviousSlide(this._slideContentView) : false;
        },

        previousSlide: function() {
            return this._slideContentView ? bus.get("slideManager").lookupPreviousSlide(this._slideContentView) : null;
        },

        previousCard: function() {
            return SlideView.encapsulateSlide(this.previousSlide());
        },

        _onTap: function() {
            needsTopBar = !needsTopBar;
            this._updateNavigationBar();
        },

        render: function() {
            this.$el.addClass("js-slide-view");
            return SlideView.__super__.render.call(this);
        },

        url: function() {
            return this._slideContentView ? "slide/" + encodeURIComponent(this._slideContentView.constructor.label) : null;
        },

        updateRouterLocation: function() {
            var url = this.url();
            if (!url)
                return;
            bus.get("router").navigate(url, { trigger: false });
        },

        slideConstructor: function() {
            return this._slideContentView.constructor;
        },

        detach: function() {
            SlideView.recoverSlideView(this);
            return this;
        },

        remove: function() {
            // Push the slide view back in a list, so that we could reuse it
            // if user just navigates around.
            SlideView.recoverSlideView(this);
            return this;
        },

        _hideTopBar: function() {
            if (!needsTopBar)
                return;
            needsTopBar = false;
            this._updateNavigationBar();
        },

        _onKeyDown: function() {
            switch (event.keyCode) {
                case 27: // escape
                    return this._hideTopBar();
            }
        }
    }, {
        _cachedSlides: [],
        _maxCachedSlides: 4,

        encapsulateSlide: function(slide) {
            var slideView = this.lookupCachedSlide(slide);
            return slideView ? slideView : (slide ? this.createSlideView(slide) : null);
        },

        precache: function(slide) {
            var cachedSlideView = _.find(this._cachedSlides, function(slideView) {
                return slideView.slideConstructor() === slide;
            });
            if (cachedSlideView)
                return cachedSlideView;
            this.recoverSlideView(this.createSlideView(slide));
        },

        createSlideView: function(slide) {
            var slideItem = bus.get("slideManager").createSlide(slide);
            return new SlideView().setSlideContentView(slideItem).render();
        },

        lookupCachedSlide: function(slide) {
            var cachedSlideView = _.find(this._cachedSlides, function(slideView) {
                return slideView.slideConstructor() === slide;
            });
            if (cachedSlideView) {
                var index = _.indexOf(this._cachedSlides, cachedSlideView);
                this._cachedSlides.splice(index, 1);
                cachedSlideView.setVisible(true)
                    .setOpacity(1)
                    .transform().clear();
            }
            return cachedSlideView;
        },

        recoverSlideView: function(slideView) {
            var index = _.indexOf(this._cachedSlides, slideView);
            if (index != -1)
                return;
            this._cachedSlides.unshift(slideView.setOpacity(0).setVisible(false));
            if (this._cachedSlides.length > this._maxCachedSlides) {
                for (var i = this._maxCachedSlides; i < this._cachedSlides.length; ++i)
                    SlideView.__super__.remove.call(this._cachedSlides[i]);
                this._cachedSlides.splice(this._maxCachedSlides, this._cachedSlides.length - this._maxCachedSlides);
            }
        }
    });

    return SlideView;

});
/*
 * Copyright (c) 2013 Adobe Systems Incorporated. All rights reserved.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

define('router',["mobileui/utils/bus", "utils/slide-manager", "views/slide-view"],
    function(bus, slideManager, SlideView) {

    var Router = Backbone.Router.extend({
        routes: {
            "slide/*path/*options": "slide",
            "slide/*path": "slide",
            "*path": "defaultHandler"
        },

        defaultHandler: function() {
            var slide = slideManager.lookupSlide("index");
            return slide ? this._injectSlide(slide) : null;
        },

        slide: function(path, pathOptions) {
            var slide = slideManager.lookupSlide(decodeURIComponent(path), pathOptions);
            return slide ? this._injectSlide(slide) : this.defaultHandler();
        },

        _injectSlide: function(slide) {
            var slideView = SlideView.encapsulateSlide(slide);
            bus.get("mainView").navigatorView().resetCard(slideView);
            return slideView;
        }
    });

    var router = new Router();
    bus.set("router", router);

    bus.on("start", function() {
        Backbone.history.start({});
    });

    return router;
});
/*
 * Copyright (c) 2013 Adobe Systems Incorporated. All rights reserved.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

define('views/app-settings-dialog-view',['mobileui/ui/settings-dialog-view',
        'mobileui/ui/button-view',
        'mobileui/utils/cache',
        'mobileui/utils/settings'],
    function(SettingsDialogView, ButtonView, cache, settings) {

    var AppSettingsDialogView = SettingsDialogView.extend({

        initialize: function() {
            AppSettingsDialogView.__super__.initialize.call(this);

            this._addSettingsLine("Preview touch events", "touch.preview");

            var contentView = this.contentView();
            this._updateButton = new ButtonView().setLabel("Check for updates")
                .on("tap", this._onUpdateButtonTap, this);
            this._updateButton.margin().setAll(10);
            this._updateButton.ensureParams().matchParentWidth();
            contentView.append(this._updateButton.render().addClass("dark-button"));

            this._refreshButton = new ButtonView().setLabel("Refresh")
                .on("tap", this._onRefreshButtonTap, this);
            this._refreshButton.margin().setAll(10);
            this._refreshButton.ensureParams().matchParentWidth();
            contentView.append(this._refreshButton.render().addClass("dark-button").addClass("dark-cta"));
        },

        _onUpdateButtonTap: function() {
            this.hide();
            cache.checkForUpdates();
        },

        _onRefreshButtonTap: function() {
            window.location.reload();
        }

    });

    return AppSettingsDialogView;

});
/*
 * Copyright (c) 2013 Adobe Systems Incorporated. All rights reserved.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

define('views/slide-list-view',["mobileui/views/scroll-view",
        "mobileui/views/layout-view",
        "mobileui/views/layer-view",
        "mobileui/ui/button-view",
        "slides/list"], 
    function(ScrollView, LayoutView, LayerView, ButtonView, SlidesList) {

    var SlideListView = ScrollView.extend({

        initialize: function() {
            SlideListView.__super__.initialize.call(this);
            this.setScrollDirection("horizontal");
            this.matchParentSize();

            var contentView = new LayoutView().setLayout("horizontal");
            contentView.ensureParams().matchChildrenWidth().matchParentHeight();
            this.setContentView(contentView.render());

            var self = this,
                workItems = this._workItems = [];
            _.each(SlidesList, function(SlideView) {
                self._createListItem(SlideView);
            });
        },

        _createListItem: function(SlideView) {
            var contentView = this.contentView();

            var itemView = new LayerView()
                .forceLayer()
                .addClass("js-slide-list-item-view");
            itemView.margin().setAll(15);
            itemView.ensureParams().matchParentHeight();
            itemView.bounds().setWidth(200);
            contentView.append(itemView.render());

            var slide = new SlideView().matchParentSize();
            itemView.append(slide.render());
            
            var tapView = new ButtonView()
                .addClass("js-slide-list-button-view");
            tapView.matchParentSize()
                   .on("tap", this._onSlideSelected.bind(this, SlideView));
            itemView.append(tapView.render());

            contentView.append(itemView.render());
        },

        _onSlideSelected: function(SlideView) {
            this.trigger("slide:selected", SlideView);
        }
    });

    return SlideListView;

});
/*
 * Copyright (c) 2013 Adobe Systems Incorporated. All rights reserved.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

define('views/slide-list-dialog-view',["mobileui/ui/dialog-view",
        "views/slide-list-view"], 
    function(DialogView, SlideListView) {

    var SlideListDialogView = DialogView.extend({

        initialize: function() {
            SlideListDialogView.__super__.initialize.call(this);
            this.contentView().bounds().setHeight(200);
            this._listView = new SlideListView();
            this._listView.on("slide:selected", this._onSlideSelected, this);
            this.contentView().append(this._listView.render());
        },

        render: function() {
            SlideListDialogView.__super__.render.call(this);
            this.$el.addClass("js-slide-list-dialog-view");
            return this;
        },

        _onSlideSelected: function(SlideView) {
            this.trigger("slide:selected", SlideView);
        }
    });

    return SlideListDialogView;
});
/*
 * Copyright (c) 2013 Adobe Systems Incorporated. All rights reserved.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

define('views/app-navigator-view',['mobileui/ui/navigator-view',
        'mobileui/views/content-view',
        'mobileui/views/layer-view',
        'mobileui/ui/button-view',
        'views/app-settings-dialog-view',
        'views/slide-list-dialog-view',
        'views/slide-view',
        'mobileui/utils/settings',
        'mobileui/utils/lock',
        'mobileui/utils/bus'], function(NavigatorView, ContentView, LayerView, ButtonView, AppSettingsDialogView, SlideListDialogView, SlideView, settings, lock, bus) {

    var LogoView = LayerView.extend({
        layout: function() {
            LogoView.__super__.layout.call(this);
            var parent = this.parent();
            this.bounds()
                .setWidth(parent.bounds().width() / 20)
                .setX(parent.bounds().width() - this.bounds().width() - this.margin().right())
                .setY(parent.bounds().height());
        }
    });

    var AppNavigatorView = NavigatorView.extend({

        initialize: function() {
            AppNavigatorView.__super__.initialize.call(this);
            this.setUsesHistory(false);
            this.topBarView().addClass("dark-header-bar");
            this.addTopBarButtons();

            this.on("card:precommit", this._updateNavigationButtons, this);
            this.on("activate", this._updateNavigationButtons, this);

            this.on("keydown", this._onKeyDown, this);
        },

        render: function() {
            this.$el.addClass("js-app-navigator-view");
            this.contentView().addClass("js-app-navigator-content-view");
            return AppNavigatorView.__super__.render.call(this);
        },

        addTopBarButtons: function() {
            var topBar = this.topBarView();

            this._titleLabel = new ContentView()
                .setTextContent("CSS Performance Presentation")
                .matchParentSize()
                .setIsPositioned(true)
                .matchLineHeight();
            topBar.append(this._titleLabel.render().addClass("js-navigator-top-bar-title-view"));

            this._backButton = new ButtonView().setLabel("<")
                .on("tap", this._onBackButtonTap, this);
            this._backButton.margin().setLeft(5).setTop(5);
            topBar.append(this._backButton.render().addClass("dark-button"));

            this._nextButton = new ButtonView().setLabel(">")
                .on("tap", this._onNextButtonTap, this);
            this._nextButton.margin().setLeft(5).setTop(5);
            topBar.append(this._nextButton.render().addClass("dark-button"));

            topBar.appendFiller();

            this._slidesButton = new ButtonView().setLabel("Slides")
                .on("tap", this._onSlidesButtonTap, this);
            this._slidesButton.margin().setRight(5).setTop(5);
            this._slidesButton.bounds().setWidth(80);
            topBar.append(this._slidesButton.render().addClass("dark-button"));

            this._settingsButton = new ButtonView().setLabel("Settings")
                .on("tap", this._onSettingsButtonTap, this);
            this._settingsButton.margin().setRight(5).setTop(5);
            this._settingsButton.bounds().setWidth(80);
            topBar.append(this._settingsButton.render().addClass("dark-button"));

            this._logoView = new LogoView().forceLayer()
                .setIsPositioned(true)
                .addClass("js-logo-view");
            this._logoView.bounds().setSize(50, 85);
            this._logoView.margin().setRight(35);
            topBar.append(this._logoView.render());
        },

        backButton: function() {
            return this._backButton;
        },

        nextButton: function() {
            return this._nextButton;
        },

        _updateNavigationButtons: function() {
            this._backButton.setVisible(this.canGoBack());
            this._nextButton.setVisible(this.canGoForward());
        },

        _onBackButtonTap: function() {
            if (!lock.canStartTransition() || !this.canGoBack())
                return;
            if (!this.popCard())
                bus.get("router").defaultHandler();
        },

        _onNextButtonTap: function() {
            if (!lock.canStartTransition() || !this.canGoForward())
                return;
            this.pushCard();
        },

        _onSettingsButtonTap: function() {
            if (this._settingsView)
                return;
            this._settingsView = new AppSettingsDialogView()
                .once("hide", this._onSettingsViewHidden, this)
                .render()
                .show(this);
        },

        _onSettingsViewHidden: function() {
            this._settingsView.remove();
            this._settingsView = null;
        },

        _onSlidesButtonTap: function() {
            if (this._slidesView && this._slidesView.isActive())
                return;
            if (!this._slidesView) {
                this._slidesView = new SlideListDialogView()
                    .on("slide:selected", this._onSlideSelected, this)
                    .render();
            }
            this._slidesView.show(this);
        },

        _onSlideSelected: function(SlideConstructor) {
            this.pushCard(SlideView.encapsulateSlide(SlideConstructor));
        },

        _onKeyDown: function() {
            switch (event.keyCode) {
                case 37: // prev
                    return this._onBackButtonTap();
                case 32: // space
                case 39: // next
                    return this._onNextButtonTap();
            }
        }

    });

    return AppNavigatorView;

});
/*
 * Copyright (c) 2013 Adobe Systems Incorporated. All rights reserved.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

define('views/main-view',['mobileui/utils/bus',
        'mobileui/utils/lock',
        'mobileui/views/layer-view',
        'mobileui/ui/window-view',
        'mobileui/views/touch',
        'mobileui/utils/filter',
        'views/app-navigator-view',
        'mobileui/ui/confirm-dialog-view',
        'mobileui/utils/cache',
        'mobileui/utils/filters/fold',
        'mobileui/utils/filters/warp',
        'mobileui/utils/settings'],
    function(bus,
             lock,
             LayerView,
             WindowView,
             Touch,
             Filter,
             AppNavigatorView,
             ConfirmDialogView,
             cache,
             fold,
             warp,
             settings)
    {

    var MainView = WindowView.extend({

        initialize: function() {
            MainView.__super__.initialize.call(this);
            this._navigatorView = new AppNavigatorView();
            this.append(this._navigatorView.render());
            this.listenTo(cache, 'updateready', this._onUpdateReady);
            this._updateConfirmView = null;
            this._exitConfirmView = null;
            if (Filter.supportsCustomFilters) {
                this._filterPool = new LayerView()
                    .setDisabled()
                    .setIsPositioned()
                    .setOpacity(0)
                    .forceLayer();
                this._filterPool.bounds().setY(10000);
                this._filterPool.filter().get("fold");
                this._filterPool.filter().get("warp");
                this.append(this._filterPool.render());
            }
            document.addEventListener("backbutton", this._handleBackButton.bind(this), true);
        },

        render: function() {
            MainView.__super__.render.call(this);
            this.$el.addClass("js-main-view");
            return this;
        },

        navigatorView: function() {
            return this._navigatorView;
        },

        contentView: function() {
            return this._navigatorView;
        },

        _onUpdateReady: function() {
            if (this._updateConfirmView)
                return;
            this._updateConfirmView = new ConfirmDialogView()
                .setMessage("New application version is available. Would you like to load the new version now?")
                .render()
                .once("hide", this._onUpdateConfirmViewHidden, this)
                .once("accept", this._onUpdateConfirmViewAccepted, this)
                .show(this);
        },

        _onUpdateConfirmViewHidden: function() {
            this._updateConfirmView.remove();
            this._updateConfirmView = null;
        },

        _onUpdateConfirmViewAccepted: function() {
            try {
                cache.swapCache();
            } catch(e) {
                // FIXME: We get an INVALID_STATE_ERR if we get here with no cache update.
            }
        },

        _handleBackButton: function() {
            if (!lock.canStartTransition())
                return;
            if (!this.navigatorView().canGoBack()) {
                this._confirmExit();
                return;
            }
            this.navigatorView().popCard();
        },

        _confirmExit: function() {
            if (this._exitConfirmView)
                return;
            this._exitConfirmView = new ConfirmDialogView()
                .setMessage("Are you sure you want to quit?")
                .render()
                .once("hide", this._onExitConfirmViewHidden, this)
                .once("accept", this._onExitConfirmViewAccepted, this)
                .show(this);
        },

        _onExitConfirmViewHidden: function() {
            this._exitConfirmView.remove();
            this._exitConfirmView = null;
        },

        _onExitConfirmViewAccepted: function() {
            window.navigator.app.exitApp();
        }
    });

    bus.on("init", function() {
        settings.on("change:touch.preview", function() {
            Touch.preview = settings.getBoolean("touch.preview");
        });
        bus.set("mainView", new MainView({
            el: $("#main").get(0)
        }).render());
    });

    return MainView;

});

/*
 * Copyright (c) 2013 Adobe Systems Incorporated. All rights reserved.
 * 
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 * 
 *     http://www.apache.org/licenses/LICENSE-2.0
 * 
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/* Module based on requirejs.text to provide ahead of time base64 encoding. */
define('mobileui/utils/style-module',['mobileui/utils/underscore', 'mobileui/utils/text-module'], function (_, text) {

    var global = (function(){ return this; })();

    var StyleModule = _.extend({}, text, {
        modulePath: "mobileui/utils/style-module",

        injectStyle: function(content, moduleName, parsedName) {
            // If jquery is not available just return the content as is,
            // it means we are running under node in the r.js optimizer.
            if (global.StyleFix)
                content = global.StyleFix.fix(content);
            var style = parsedName ? parsedName.styleTag : this._createStyleTag(moduleName);
            style.removeAttr("data-preloading").html(content);
            return style;
        },

        _createStyleTag: function(moduleName) {
            return $("<style />")
                .attr("data-href", moduleName)
                .attr("data-noprefix", "") // Prevents prefix free runs.
                .attr("data-preloading", "")
                .appendTo($("head"));
        },

        onLoadStarted: function(moduleName, parsedName) {
            if (!global.navigator)
                return;
            // Add a placeholder style element until the real file is loaded
            // to make sure that the load always happens in the same order.
            parsedName.styleTag = this._createStyleTag(moduleName);
        },

        encodeContent: function(content, moduleName, parsedName) {
            return global.navigator ? this.injectStyle(content, moduleName, parsedName) : content;
        },

        createModuleAsync: function(content, moduleName, parsedName, callback) {
            var self = this;
            this.encodeContentAsync(content, moduleName, parsedName, function(encodedContent) {
                var code = "define(" + JSON.stringify([self.modulePath]) + ", " +
                "function(StyleModule) { return StyleModule.injectStyle(" +
                           JSON.stringify(encodedContent) + ", " + 
                           JSON.stringify(moduleName) +
                           "); });\n";
                callback(code);
            });
        }

    });

    return StyleModule;

});

define('mobileui/utils/less-module',{load: function(id){throw new Error("Dynamic load not allowed: " + id);}});
define('mobileui/utils/less-module!../../style/topcoat/normalize.css?rootpath=../../style/topcoat/',["mobileui/utils/style-module"], function(StyleModule) { return StyleModule.injectStyle("/*! normalize.css v2.0.1 | MIT License | git.io/normalize */\n/* ==========================================================================\n   HTML5 display definitions\n   ========================================================================== */\n/*\n * Corrects `block` display not defined in IE 8/9.\n */\narticle,\naside,\ndetails,\nfigcaption,\nfigure,\nfooter,\nheader,\nhgroup,\nnav,\nsection,\nsummary {\n  display: block;\n}\n/*\n * Corrects `inline-block` display not defined in IE 8/9.\n */\naudio,\ncanvas,\nvideo {\n  display: inline-block;\n}\n/*\n * Prevents modern browsers from displaying `audio` without controls.\n * Remove excess height in iOS 5 devices.\n */\naudio:not([controls]) {\n  display: none;\n  height: 0;\n}\n/*\n * Addresses styling for `hidden` attribute not present in IE 8/9.\n */\n[hidden] {\n  display: none;\n}\n/* ==========================================================================\n   Base\n   ========================================================================== */\n/*\n * 1. Sets default font family to sans-serif.\n * 2. Prevents iOS text size adjust after orientation change, without disabling\n *    user zoom.\n */\nhtml {\n  font-family: sans-serif;\n  /* 1 */\n\n  -webkit-text-size-adjust: 100%;\n  -ms-text-size-adjust: 100%;\n  /* 2 */\n\n}\n/*\n * Removes default margin.\n */\nbody {\n  margin: 0;\n}\n/* ==========================================================================\n   Links\n   ========================================================================== */\n/*\n * Addresses `outline` inconsistency between Chrome and other browsers.\n */\na:focus {\n  outline: thin dotted;\n}\n/*\n * Improves readability when focused and also mouse hovered in all browsers.\n */\na:active,\na:hover {\n  outline: 0;\n}\n/* ==========================================================================\n   Typography\n   ========================================================================== */\n/*\n * Addresses `h1` font sizes within `section` and `article` in Firefox 4+,\n * Safari 5, and Chrome.\n */\nh1 {\n  font-size: 2em;\n}\n/*\n * Addresses styling not present in IE 8/9, Safari 5, and Chrome.\n */\nabbr[title] {\n  border-bottom: 1px dotted;\n}\n/*\n * Addresses style set to `bolder` in Firefox 4+, Safari 5, and Chrome.\n */\nb,\nstrong {\n  font-weight: bold;\n}\n/*\n * Addresses styling not present in Safari 5 and Chrome.\n */\ndfn {\n  font-style: italic;\n}\n/*\n * Addresses styling not present in IE 8/9.\n */\nmark {\n  background: #ff0;\n  color: #000;\n}\n/*\n * Corrects font family set oddly in Safari 5 and Chrome.\n */\ncode,\nkbd,\npre,\nsamp {\n  font-family: monospace, serif;\n  font-size: 1em;\n}\n/*\n * Improves readability of pre-formatted text in all browsers.\n */\npre {\n  white-space: pre;\n  white-space: pre-wrap;\n  word-wrap: break-word;\n}\n/*\n * Sets consistent quote types.\n */\nq {\n  quotes: \"\\201C\" \"\\201D\" \"\\2018\" \"\\2019\";\n}\n/*\n * Addresses inconsistent and variable font size in all browsers.\n */\nsmall {\n  font-size: 80%;\n}\n/*\n * Prevents `sub` and `sup` affecting `line-height` in all browsers.\n */\nsub,\nsup {\n  font-size: 75%;\n  line-height: 0;\n  position: relative;\n  vertical-align: baseline;\n}\nsup {\n  top: -0.5em;\n}\nsub {\n  bottom: -0.25em;\n}\n/* ==========================================================================\n   Embedded content\n   ========================================================================== */\n/*\n * Removes border when inside `a` element in IE 8/9.\n */\nimg {\n  border: 0;\n}\n/*\n * Corrects overflow displayed oddly in IE 9.\n */\nsvg:not(:root) {\n  overflow: hidden;\n}\n/* ==========================================================================\n   Figures\n   ========================================================================== */\n/*\n * Addresses margin not present in IE 8/9 and Safari 5.\n */\nfigure {\n  margin: 0;\n}\n/* ==========================================================================\n   Forms\n   ========================================================================== */\n/*\n * Define consistent border, margin, and padding.\n */\nfieldset {\n  border: 1px solid #c0c0c0;\n  margin: 0 2px;\n  padding: 0.35em 0.625em 0.75em;\n}\n/*\n * 1. Corrects color not being inherited in IE 8/9.\n * 2. Remove padding so people aren't caught out if they zero out fieldsets.\n */\nlegend {\n  border: 0;\n  /* 1 */\n\n  padding: 0;\n  /* 2 */\n\n}\n/*\n * 1. Corrects font family not being inherited in all browsers.\n * 2. Corrects font size not being inherited in all browsers.\n * 3. Addresses margins set differently in Firefox 4+, Safari 5, and Chrome\n */\nbutton,\ninput,\nselect,\ntextarea {\n  font-family: inherit;\n  /* 1 */\n\n  font-size: 100%;\n  /* 2 */\n\n  margin: 0;\n  /* 3 */\n\n}\n/*\n * Addresses Firefox 4+ setting `line-height` on `input` using `!important` in\n * the UA stylesheet.\n */\nbutton,\ninput {\n  line-height: normal;\n}\n/*\n * 1. Avoid the WebKit bug in Android 4.0.* where (2) destroys native `audio`\n *    and `video` controls.\n * 2. Corrects inability to style clickable `input` types in iOS.\n * 3. Improves usability and consistency of cursor style between image-type\n *    `input` and others.\n */\nbutton,\nhtml input[type=\"button\"],\ninput[type=\"reset\"],\ninput[type=\"submit\"] {\n  -webkit-appearance: button;\n  /* 2 */\n\n  cursor: pointer;\n  /* 3 */\n\n}\n/*\n * Re-set default cursor for disabled elements.\n */\nbutton[disabled],\ninput[disabled] {\n  cursor: default;\n}\n/*\n * 1. Addresses box sizing set to `content-box` in IE 8/9.\n * 2. Removes excess padding in IE 8/9.\n */\ninput[type=\"checkbox\"],\ninput[type=\"radio\"] {\n  box-sizing: border-box;\n  /* 1 */\n\n  padding: 0;\n  /* 2 */\n\n}\n/*\n * 1. Addresses `appearance` set to `searchfield` in Safari 5 and Chrome.\n * 2. Addresses `box-sizing` set to `border-box` in Safari 5 and Chrome\n *    (include `-moz` to future-proof).\n */\ninput[type=\"search\"] {\n  -webkit-appearance: textfield;\n  /* 1 */\n\n  -moz-box-sizing: content-box;\n  -webkit-box-sizing: content-box;\n  /* 2 */\n\n  box-sizing: content-box;\n}\n/*\n * Removes inner padding and search cancel button in Safari 5 and Chrome\n * on OS X.\n */\ninput[type=\"search\"]::-webkit-search-cancel-button,\ninput[type=\"search\"]::-webkit-search-decoration {\n  /*    -webkit-appearance: none;*/\n\n}\n/*\n * Removes inner padding and border in Firefox 4+.\n */\nbutton::-moz-focus-inner,\ninput::-moz-focus-inner {\n  border: 0;\n  padding: 0;\n}\n/*\n * 1. Removes default vertical scrollbar in IE 8/9.\n * 2. Improves readability and alignment in all browsers.\n */\ntextarea {\n  overflow: auto;\n  /* 1 */\n\n  vertical-align: top;\n  /* 2 */\n\n}\n/* ==========================================================================\n   Tables\n   ========================================================================== */\n/*\n * Remove most spacing between table cells.\n */\ntable {\n  border-collapse: collapse;\n  border-spacing: 0;\n}\n", "../../style/topcoat/normalize.css?rootpath=../../style/topcoat/"); });

define('mobileui/utils/less-module!../../style/topcoat/topcoat-mobile.css?rootpath=../../style/topcoat/',["mobileui/utils/style-module"], function(StyleModule) { return StyleModule.injectStyle("/* Definitions -----------------------------------------------------------\n\n/*\n  Fonts\n\t200 = light\n\t500 = normal\n\t600 = demi-bold\n\n  Icons\n\tsm = 24x24\n\tlg = 36x36\n*/\n/* Fonts ----------------------------------------------------------------- */\n@font-face {\n  font-family: \"Source Sans\";\n  src: url('../../style/topcoat/../font/SourceSansPro/SourceSansPro-Regular.otf');\n}\n@font-face {\n  font-family: \"Source Sans\";\n  src: url('../../style/topcoat/../font/SourceSansPro/SourceSansPro-Light.otf');\n  font-weight: 200;\n}\n@font-face {\n  font-family: \"Source Sans\";\n  src: url('../../style/topcoat/../font/SourceSansPro/SourceSansPro-Semibold.otf');\n  font-weight: 600;\n}\n@font-face {\n  font-family: \"source\";\n  src: url(\"../../style/topcoat/../font/SourceSansPro/SourceSansPro-Regular.otf\");\n}\n@font-face {\n  font-family: \"source-l\";\n  src: url(\"../../style/topcoat/../font/SourceSansPro/SourceSansPro-Light.otf\");\n  font-weight: 200;\n}\n@font-face {\n  font-family: \"source-sb\";\n  src: url(\"../../style/topcoat/../font/SourceSansPro/SourceSansPro-Semibold.otf\");\n  font-weight: 600;\n}\n/* Global ----------------------------------------------------------------- */\nbody {\n  margin: 0;\n  padding: 0;\n  background-color: #fff;\n  color: #000;\n  font: 16px \"Source Sans\", helvetica, arial, sans-serif;\n  font-weight: 200;\n  text-rendering: optimizeLegibility;\n}\n.disabled {\n  opacity: 0.3;\n  cursor: default;\n  pointer-events: none;\n}\n/*\n 1.1 Button\n\n \".*-button\" is a base button class. Apply other classes, like \".large-button\" to change its appearance.\n\n .down - to simulate an active state on mobile devices\n .large-button - creates a large version of your button\n .quiet-button - creates a quiet version of your button\n\n     <a class=\"dark-button {{modifier}}\">Button</a>\n     <a class=\"light-button {{modifier}}\">Button</a>\n\n*/\n.dark-button,\n.light-button {\n  position: relative;\n  display: inline-block;\n  box-sizing: border-box;\n  -webkit-box-sizing: border-box;\n  overflow: hidden;\n  white-space: nowrap;\n  vertical-align: top;\n  padding: 0 20px;\n  border-radius: 6px;\n  margin: 5px 10px 5px 0;\n  background-clip: padding-box;\n  font-size: 16px;\n  line-height: 3rem;\n  letter-spacing: 1px;\n  text-align: center;\n  text-decoration: none;\n  text-overflow: ellipsis;\n  user-select: none;\n  -webkit-touch-callout: none;\n  -webkit-user-select: none;\n}\n.dark-button {\n  border: 1px solid rgba(0, 0, 0, 0.36);\n  background-color: #595b5b;\n  box-shadow: inset 0 1px rgba(255, 255, 255, 0.12);\n  color: #c6c8c8;\n  text-shadow: 0 -1px rgba(0, 0, 0, 0.69);\n}\n/* Button States */\n.dark-button:active,\n.dark-button.down {\n  background-color: #404141;\n  box-shadow: inset 0 1px rgba(0, 0, 0, 0.18);\n}\n.light-button {\n  border: 1px solid #a5a8a8;\n  background-color: #e5e9e8;\n  box-shadow: inset 0 1px #ffffff;\n  color: #454545;\n  text-shadow: 0 1px #ffffff;\n}\n/* Button States */\n.light-button:active,\n.light-button.down {\n  background-color: #d3d7d7;\n  box-shadow: inset 0 1px rgba(0, 0, 0, 0.12);\n}\n.quiet-button {\n  /* Adding a border here to the button doesn't shift when clicked*/\n\n  border: 1px solid transparent;\n  background-color: transparent;\n  box-shadow: none;\n}\n/* Button States */\n.quiet-button.dark-button:active,\n.quiet-button.dark-button.down {\n  border: 1px solid rgba(0, 0, 0, 0.36);\n  background-color: #404141;\n  box-shadow: inset 0 1px rgba(0, 0, 0, 0.18);\n  color: #c6c8c8;\n  text-shadow: 0 -1px rgba(0, 0, 0, 0.69);\n}\n.quiet-button.light-button:active,\n.quiet-button.light-button.down {\n  border: 1px solid #a5a8a8;\n  box-shadow: inset 0 1px rgba(0, 0, 0, 0.12);\n  color: #454545;\n  text-shadow: 0 1px #ffffff;\n  background-color: #d3d7d7;\n}\n.large-button {\n  font-size: 1.3rem;\n  line-height: 4rem;\n}\n/*\n 1.2 CTA Button\n\n \".*-cta\" adds call-to-action styling to a button.\n\n .down - to simulate an active state on mobile devices\n .large-button - creates a large version of your button\n\n     <a class=\"dark-cta {{modifier}}\">Button</a>\n     <a class=\"light-cta {{modifier}}\">Button</a>\n\n*/\n.dark-cta,\n.light-cta {\n  border: 1px solid #143250;\n  background-color: #288edf;\n  box-shadow: inset 0 1px rgba(255, 255, 255, 0.36);\n  color: #ffffff;\n  font-weight: 500;\n  text-shadow: 0 -1px rgba(0, 0, 0, 0.36);\n}\n/* CTA States */\n.dark-cta:active,\n.dark-cta.down {\n  background-color: #1976c3;\n  box-shadow: inset 0 1px rgba(0, 0, 0, 0.12);\n}\n.light-cta:active,\n.light-cta.down {\n  background-color: #0380e8;\n  box-shadow: inset 0 1px rgba(0, 0, 0, 0.12);\n}\n/*\n 1.3 Icon Button\n\n Use \".icon\" and \".large-icon\" to add an icon to a button. Use the \".no-label\" class if you need a button with an\n icon but no text.\n\n\t.large-button - creates a large version of your button and icon\n\n     <a class=\"dark-button {{modifier}}\"><i class=\"icon\"></i>Button</a>\n     <a class=\"light-button {{modifier}}\"><i class=\"icon\"></i>Button</a>\n\n     <a class=\"no-label dark-button {{modifier}}\"><i class=\"icon\"></i>Button</a>\n     <a class=\"no-label light-button {{modifier}}\"><i class=\"icon\"></i>Button</a>\n\n*/\n.dark-button.icon-button,\n.light-button.icon-button,\n.large-button.icon-button {\n  padding: 0 0.75rem;\n}\n.icon {\n  position: relative;\n  display: inline-block;\n  overflow: hidden;\n  width: 24px;\n  height: 24px;\n  margin: .75rem .75rem 0 0;\n  background-color: #c0c0c0;\n  background-size: 24px;\n  text-indent: 100%;\n  vertical-align: top;\n}\n.large-button > .icon {\n  width: 40px;\n  height: 40px;\n}\n/* Use this class if you need a button with an icon but no text */\n.icon-button.no-label {\n  padding: 0 0 0 .75rem;\n}\n/*\n 1.4 Button Bar\n\n Wrap this class around a group of buttons to create a button bar.\n\n\t<div class=\"button-bar\">\n\t\t<a class=\"dark-button\">First</a>\n\t\t<a class=\"dark-button\">Second</a>\n\t\t<a class=\"dark-button\">Third</a>\n\t</div>\n\n\t<div class=\"button-bar\">\n\t\t<a class=\"large-button light-button\">Demand</a>\n\t\t<a class=\"large-button light-button\">Moar</a>\n\t\t<a class=\"large-button light-button\">Cookies</a>\n\t</div>\n*/\n.button-bar {\n  position: relative;\n  display: inline-block;\n  overflow: visible;\n  margin: 5px 5px 5px 0;\n  vertical-align: top;\n  white-space: nowrap;\n}\n.button-bar > .dark-button,\n.button-bar > .light-button {\n  word-wrap: break-word;\n}\n/* First button in the button bar */\n.button-bar > .dark-button:first-child,\n.button-bar > .light-button:first-child {\n  border-radius: 6px 0 0 6px;\n  margin: 0;\n}\n/* Middle buttons in the button bar */\n.button-bar > .dark-button:not(:first-child):not(:last-child),\n.button-bar > .light-button:not(:first-child):not(:last-child) {\n  border-radius: 0;\n  margin: 0 -4px;\n}\n/* Last button in the button bar */\n.button-bar > .dark-button:last-child,\n.button-bar > .light-button:last-child {\n  border-radius: 0 6px 6px 0;\n  margin: 0;\n}\n.button-bar.duo > .dark-button:last-child,\n.button-bar.duo > .light-button:last-child {\n  margin: 0 -4px;\n}\n/*\n 2.1 Inputs - Single Line Text\n\n Applying \".*-text-input\" to text-based form input elements such as \"text\", \"search\", or\n \"email\" input element adds base styling.\n\n\t.large-text-input - larger-sized elements that match the height of a \".large-button\".\n\n\t<input type=\"text\" class=\"dark-text-input {{modifier}}\" value=\"\" placeholder=\"Text input goes here\">\n\t<input type=\"text\" class=\"light-text-input {{modifier}}\" value=\"\" placeholder=\"Text input goes here\">\n\t<input type=\"search\" class=\"dark-text-input {{modifier}}\" value=\"\" placeholder=\"Text input goes here\">\n\t<input type=\"search\" class=\"light-text-input {{modifier}}\" value=\"\" placeholder=\"Text input goes here\">\n\n*/\n.dark-text-input,\n.light-text-input {\n  vertical-align: top;\n  box-sizing: border-box;\n  -webkit-box-sizing: border-box;\n  padding: 0 20px;\n  border-radius: 6px;\n  margin: 5px;\n  height: 3em;\n  font: 1em \"Source Sans\", helvetica, arial, sans-serif;\n  font-weight: 200;\n  outline: none;\n}\n.dark-search-input,\n.light-search-input {\n  box-sizing: border-box;\n  -webkit-box-sizing: border-box;\n  margin: 5px;\n  outline: none;\n  vertical-align: top;\n  -webkit-appearance: none;\n  padding: 0 0 0 2.7em;\n  border-radius: 30px;\n  background-image: url(\"../../style/topcoat/../img/search-bg.png\");\n  background-position: 1em center;\n  background-repeat: no-repeat;\n  height: 3em;\n  font: 1em \"Source Sans\", helvetica, arial, sans-serif;\n  font-weight: 200;\n}\n@media only screen and (-webkit-min-device-pixel-ratio: 2), only screen and (min-resolution: 192dpi) {\n  .dark-search-input,\n  .light-search-input {\n    background-image: url(\"../../style/topcoat/../img/search-bg2x.png\");\n    background-size: 20px;\n  }\n}\n.dark-text-input,\n.dark-search-input {\n  border: 1px solid #2f3233;\n  background-color: #424546;\n  box-shadow: inset 0 1px rgba(0, 0, 0, 0.12);\n  color: #b9bbbc;\n}\n.light-text-input,\n.light-search-input {\n  border: 1px solid #a5a8a8;\n  background-color: #f2f3f3;\n  box-shadow: inset 0 1px rgba(0, 0, 0, 0.12);\n  color: #454545;\n}\ninput[type=\"search\"]::-webkit-search-cancel-button,\ninput[type=\"search\"]::-webkit-search-decoration {\n  margin-right: 5px;\n}\n.dark-text-input:focus,\n.dark-search-input:focus,\n.light-text-input:focus,\n.light-search-input:focus {\n  background-color: #ffffff;\n  color: #000;\n}\n.dark-text-input:focus::-webkit-input-placeholder,\n.dark-search-input:focus::-webkit-input-placeholder,\n.light-text-input:focus::-webkit-input-placeholder,\n.light-search-input:focus::-webkit-input-placeholder {\n  color: #C6C8C8;\n}\n.large-text-input {\n  height: 4rem;\n  font: 1.3rem \"Source Sans\", helvetica, arial, sans-serif;\n  font-weight: 200;\n}\n.dark-search-input.large-text-input,\n.light-search-input.large-text-input {\n  padding-left: 2.8em;\n  border-radius: 40px;\n  background-position: 1.2em center;\n}\n/*\n 2.2 Inputs - Textareas\n\n Base styles for textareas.\n\n .large-textarea - apply this to create a large textarea\n\n\t<textarea class=\"dark-textarea {{modifier}}\" rows=\"6\" cols=\"36\"></textarea>\n\t<textarea class=\"light-textarea {{modifier}}\" rows=\"6\" cols=\"36\"></textarea>\n\n*/\ntextarea {\n  vertical-align: top;\n  box-sizing: border-box;\n  -webkit-box-sizing: border-box;\n  padding: 10px 20px;\n  border-radius: 6px;\n  margin: 5px;\n  font: 1em \"Source Sans\", helvetica, arial, sans-serif;\n  font-weight: 200;\n  line-height: 1.5em;\n  resize: none;\n  outline: none;\n}\ntextarea:focus {\n  background-color: #ffffff;\n  color: #454545;\n}\n.dark-textarea {\n  border: 1px solid #2f3233;\n  background-color: #424546;\n  box-shadow: inset 0 1px rgba(0, 0, 0, 0.12);\n  color: #c6c8c8;\n}\n.light-textarea {\n  border: 1px solid #a5a8a8;\n  background-color: #eff1f1;\n  box-shadow: inset 0 1px rgba(0, 0, 0, 0.12);\n  color: #454545;\n}\n.large-textarea {\n  font: 1.3rem \"Source Sans\", helvetica, arial, sans-serif;\n  font-weight: 200;\n  line-height: 2rem;\n}\n/*\n 2.3 Inputs - Checkboxes\n\n Base styles for checkboxes. The <label> needs to be placed after the <input> element in the HTML. If\n you are using .checkbox-right, make sure to set the width, so all the labels are the same width and the\n controls line up vertically.\n\n .checkbox-left - use if you want the control to appear before (to the left of) the label\n .checkbox-right - use if you want the control to appear after (to the right of) the label\n\n\t<input type=\"checkbox\" id=\"checkbox\" />\n\t<label for=\"checkbox\" class=\"{{modifier}}\">Option</label>\n\t<br />\n\t<input type=\"checkbox\" id=\"checkbox\" checked />\n\t<label for=\"checkbox\" class=\"{{modifier}}\">Option</label>\n\n*/\ninput[type=\"checkbox\"],\ninput[type=\"radio\"] {\n  display: none;\n}\n.checkbox-left:before,\n.checkbox-right:after {\n  content: \" \";\n  display: inline-block;\n  position: relative;\n  top: -6px;\n  width: 35px;\n  height: 31px;\n  background-position: left -37px;\n  background-repeat: no-repeat;\n  background-size: 37px;\n}\n.checkbox-left:before {\n  float: left;\n  margin-right: 15px;\n}\n.checkbox-right:after {\n  float: right;\n}\n.dark-checkbox:before,\n.dark-checkbox:after {\n  background-image: url(\"../../style/topcoat/../img/dark-sprites2x.png\");\n}\n.light-checkbox:before,\n.light-checkbox:after {\n  background-image: url(\"../../style/topcoat/../img/light-sprites2x.png\");\n}\n.checkbox-left,\n.checkbox-right,\n.radio-left,\n.radio-right {\n  display: inline-block;\n  margin: 5px 0;\n  cursor: pointer;\n  user-select: none;\n  -webkit-touch-callout: none;\n  -webkit-user-select: none;\n}\n.checkbox-right,\n.radio-right {\n  /*Set this width value to make sure all the labels line up*/\n\n  width: 200px;\n}\ninput[type=\"checkbox\"]:checked + .checkbox-left:before,\ninput[type=\"checkbox\"]:checked + .checkbox-right:after {\n  background-position: left -2px;\n}\ninput[type=\"checkbox\"]:disabled + label {\n  opacity: 0.3;\n  cursor: default;\n  pointer-events: none;\n}\n/*\n 2.4 Inputs - Radio Buttons\n\n Base styles for radio buttons. The <label> needs to be placed after the <input> element in the HTML. If\n you are using .radio-right, make sure to set the width, so all the labels are the same width and the\n controls line up vertically.\n\n .radio-left - use if you want the control to appear before (to the left of) the label\n .radio-right - use if you want the control to appear after (to the right of) the label\n\n\t<input type=\"radio\" id=\"radio\" name=\"radiogroup\" />\n\t<label for=\"radio\" class=\"dark-radio {{modifier}}\">Option</label>\n\t<br />\n\t<input type=\"radio\" id=\"radio\" name=\"radiogroup\" checked />\n\t<label for=\"radio\" class=\"dark-radio {{modifier}}\">Option</label>\n\n\t<input type=\"radio\" id=\"radio\" name=\"radiogroup\" />\n\t<label for=\"radio\" class=\"light-radio {{modifier}}\">Option</label>\n\t<br />\n\t<input type=\"radio\" id=\"radio\" name=\"radiogroup\" checked />\n\t<label for=\"radio\" class=\"light-radio {{modifier}}\">Option</label>\n\n*/\n.radio-left:before,\n.radio-right:after {\n  content: \" \";\n  display: inline-block;\n  position: relative;\n  top: -6px;\n  width: 35px;\n  height: 31px;\n  background-position: left -109px;\n  background-repeat: no-repeat;\n  background-size: 37px;\n}\n.radio-left:before {\n  float: left;\n  margin-right: 15px;\n}\n.radio-right:after {\n  float: right;\n}\n.dark-radio:before,\n.dark-radio:after {\n  background-image: url(\"../../style/topcoat/../img/dark-sprites2x.png\");\n}\n.light-radio:before,\n.light-radio:after {\n  background-image: url(\"../../style/topcoat/../img/light-sprites2x.png\");\n}\n@media (-webkit-min-device-pixel-ratio: 2) {\n  .dark-radio:before,\n  .dark-radio:after {\n    background-image: url(\"../../style/topcoat/../img/dark-sprites2x.png\");\n  }\n  .light-radio:before,\n  .light-radio:after {\n    background-image: url(\"../../style/topcoat/../img/light-sprites2x.png\");\n  }\n}\ninput[type=\"radio\"]:checked + .radio-left:before,\ninput[type=\"radio\"]:checked + .radio-right:after {\n  background-position: left -74px;\n}\ninput[type=\"radio\"]:checked + .dark-radio {\n  color: #fff;\n}\ninput[type=\"radio\"]:disabled + label {\n  opacity: 0.3;\n  cursor: default;\n  pointer-events: none;\n}\n/*\n 2.5 Inputs - Switch\n\n Create an on/off switch. DOM must be structured the same as below. Change \"on\" and \"off\" text states in the CSS.\n\n\t<div class=\"slide-switch-container\">\n\t    <input type=\"checkbox\" name=\"switch\" id=\"slideswitch\" checked>\n\t    <label class=\"dark-slide-switch\" for=\"slideswitch\">\n\t        <div class=\"on-off\"></div>\n\t        <div class=\"switch\"></div>\n\t    </label>\n\t</div>\n\n\t<div class=\"slide-switch-container\">\n\t    <input type=\"checkbox\" name=\"switch\" id=\"slideswitch\" checked>\n\t    <label class=\"light-slide-switch\" for=\"slideswitch\">\n\t        <div class=\"on-off\"></div>\n\t        <div class=\"switch\"></div>\n\t    </label>\n\t</div>\n\n*/\n.slide-switch-container {\n  position: relative;\n  width: 5.5em;\n  display: inline-block;\n  vertical-align: middle;\n  -webkit-user-select: none;\n  -moz-user-select: none;\n  -ms-user-select: none;\n  margin-left: 10px;\n}\n.dark-slide-switch,\n.light-slide-switch {\n  display: inline-block;\n  overflow: hidden;\n  cursor: pointer;\n  width: 5.5em;\n  border-radius: 6px;\n}\n.dark-slide-switch {\n  border: 1px solid #2f3233;\n}\n.light-slide-switch {\n  border: 1px solid #a5a8a8;\n}\n.on-off {\n  width: 200%;\n  margin-left: -100%;\n  -moz-transition: margin 0.2s ease-in 0s;\n  -webkit-transition: margin 0.2s ease-in 0s;\n  -o-transition: margin 0.2s ease-in 0s;\n  transition: margin 0.2s ease-in 0s;\n}\n.on-off:before,\n.on-off:after {\n  float: left;\n  width: 50%;\n  height: 3em;\n  padding: 0px;\n  border-radius: 4px;\n  line-height: 3em;\n  font-size: 16px;\n  -moz-box-sizing: border-box;\n  -webkit-box-sizing: border-box;\n  box-sizing: border-box;\n  overflow: hidden;\n}\n.on-off:before {\n  content: \"ON\";\n  padding-left: 1em;\n}\n.on-off:after {\n  content: \"OFF\";\n  padding-right: 1em;\n  text-align: right;\n}\n.dark-slide-switch .on-off:before {\n  background-color: #404141;\n  box-shadow: inset 0 1px 0px rgba(0, 0, 0, 0.06);\n  color: #5dc1ff;\n}\n.dark-slide-switch .on-off:after {\n  background-color: #404141;\n  box-shadow: inset 0 1px 0px rgba(0, 0, 0, 0.06);\n  color: #909090;\n}\n.light-slide-switch .on-off:before {\n  background-color: #e0f0fa;\n  box-shadow: inset 0 1px 0px rgba(0, 0, 0, 0.06);\n  color: #0083e8;\n  text-shadow: 0 1px #fff;\n}\n.light-slide-switch .on-off:after {\n  background-color: #D3D7D7;\n  box-shadow: inset 0 1px 0px rgba(0, 0, 0, 0.06);\n  color: #909090;\n  text-shadow: 0 1px #fff;\n}\n.slide-switch-container .switch {\n  width: 2em;\n  margin: 0px;\n  height: 3em;\n  border-radius: 6px;\n  position: absolute;\n  top: 0;\n  bottom: 0;\n  right: 3.4em;\n  -moz-transition: all 0.2s ease-in 0s;\n  -webkit-transition: all 0.2s ease-in 0s;\n  -o-transition: all 0.2s ease-in 0s;\n  transition: all 0.2s ease-in 0s;\n}\n.dark-slide-switch .switch {\n  background: url(\"../../style/topcoat/../img/dark-grips.png\") center center no-repeat #595b5b;\n  background-size: 7px;\n  border: 1px solid #2f3233;\n  box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.12);\n}\n.light-slide-switch .switch {\n  background: url(\"../../style/topcoat/../img/light-grips.png\") center center no-repeat #e5e9e8;\n  background-size: 7px;\n  border: 1px solid #a5a8a8;\n  box-shadow: inset 0 1px 0 white;\n}\n.slide-switch-container input[type=\"checkbox\"]:checked + label .on-off {\n  margin-left: 0;\n}\n.slide-switch-container input[type=\"checkbox\"]:checked + label .switch {\n  right: -2px;\n}\n/*\n 2.6 Inputs - Slider\n\n Apply to a range input to style a slider.\n\n\t<input type=\"range\" class=\"dark-slider\">\n\t<input type=\"range\" class=\"light-slider\">\n*/\n.dark-slider,\n.light-slider {\n  height: 1em;\n  border-radius: 12px;\n  margin: 2em;\n  -webkit-appearance: none !important;\n}\n.dark-slider {\n  border: 1px solid rgba(0, 0, 0, 0.36);\n  background-color: #404141;\n}\n.dark-slider::-webkit-slider-thumb {\n  height: 3em;\n  width: 2em;\n  border: 1px solid rgba(0, 0, 0, 0.36);\n  border-radius: 4px;\n  background: url(\"../../style/topcoat/../img/dark-grips.png\") center center no-repeat #595b5b;\n  background-size: 7px 18px;\n  box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.12);\n  cursor: pointer;\n  -webkit-appearance: none !important;\n}\n.light-slider {\n  height: 1em;\n  border: 1px solid #a5a8a8;\n  background-color: #d3d7d7;\n  -webkit-appearance: none !important;\n}\n.light-slider::-webkit-slider-thumb {\n  height: 3em;\n  width: 2em;\n  border: 1px solid #a5a8a8;\n  border-radius: 4px;\n  background: url(\"../../style/topcoat/../img/light-grips.png\") center center no-repeat #e5e9e8;\n  background-size: 7px 18px;\n  box-shadow: inset 0 1px 0 #ffffff;\n  cursor: pointer;\n  -webkit-appearance: none !important;\n}\n/*\n 2.7 Inputs - Combo Box\n\n Pick from a list of items without a default option.\n\n\t<button class=\"dark-combo\">\n*/\n.dark-combo,\n.light-combo {\n  position: relative;\n  display: inline-block;\n  box-sizing: border-box;\n  -webkit-box-sizing: border-box;\n  overflow: hidden;\n  white-space: nowrap;\n  vertical-align: top;\n  padding: 0 60px 0 20px;\n  border-radius: 6px;\n  background-clip: padding-box;\n  line-height: 3rem;\n  letter-spacing: 1px;\n  text-decoration: none;\n  text-overflow: ellipsis;\n  user-select: none;\n  -webkit-touch-callout: none;\n  -webkit-user-select: none;\n}\n.dark-combo {\n  border: 1px solid #2f3233;\n  background-color: #424546;\n  background-image: url('../../style/topcoat/../img/dark-combo-box-bg.png');\n  background-position: 93% center;\n  background-repeat: no-repeat;\n  box-shadow: inset 0 1px rgba(0, 0, 0, 0.12);\n  color: #b9bbbc;\n}\n@media only screen and (-webkit-min-device-pixel-ratio: 2), only screen and (min-resolution: 192dpi) {\n  .spinner {\n    background: url(\"../../style/topcoat/../img/dark-combo-box-bg2x.png\") no-repeat;\n    background-size: 11px;\n  }\n}\n.light-combo {\n  border: 1px solid #a5a8a8;\n  background-color: #f2f3f3;\n  background-image: url('../../style/topcoat/../img/light-combo-box-bg.png');\n  background-position: 93% center;\n  background-repeat: no-repeat;\n  box-shadow: inset 0 1px rgba(0, 0, 0, 0.12);\n  color: #b9bbbc;\n}\n@media only screen and (-webkit-min-device-pixel-ratio: 2), only screen and (min-resolution: 192dpi) {\n  .spinner {\n    background: url(\"../../style/topcoat/../img/light-combo-box-bg2x.png\") no-repeat;\n    background-size: 11px;\n  }\n}\n.dark-combo-drop,\n.light-combo-drop {\n  border-radius: 6px;\n  padding: 0 5px;\n  box-shadow: 0 0 5px rgba(0, 0, 0, 0.12);\n  list-style: none;\n}\n.dark-combo-drop li,\n.light-combo-drop li {\n  padding: 15px;\n}\n.dark-combo-drop li:first-child,\n.light-combo-drop li:first-child {\n  border-top: none;\n}\n.dark-combo-drop li.chosen {\n  position: relative;\n  z-index: 10;\n  padding-left: 20px;\n  border-top: none;\n  margin: 0 -5px -1px;\n  background-color: #45aeff;\n}\n.light-combo-drop li.chosen {\n  position: relative;\n  z-index: 10;\n  padding-left: 20px;\n  border-top: none;\n  margin: 0 -5px -1px;\n  background-color: #fff;\n}\n.dark-combo-drop {\n  background-color: #595b5b;\n  color: #fff;\n}\n.dark-combo-drop li {\n  border-top: 1px solid #484b4c;\n}\n.light-combo-drop {\n  background-color: #e5e9e9;\n  color: #454545;\n}\n.light-combo-drop li {\n  border-top: 1px solid #d3d7d7;\n}\n/*\n 3.1 Indicators - Progress Bar\n\n .complete - use this class when you want the progress bar filled\n\n\t<div class=\"dark-progress-bar\">\n  \t\t<span class=\"progress {{modifier}}\"></span>\n\t</div>\n\t<div class=\"light-progress-bar\">\n  \t\t<span class=\"progress {{modifier}}\"></span>\n\t</div>\n*/\n.dark-progress-bar,\n.light-progress-bar {\n  overflow: hidden;\n  width: 250px;\n  height: 1.25em;\n  border-radius: 12px;\n  margin: 20px;\n}\n.dark-progress-bar > .progress,\n.light-progress-bar > .progress {\n  display: block;\n  height: 100%;\n  width: 45%;\n  border-radius: 12px 0 0 12px;\n}\n.dark-progress-bar {\n  background-color: #404141;\n  box-shadow: inset 0 1px rgba(0, 0, 0, 0.12);\n}\n.dark-progress-bar > .progress {\n  background-color: #61c0ff;\n  box-shadow: inset 0 1px rgba(0, 0, 0, 0.18);\n}\n.light-progress-bar {\n  background-color: #d3d7d7;\n  box-shadow: 0 1px rgba(255, 255, 255, 0.25), inset 0 1px rgba(0, 0, 0, 0.12);\n}\n.light-progress-bar > .progress {\n  background-color: #e0f0fa;\n  box-shadow: inset 0 1px rgba(0, 0, 0, 0.12);\n}\n.complete {\n  width: 100%;\n}\n/*\n 3.2 Indicators - Spinner\n\n\t<div class=\"spinner\"></div>\n\t<div class=\"large-spinner\"></div>\n\n*/\n.spinner {\n  width: 36px;\n  height: 36px;\n  background: url(\"../../style/topcoat/../img/spinner.png\") no-repeat;\n  margin: 5px;\n  display: inline-block;\n  -webkit-animation: spinner 1s infinite linear;\n}\n@media only screen and (-webkit-min-device-pixel-ratio: 2), only screen and (min-resolution: 192dpi) {\n  .spinner {\n    background: url(\"../../style/topcoat/../img/spinner2x.png\") no-repeat;\n    background-size: 36px;\n  }\n}\n@-webkit-keyframes spinner {\n  0% {\n    -webkit-transform: rotate(0deg);\n  }\n  50% {\n    -webkit-transform: rotate(180deg);\n  }\n  100% {\n    -webkit-transform: rotate(360deg);\n  }\n}\n/*\n 3.3 Indicators - Notification\n\n\t<strong>Inbox</strong> <span class=\"notification\">1</span>\n\n*/\n.notification {\n  display: inline-block;\n  padding: 0.15em 0.5em 0.2em;\n  border-radius: 2px;\n  background: #ec514e;\n  color: white;\n  /*change font size and margin to customize the notification badge*/\n\n  font-size: 0.875rem;\n  margin-left: 6px;\n}\n/*\n 4.1 Navigation - Header Bar\n\n Use this class as a header at the top of a mobile app. Use \".header-title\"\n to display and style the title. Add custom styles for any other elements,\n such as back and settings buttons.\n\n\t<div class=\"dark-header-bar\">\n\t\t<h1 class=\"header-title\">Super Cool title</h1>\n\t</div>\n\t<div class=\"light-header-bar\">\n\t\t<h1 class=\"header-title\">Super Cool title</h1>\n\t</div>\n*/\n.dark-header-bar,\n.light-header-bar {\n  height: 3.9000000000000004rem;\n  width: 100%;\n  line-height: 3.9000000000000004rem;\n  text-align: center;\n}\n.dark-header-bar {\n  background-color: #595b5b;\n  color: #fff;\n  box-shadow: inset 0 -1px #333434, 0 1px rgba(0, 0, 0, 0.15);\n}\n.light-header-bar {\n  background-color: #e5e9e8;\n  color: #000;\n  box-shadow: inset 0 -1px #b9bcbc, 0 1px rgba(0, 0, 0, 0.05);\n}\n.dark-header-bar p,\n.light-header-bar p {\n  margin: 0;\n}\n.header-bar-title {\n  font-size: 1.3rem;\n  text-align: center;\n}\n/*\n 4.2 Navigation - Tab Bar\n\n Use this class as a tab bar of a mobile app. Set the width of each tab button by\n applying a width to the \"a\" rule.\n\n\t<ul class=\"dark-tab-bar\">\n\t\t<a>#1</a>\n\t\t<a class=\"down\">#2</a>\n\t\t<a>#3</a>\n\t\t<a>#4</a>\n\t\t<a>#5</a>\n\t</ul>\n\t<ul class=\"light-tab-bar\">\n\t\t<a>#1</a>\n\t\t<a class=\"down\">#2</a>\n\t\t<a>#3</a>\n\t\t<a>#4</a>\n\t\t<a>#5</a>\n\t</ul>\n*/\n.dark-tab-bar,\n.light-tab-bar {\n  position: relative;\n  display: inline-block;\n  width: 100%;\n  height: 56px;\n  padding: 0;\n  margin-bottom: 0;\n  line-height: 56px;\n  list-style: none;\n  text-align: center;\n  user-select: none;\n  -webkit-touch-callout: none;\n  -webkit-user-select: none;\n  vertical-align: top;\n}\n.dark-tab-bar {\n  border-top: 1px solid #2F3233;\n}\n.light-tab-bar {\n  border-top: 1px solid #a5a8a8;\n}\n.dark-tab-bar a {\n  float: left;\n  /* Set the width of each tab button here 100%/5 = 20% */\n\n  width: 20%;\n  background-color: #595b5b;\n  box-shadow: inset 0 1px rgba(255, 255, 255, 0.12);\n  color: #c6c8c8;\n  text-decoration: none;\n  text-shadow: 0 -1px rgba(0, 0, 0, 0.69);\n}\n.light-tab-bar a {\n  float: left;\n  /* Set the width of each tab button here 100%/5 = 20% */\n\n  width: 20%;\n  background-color: #e5e9e8;\n  box-shadow: inset 0 1px #ffffff;\n  color: #454545;\n  text-decoration: none;\n  text-shadow: 0 1px #ffffff;\n}\n.dark-tab-bar a:first-child,\n.light-tab-bar a:first-child {\n  border: 0;\n}\n.dark-tab-bar a.down,\n.dark-tab-bar a:active {\n  background-color: #404141;\n  color: #5dc1ff;\n  box-shadow: inset 0 0 0 1px rgba(0, 0, 0, 0.18);\n}\n.light-tab-bar a.down,\n.light-tab-bar a:active {\n  background-color: #e0f0fa;\n  color: #0083e8;\n  box-shadow: inset 0 0 0 1px rgba(0, 0, 0, 0.12);\n}\n/*\n 5.1 Lists\n\n\t<ul class=\"dark-list\">\n\t\t<li>Item #1</li>\n\t\t<li>Item #2</li>\n\t\t<li>Item #3</li>\n\t</ul>\n\n\t<ul class=\"light-list\">\n\t\t<li>Item #1</li>\n\t\t<li>Item #2</li>\n\t\t<li>Item #3</li>\n\t</ul>\n*/\n.dark-list,\n.light-list {\n  display: block;\n  padding: 0;\n  list-style: none;\n  user-select: none;\n  -webkit-touch-callout: none;\n  -webkit-user-select: none;\n}\n.dark-list {\n  border-top: 1px solid #2f3234;\n  border-bottom: 1px solid #5e6061;\n  color: #c6c8c8;\n}\n.dark-list > li {\n  /* Editable padding variable */\n\n  padding: 20px;\n  border-top: 1px solid #5e6061;\n  border-bottom: 1px solid #2f3234;\n}\n.light-list {\n  border-top: 1px solid #bcbfbf;\n  border-bottom: 1px solid #eff1f1;\n  color: #454545;\n}\n.light-list > li {\n  /* Editable padding variable */\n\n  padding: 20px;\n  border-top: 1px solid #eff1f1;\n  border-bottom: 1px solid #bcbfbf;\n}\n/*\n 6.1 Structural - Well\n\n Use this class to create a well that contains elements you want seperated from everything else.\n\n \t<section class=\"dark-well\">\n\t\t<h2>Alex Trebek</h2>\n\t\t<p>Watch \"Jeopardy!\", Alex Trebek's fun TV quiz game.</p>\n\t\t<a href=\"#\" class=\"dark-cta dark-button\" role=\"button\">Daily Double!</a>\n\t\t<a href=\"#\" class=\"dark-button\" role=\"button\">Unfriend</a>\n\t</section>\n\n\t<section class=\"light-well\">\n\t\t<h2>Alex Trebek</h2>\n\t\t<p>Watch \"Jeopardy!\", Alex Trebek's fun TV quiz game.</p>\n\t\t<a href=\"#\" class=\"light-cta light-button\" role=\"button\">Daily Double!</a>\n\t\t<a href=\"#\" class=\"light-button\" role=\"button\">Unfriend</a>\n\t</section>\n*/\n.dark-well,\n.light-well {\n  box-sizing: border-box;\n  -webkit-box-sizing: border-box;\n  overflow: hidden;\n  width: 100%;\n  padding: 15px;\n  margin-bottom: 10px;\n}\n.dark-well h1,\n.light-well h1 {\n  font-size: 1.5625rem;\n}\n.dark-well h1 {\n  color: #fff;\n}\n.light-well h1 {\n  color: #000;\n}\n.dark-well {\n  background-color: #404141;\n  color: #c6c8c8;\n}\n.light-well {\n  background-color: #fff;\n  color: ##444;\n}\n/*\n 6.2 Structural - Dialog\n\n Use this class to create a dialog element. Make sure to apply \".dialog-overlay\" an empty div on the page as well,\n so that the dialog is resting on a dark, transparent background\n\n\t<aside class=\"dark-dialog\">\n\t\t<center>Are eagles nice?</center><br /><br />\n\t\t<a href=\"#\" class=\"dark-cta dark-button\" role=\"button\">Yes!</a>\n\t\t<a href=\"#\" class=\"dark-button\" role=\"button\">No</a>\n\t</aside>\n\t<aside class=\"light-dialog\">\n\t\t<center>Are eagles nice?</center><br /><br />\n\t\t<a href=\"#\" class=\"light-cta light-button\" role=\"button\">Yes!</a>\n\t\t<a href=\"#\" class=\"light-button\" role=\"button\">No</a>\n\t</aside>\n*/\n.dark-dialog,\n.light-dialog {\n  width: 50%;\n  height: auto;\n  overflow: hidden;\n  position: absolute;\n  z-index: 10;\n  padding: 20px 10px;\n  border-radius: 6px;\n  margin: 25% 20%;\n  text-align: center;\n}\n.dark-dialog h1,\n.light-dialog h1 {\n  font-size: 1.1875rem;\n}\n.dark-dialog h1 {\n  color: #fff;\n  padding-bottom: 20px;\n  border-bottom: 1px solid #505252;\n}\n.light-dialog h1 {\n  color: #484b4c;\n  padding-bottom: 20px;\n  border-bottom: 1px solid #d3d7d7;\n}\n.dark-dialog {\n  background-color: #595b5b;\n  border: 1px solid rgba(0, 0, 0, 0.36);\n}\n.light-dialog {\n  background-color: #e5e9e8;\n  border: 1px solid #a5a8a8;\n}\n.dialog-overlay {\n  position: absolute;\n  z-index: 5;\n  background-color: rgba(88, 90, 92, 0.7);\n  width: 350px;\n  height: 350px;\n  box-shadow: inset 0px 0px 115px 0px #000000;\n}\n.dialog-buttons {\n  margin-top: 20px;\n}\n.dialog-buttons .dark-button,\n.dialog-buttons .light-button {\n  margin: 5px;\n}\n/*\n 6.2 Structural - Callout\n\n Use this class to create a callout element.\n\n\t<section class=\"dark-callout\">\n\t\t\tLight Callout Dummy Text\n\t</section>\n\t<section class=\"light-callout\">\n\t\t\tLight Callout Dummy Text\n\t</section>\n*/\n.dark-callout,\n.light-callout {\n  display: inline-block;\n  padding: 1em;\n  border-radius: 6px;\n  margin: auto;\n  position: relative;\n  box-shadow: 0 5px 10px rgba(0, 0, 0, 0.5);\n}\n.dark-callout:after,\n.light-callout:after {\n  content: \" \";\n  position: absolute;\n  left: 50%;\n  bottom: -1em;\n  width: 0;\n  height: 0;\n  border-left: 1.5em solid transparent;\n  border-right: 1.5em solid transparent;\n  margin-left: -1.5em;\n}\n.light-callout {\n  background: #e5e9e9;\n  color: #454545;\n}\n.light-callout:after {\n  border-top: 20px solid #e5e9e9;\n}\n.dark-callout {\n  background: #595b5b;\n  color: #acadad;\n}\n.dark-callout:after {\n  border-top: 20px solid #595b5b;\n}\n/* Styles for Mobile Index Page */\n#main td {\n  font-weight: 200;\n}\n.bg-slategray {\n  background: #3a3f42 url(\"../../style/topcoat/../img/bg_dark.png\") repeat-x;\n  color: #c7c7c7;\n  font-size: 16px;\n  padding: 20px;\n}\n.bg-light {\n  background-color: #DFE2E2;\n  font-size: 16px;\n}\n.mobile-tab-bar,\n.header-bar {\n  width: 80%;\n}\n.mobile-list {\n  width: 60%;\n}\n.dialog-zone {\n  position: relative;\n  width: 350px;\n  height: 350px;\n  background: url(\"../../style/topcoat/../img/dialog-zone-bg.png\") center center #ffffff;\n}\n.light-callout,\n.dark-callout {\n  margin-bottom: 1em;\n}\n/* Custom Well Styling */\n.light-well,\n.dark-well {\n  width: 273px;\n}\n.user-details {\n  position: relative;\n  clear: both;\n  float: left;\n  width: 100%;\n}\n.user-img {\n  float: left;\n  width: 50px;\n  margin-right: 20px;\n}\n.user-info {\n  position: absolute;\n  bottom: -5px;\n  left: 70px;\n  width: 173px;\n}\n.user-info p {\n  margin: 0;\n}\n.user-info a {\n  color: #0083e8;\n  text-decoration: none;\n}\n.user-friends {\n  float: left;\n  padding-left: 0;\n  margin-left: 120px;\n  list-style: none;\n}\n.following,\n.followers {\n  float: left;\n  margin-top: 20px;\n  margin-bottom: 0;\n  text-align: left;\n}\n.following {\n  margin-left: 70px;\n}\n.followers {\n  margin-left: 20px;\n}\n.dark-well dt {\n  margin-bottom: 5px;\n  color: #5dc1ff;\n}\n.light-well dt {\n  margin-bottom: 5px;\n  color: #0083e8;\n}\n.following dd,\n.followers dd {\n  margin: 0;\n}\n/* Callout Styling */\n.dark-callout .icon {\n  background-color: #acadad;\n}\n.light-callout .icon {\n  background-color: #454545;\n}\n.inline-list {\n  overflow: hidden;\n  padding: 0;\n  margin: 0 -10px;\n  list-style: none;\n}\n.inline-item {\n  float: left;\n}\n.dark-callout .inline-item + .inline-item {\n  border-left: 1px solid #474949;\n}\n.light-callout .inline-item + .inline-item {\n  border-left: 1px solid #d3d7d7;\n}\n.inline-list .icon {\n  padding: 5px;\n  margin: 5px 10px;\n  line-height: 0;\n  text-indent: -9999px;\n}\n", "../../style/topcoat/topcoat-mobile.css?rootpath=../../style/topcoat/"); });

define('mobileui/utils/less-module!../../style/mobile-ui.css?rootpath=../../style/',["mobileui/utils/style-module"], function(StyleModule) { return StyleModule.injectStyle("/*\n * Copyright (c) 2013 Adobe Systems Incorporated. All rights reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nbody {\n  overflow: hidden;\n}\nhtml {\n  -ms-touch-action: none;\n  /* Direct all pointer events to JavaScript code. */\n\n}\n.js-layer-view {\n  position: absolute;\n}\n.js-static-view {\n  position: static;\n}\n.js-layer-view-invisible {\n  visibility: hidden;\n}\n.js-layer-view-disabled {\n  pointer-events: none;\n}\n.js-measured-view-content {\n  position: absolute;\n}\n.js-transform-view,\n.js-pan-view {\n  transform-origin: 0 0;\n}\n.js-scroll-view {\n  overflow: hidden;\n}\n.js-scroll-view-indicator {\n  background-color: rgba(0, 0, 0, 0.5);\n}\n.js-scroll-view-vertical-indicator {\n  transform-origin: 100% 0%;\n}\n.js-scroll-view-horizontal-indicator {\n  transform-origin: 0% 100%;\n}\n.js-touch-preview {\n  position: absolute;\n  border-radius: 50px;\n  width: 50px;\n  height: 50px;\n  left: -25px;\n  top: -25px;\n  background: rgba(255, 255, 255, 0.4);\n  opacity: 1;\n  pointer-events: none;\n}\n", "../../style/mobile-ui.css?rootpath=../../style/"); });

define('mobileui/utils/less-module!../../style/components.css?rootpath=../../style/',["mobileui/utils/style-module"], function(StyleModule) { return StyleModule.injectStyle("/*\n * Copyright (c) 2013 Adobe Systems Incorporated. All rights reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nhtml,\nbody,\n.js-window-view {\n  overflow: hidden;\n  margin: 0;\n}\nbody {\n  background-color: black;\n  font-family: \"source\", verdana;\n}\n/* topcoat fixes */\n.dark-button,\n.light-button {\n  padding: 0;\n}\n.slide-switch-container {\n  margin: 0;\n}\n.js-checkbox-on-label,\n.js-checkbox-off-label {\n  border-radius: 4px;\n  font-size: 16px;\n  text-align: center;\n}\n.dark-slide-switch .js-checkbox-on-label {\n  background-color: #404141;\n  box-shadow: inset 0 1px 0px rgba(0, 0, 0, 0.06);\n  color: #5DC1FF;\n}\n.dark-slide-switch .js-checkbox-off-label {\n  background-color: #404141;\n  box-shadow: inset 0 1px 0px rgba(0, 0, 0, 0.06);\n  color: #909090;\n}\n.slide-switch-container > .dark-slide-switch > .switch {\n  transition: none;\n}\n/* end topcoat fixes */\n.center {\n  position: absolute;\n  top: 50%;\n  transform: translateY(-50%);\n  width: 100%;\n  text-align: center;\n}\n.js-dialog-background-view,\n.js-app-card-grayscale-overlay {\n  background: black;\n}\n.js-dialog-content-view {\n  background-color: white;\n}\n.js-app-navigator-content-view {\n  overflow: hidden;\n}\n.js-touch-item-view-filter,\n.js-touch-item-view-fold-filter {\n  z-index: 1;\n}\n.js-touch-item-view-filter > .js-touch-item-view:before {\n  position: absolute;\n  top: -40px;\n  bottom: -40px;\n  left: 0;\n  right: 0;\n  content: \"\";\n}\n.js-fold-effect-filter-margin-shadow {\n  background-color: rgba(0, 0, 0, 0.3);\n}\n.js-setting-line-label-content-view {\n  position: absolute;\n  top: 50%;\n  transform: translateY(-50%);\n  font-weight: bold;\n}\n", "../../style/components.css?rootpath=../../style/"); });

define('mobileui/utils/less-module!style/style.less?rootpath=style/',["mobileui/utils/style-module"], function(StyleModule) { return StyleModule.injectStyle("a.js-link-view.js-button-view-down {\n  background-color: #ccc;\n  border-radius: 10px;\n}\n.js-slide-container-content-view {\n  transform-origin: 0 0;\n}\n.js-slide-item-view,\n.js-slide-list-item-view {\n  background: -webkit-radial-gradient(left, #494d4e 0%, #343737 80%, #333636 100%);\n  background: -ms-radial-gradient(left, #494d4e 0%, #343737 80%, #333636 100%);\n  background: -moz-radial-gradient(left, #494d4e 0%, #343737 80%, #333636 100%);\n  background: radial-gradient(left, #494d4e 0%, #343737 80%, #333636 100%);\n}\n.js-slide-list-button-view.js-button-view-down {\n  background-color: rgba(0, 0, 0, 0.5);\n  border-radius: 10px;\n}\n.js-logo-view {\n  background: url(style/../images/adobe.svg) center top no-repeat;\n  background-size: contain;\n}\n.js-slide-container-content-view {\n  color: white;\n  text-shadow: 1px 1px 1px rgba(0, 0, 0, 0.7);\n  text-align: center;\n  font-size: 2.2em;\n}\n.js-slide-container-content-view h1,\n.js-slide-container-content-view h2,\n.js-slide-container-content-view h3,\n.js-slide-container-content-view h4,\n.js-slide-container-content-view h5,\n.js-slide-container-content-view h6 {\n  font-family: \"source-l\";\n  margin: 0;\n  font-weight: 400;\n}\n.js-slide-container-content-view ul {\n  margin: 0;\n  padding: 0;\n  list-style: none;\n}\n.js-slide-container-content-view ul > li {\n  margin: 0;\n  padding: 0;\n}\n.js-slide-container-content-view .js-slide-number {\n  position: absolute;\n  left: 0;\n  right: 0;\n  text-align: center;\n  font-weight: bold;\n  font-size: 0.5em;\n  bottom: 2%;\n}\n.js-slide-container-content-view .center {\n  position: absolute;\n  top: 50%;\n  left: 10%;\n  width: 80%;\n  text-align: center;\n  transform: translateY(-50%);\n}\n.js-slide-container-content-view .title-margin {\n  margin-top: 1em;\n}\n.js-slide-container-content-view .italics {\n  font-style: italic;\n}\n.js-slide-container-content-view .link-view {\n  display: block;\n}\n.js-slide-container-content-view .slide-link {\n  position: absolute;\n  bottom: 10%;\n  left: 0px;\n  right: 0px;\n  font-size: 0.6em;\n}\n.js-slide-container-content-view h1,\n.js-slide-container-content-view h2,\n.js-slide-container-content-view h3,\n.js-slide-container-content-view h4,\n.js-slide-container-content-view h5,\n.js-slide-container-content-view h6,\n.js-slide-container-content-view a,\n.js-slide-container-content-view a:visited {\n  color: white;\n  text-shadow: 1px 1px 1px rgba(0, 0, 0, 0.7);\n  text-decoration: none;\n}\n.js-slide-container-content-view .smaller-space {\n  margin-left: auto;\n  margin-right: auto;\n  width: 60%;\n}\n.js-slide-container-content-view .bordered-list {\n  border: 1px solid rgba(255, 255, 255, 0.4);\n  border-radius: 10px;\n  margin-top: 1em;\n  margin-bottom: 1em;\n}\n.js-slide-container-content-view .bordered-list li {\n  padding-top: 10px;\n  padding-bottom: 10px;\n}\n.js-slide-container-content-view .bordered-list li + li {\n  border-top: 1px solid rgba(255, 255, 255, 0.4);\n}\n.js-slide-container-content-view .bordered-list li:nth-child(2n+1) {\n  background: rgba(255, 255, 255, 0.05);\n}\n.js-slide-container-content-view .bordered-list li.small,\n.js-slide-container-content-view .bordered-list li .small {\n  font-size: 0.8em;\n}\n.js-slide-container-content-view .bordered-list li.title {\n  background: rgba(0, 0, 0, 0.3);\n}\n.js-slide-container-content-view .bordered-list li:first-of-type {\n  border-top-left-radius: 10px;\n  border-top-right-radius: 10px;\n}\n.js-slide-container-content-view .simple-list {\n  margin-top: 1em;\n  margin-bottom: 1em;\n}\n.js-slide-container-content-view .simple-list li {\n  padding-top: 10px;\n  padding-bottom: 10px;\n}\n.js-slide-container-content-view .simple-list li.small {\n  font-size: 0.6em;\n}\n.js-slide-container-content-view .simple-list li .small {\n  font-size: 0.8em;\n}\n.js-slide-container-content-view .row {\n  width: 100%;\n}\n.js-slide-container-content-view .row .cell3 {\n  float: left;\n  width: 31%;\n  margin-left: 1%;\n  margin-right: 1%;\n}\n.js-slide-container-content-view .row .cell2 {\n  float: left;\n  width: 48%;\n  margin-left: 1%;\n  margin-right: 1%;\n}\n.js-slide-container-content-view .row .cell2-reduced {\n  float: left;\n  width: 29%;\n  margin-left: 1%;\n  margin-right: 1%;\n}\n.js-slide-container-content-view .row .cell2-reduced:first-of-type {\n  margin-left: 20%;\n}\n.js-slide-container-content-view .row .cell2-reduced:last-of-type {\n  margin-right: 20%;\n}\n.js-slide-container-content-view .row::after {\n  content: \"\";\n  clear: left;\n}\n.js-slide-container-index {\n  background: url(style/../images/background.jpg) no-repeat center;\n  background-size: cover;\n}\n.js-slide-index .text-band {\n  position: absolute;\n  top: 15%;\n  left: 0px;\n  right: 0px;\n  background: rgba(255, 255, 255, 0.8);\n  color: black;\n  text-align: center;\n  padding: 20px;\n  font-size: 0.8em;\n  border-radius: 10px;\n}\n.js-slide-index .text-band h1 {\n  color: black;\n  text-shadow: none;\n}\n.js-slide-index .text-band h2,\n.js-slide-index .text-band h3,\n.js-slide-index .text-band h4 {\n  color: #888888;\n  text-shadow: none;\n}\n.js-slide-index .text-band a {\n  color: #555555;\n  text-shadow: none;\n}\n.js-slide-index .adobe-bird {\n  position: absolute;\n  background: url(style/../images/adobe_bird.png) no-repeat right bottom;\n  background-size: contain;\n  width: 30%;\n  height: 30%;\n  right: -5%;\n  bottom: 10%;\n}\n.js-slide-index .adobe-max {\n  position: absolute;\n  background: url(style/../images/adobe_max.png) no-repeat center bottom;\n  background-size: contain;\n  height: 30%;\n  left: 5%;\n  right: 5%;\n  top: 40%;\n}\n.js-slide-index .js-slide-number {\n  display: none;\n}\n.js-slide-about-me .css-regions-picture,\n.js-slide-about-me .css-exclusions-picture,\n.js-slide-about-me .css-filters-picture,\n.js-slide-about-me .css-webkit-picture {\n  position: absolute;\n  background-size: contain;\n  background-repeat: no-repeat;\n  background-position: center;\n}\n.js-slide-about-me .css-regions-picture > a,\n.js-slide-about-me .css-exclusions-picture > a,\n.js-slide-about-me .css-filters-picture > a,\n.js-slide-about-me .css-webkit-picture > a {\n  display: block;\n  width: 100%;\n  height: 100%;\n}\n.js-slide-about-me .css-regions-picture > a > .feature-label,\n.js-slide-about-me .css-exclusions-picture > a > .feature-label,\n.js-slide-about-me .css-filters-picture > a > .feature-label,\n.js-slide-about-me .css-webkit-picture > a > .feature-label {\n  position: absolute;\n  top: -1.5em;\n  left: 0px;\n  text-align: center;\n  width: 100%;\n}\n.js-slide-about-me .css-regions-picture,\n.js-slide-about-me .css-exclusions-picture,\n.js-slide-about-me .css-filters-picture {\n  box-shadow: 0px 10px 10px 0px rgba(0, 0, 0, 0.6);\n  background-color: white;\n  width: 30%;\n  height: 30%;\n}\n.js-slide-about-me .css-regions-picture {\n  left: 10%;\n  top: 25%;\n  background-image: url(style/../images/specs/regions.png);\n  transform: rotate(-10deg);\n}\n.js-slide-about-me .css-exclusions-picture {\n  left: 35%;\n  top: 25%;\n  background-image: url(style/../images/specs/exclusions.png);\n}\n.js-slide-about-me .css-filters-picture {\n  left: 60%;\n  top: 35%;\n  background-image: url(style/../images/specs/filters.png);\n  transform: rotate(6deg);\n}\n.js-slide-about-me .css-webkit-picture {\n  left: 20%;\n  top: 50%;\n  width: 40%;\n  height: 40%;\n  background-image: url(style/../images/webkit-icon.png);\n}\n.js-slide-about-me .css-webkit-picture .feature-label {\n  display: none;\n}\n.js-slide-intro .intro-scroll-view {\n  width: 1024px;\n  height: 200px;\n  text-align: center;\n  font-size: 2em;\n}\n.js-slide-demos .js-demo-view {\n  background-color: rgba(0, 0, 0, 0.8);\n  -webkit-box-shadow: 0px 4px 10px 5px rgba(0, 0, 0, 0.5);\n  font-size: 1rem;\n  text-shadow: none;\n  color: black;\n}\n.js-slide-demos .js-demo-view h1,\n.js-slide-demos .js-demo-view h2,\n.js-slide-demos .js-demo-view h3,\n.js-slide-demos .js-demo-view h4,\n.js-slide-demos .js-demo-view h5,\n.js-slide-demos .js-demo-view h6,\n.js-slide-demos .js-demo-view a,\n.js-slide-demos .js-demo-view a:visited {\n  color: black;\n  text-shadow: none;\n}\n.js-slide-web-features .title-margin {\n  margin-bottom: 1em;\n}\n.js-slide-touch-gestures .touch-area {\n  position: relative;\n  height: 400px;\n  margin-top: 1em;\n  border: 1px solid rgba(255, 255, 255, 0.4);\n  border-radius: 10px;\n  background-color: rgba(255, 255, 255, 0.1);\n}\n.js-slide-touch-gestures .touch-area .touch-area-label {\n  font-size: 0.7em;\n}\n.js-slide-touch-gestures .js-touch-hold-view-down {\n  background-color: rgba(255, 255, 255, 0.4);\n}\n.js-slide-touch-combined .touch-area-container {\n  margin-top: 1em;\n  position: relative;\n  height: 400px;\n}\n.js-slide-touch-combined .touch-area-container .touch-area-inner {\n  position: relative;\n  width: 100%;\n  height: 100%;\n}\n.js-slide-touch-combined .touch-area-container .touch-area-inner .touch-area {\n  position: relative;\n  width: 100%;\n  height: 100%;\n  border: 1px solid rgba(255, 255, 255, 0.4);\n  border-radius: 10px;\n  background-color: rgba(255, 255, 255, 0.1);\n}\n.js-slide-touch-combined .touch-area-container .touch-area-inner .touch-area .touch-area-label {\n  font-size: 0.7em;\n}\n.js-slide-dom-remove .gauge-view-container {\n  position: relative;\n}\n.js-slide-dom-remove .gauge-view-container .gauge-view {\n  position: absolute;\n  top: 50%;\n  right: 30px;\n  transform: translateY(-50%);\n  width: 100px;\n  height: 50px;\n  background: -webkit-radial-gradient(bottom, rgba(0, 0, 0, 0) 0%, rgba(0, 0, 0, 0.5) 80%, rgba(0, 0, 0, 0.5) 100%);\n  border: 2px solid rgba(255, 255, 255, 0.4);\n  border-bottom: 1px solid rgba(255, 255, 255, 0.2);\n  border-top-left-radius: 50px;\n  border-top-right-radius: 50px;\n}\n.js-slide-dom-remove .gauge-view-container .gauge-view::after {\n  position: absolute;\n  top: 20%;\n  left: 0px;\n  right: 0px;\n  text-align: center;\n}\n.js-slide-dom-remove .gauge-view-container .gauge-view .gauge-view-indicator {\n  position: absolute;\n  bottom: 0px;\n  height: 4px;\n  left: -4%;\n  width: 54%;\n  background: -webkit-linear-gradient(right, rgba(255, 255, 255, 0) 0%, rgba(255, 255, 255, 0) 59%, rgba(255, 255, 255, 0.8) 80%, rgba(255, 255, 255, 0.9) 100%);\n  transform-origin: 100% 50%;\n}\n.js-slide-dom-remove .gauge-view-container .gauge-view.val1-gauge-view {\n  background-color: rgba(128, 0, 0, 0.5);\n}\n.js-slide-dom-remove .gauge-view-container .gauge-view.val1-gauge-view::after {\n  content: \"60fps\";\n}\n.js-slide-dom-remove .gauge-view-container .gauge-view.val1-gauge-view .gauge-view-indicator {\n  transform: rotate(170deg);\n}\n.js-slide-dom-remove .gauge-view-container .gauge-view.val2-gauge-view {\n  background-color: rgba(128, 0, 0, 0.4);\n}\n.js-slide-dom-remove .gauge-view-container .gauge-view.val2-gauge-view::after {\n  content: \"40fps\";\n}\n.js-slide-dom-remove .gauge-view-container .gauge-view.val2-gauge-view .gauge-view-indicator {\n  transform: rotate(116deg);\n}\n.js-slide-dom-remove .gauge-view-container .gauge-view.val3-gauge-view {\n  background-color: rgba(128, 0, 0, 0.1);\n}\n.js-slide-dom-remove .gauge-view-container .gauge-view.val3-gauge-view::after {\n  content: \"20fps\";\n}\n.js-slide-dom-remove .gauge-view-container .gauge-view.val3-gauge-view .gauge-view-indicator {\n  transform: rotate(63deg);\n}\n.js-slide-dom-remove .gauge-view-container .gauge-view.val4-gauge-view {\n  background-color: rgba(128, 0, 0, 0);\n}\n.js-slide-dom-remove .gauge-view-container .gauge-view.val4-gauge-view::after {\n  content: \"0fps\";\n}\n.js-slide-dom-remove .gauge-view-container .gauge-view.val4-gauge-view .gauge-view-indicator {\n  transform: rotate(10deg);\n}\n.js-slide-end .js-slide-number {\n  display: none;\n}\n", "style/style.less?rootpath=style/"); });

define('mobileui/utils/less-module!../sample/style/style.css?rootpath=../sample/style/',["mobileui/utils/style-module"], function(StyleModule) { return StyleModule.injectStyle("/*\n * Copyright (c) 2013 Adobe Systems Incorporated. All rights reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n.js-index-view,\n.js-old-test-view {\n  background-color: white;\n}\n.js-item-view {\n  border-bottom: 1px solid #ccc;\n}\n.js-splash-item-view {\n  background: url(../sample/style/../assets/main_bg.jpg) no-repeat center;\n  background-size: cover;\n  color: black;\n}\n.js-splash-item-view-guide-label {\n  font-family: \"source-l\";\n  font-style: italic;\n  font-size: 30px;\n  text-align: center;\n  text-transform: none;\n}\n.js-splash-item-view-explore-label {\n  font-family: \"source-l\";\n  font-style: italic;\n  font-size: 25px;\n  text-align: center;\n  text-transform: none;\n}\n.js-splash-item-view-label {\n  font-family: \"source-sb\";\n  position: absolute;\n  border: 5px solid black;\n  left: 50%;\n  top: 50%;\n  transform: translate(-50%, -50%);\n  font-size: 0.5em;\n  padding: 0 30px 0 30px;\n  text-transform: uppercase;\n  white-space: nowrap;\n}\n.js-city-item-view {\n  color: white;\n}\n.js-city-item-view:after {\n  position: absolute;\n  content: \">\";\n  font-size: 1.5em;\n  text-shadow: 1px 1px 0 #555;\n  font-weight: bold;\n  color: white;\n  bottom: 15px;\n  left: 50%;\n  transform: rotate(90deg) translateX(-50%);\n}\n.js-city-item-view.js-vertical-item-view:after {\n  left: auto;\n  bottom: auto;\n  top: 50%;\n  transform: translateY(-50%);\n  right: 15px;\n}\n.js-city-item-view-label:before {\n  position: relative;\n  display: inline-block;\n  right: 1.2em;\n  top: -1.5em;\n  width: 0;\n  height: 0;\n  font-style: italic;\n  font-size: 0.6em;\n  content: \"by\";\n  text-transform: lowercase;\n}\n.js-city-item-view-label {\n  position: absolute;\n  top: 50%;\n  transform: translateY(-50%);\n  font-size: 2.2em;\n  width: 100%;\n  text-align: center;\n  text-transform: uppercase;\n}\n.js-city-item-view.js-city-mood-item-view {\n  background-color: #df8051;\n}\n.js-city-item-view.js-city-location-item-view {\n  background-color: #7cac94;\n}\n.js-city-item-view.js-city-search-item-view {\n  background-color: #4f5a6c;\n}\n.js-mood-item-view {\n  color: white;\n}\n.js-mood-item-view:after {\n  position: absolute;\n  top: 50%;\n  transform: translateY(-50%);\n  right: 15px;\n  content: \">\";\n  font-size: 1.5em;\n  text-shadow: 1px 1px 0 #555;\n  font-weight: bold;\n  color: white;\n}\n.js-mood-item-view-label {\n  position: absolute;\n  top: 50%;\n  transform: translateY(-50%);\n  font-size: 3.0em;\n  width: 100%;\n  text-align: center;\n  text-transform: uppercase;\n}\n.js-mood-item-view.js-do-item-view {\n  background-color: #95bdbd;\n}\n.js-mood-item-view.js-see-item-view {\n  background-color: #4b3c51;\n}\n.js-mood-item-view.js-buy-item-view {\n  background-color: #b44438;\n}\n.js-mood-item-view.js-eat-item-view {\n  background-color: #cabc4f;\n}\n.js-location-item-view {\n  color: white;\n}\n.js-location-item-view:after {\n  position: absolute;\n  top: 50%;\n  transform: translateY(-50%);\n  right: 15px;\n  content: \">\";\n  font-size: 1.5em;\n  text-shadow: 1px 1px 0 #555;\n  font-weight: bold;\n  color: white;\n}\n.js-location-item-view-label {\n  position: absolute;\n  top: 50%;\n  text-align: center;\n  transform: translateY(-50%);\n  font-size: 1.5em;\n  text-overflow: ellipsis;\n  overflow: hidden;\n  white-space: nowrap;\n  left: 20px;\n  right: 20px;\n}\n.js-navigator-top-bar-title-view {\n  color: white;\n  font-size: 1.3em;\n  text-align: center;\n  font-family: \"source-sb\";\n}\n.js-location-content-view {\n  color: black;\n  background-color: white;\n}\n.js-location-view-label > .js-content-view-content {\n  font-size: 2.0em;\n  text-transform: uppercase;\n}\n.js-location-picture-scroll-view {\n  transform-origin: 50% 0;\n}\n.js-location-two-column-view {\n  box-sizing: border-box;\n  background-color: LightGray;\n  border-top: 1px solid MidnightBlue;\n  border-bottom: 1px solid MidnightBlue;\n}\n.js-location-two-column-view + .js-location-two-column-view {\n  border-top: none;\n}\n.js-location-two-column-cell-view + .js-location-two-column-cell-view {\n  box-sizing: border-box;\n  border-left: 1px solid MidnightBlue;\n}\n.js-location-view-paragraph {\n  padding-bottom: 10px;\n  text-align: justify;\n}\n.js-picture-view {\n  transform-origin: 0 0;\n}\n", "../sample/style/style.css?rootpath=../sample/style/"); });

/*
 * Copyright (c) 2013 Adobe Systems Incorporated. All rights reserved.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

define('main',[
    'mobileui/utils/bus',
    'mobileui/utils/settings',
    // Router and MainView automatically inject in the bus.
    'router',
    'views/main-view',
    'mobileui/utils/less-module!../../style/topcoat/normalize.css?rootpath=../../style/topcoat/',
    'mobileui/utils/less-module!../../style/topcoat/topcoat-mobile.css?rootpath=../../style/topcoat/',
    'mobileui/utils/less-module!../../style/mobile-ui.css?rootpath=../../style/',
    'mobileui/utils/less-module!../../style/components.css?rootpath=../../style/',
    'mobileui/utils/less-module!style/style.less?rootpath=style/',
    'mobileui/utils/less-module!../sample/style/style.css?rootpath=../sample/style/'
],

function(bus, settings) {

    function init() {
        bus.trigger("init");
        settings.once("ready", function() {
            bus.trigger("start");
        });
        settings.init();
    }

    if (window.IsCordova)
        document.addEventListener("deviceready", init, true);
    else
        $(init);

});